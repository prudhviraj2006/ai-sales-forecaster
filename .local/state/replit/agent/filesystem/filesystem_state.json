{"file_contents":{"AISalesForecasterzip/AISalesForecaster/backend/tests/__init__.py":{"content":"# Tests for AI Sales Forecaster\n","path":null,"size_bytes":32,"size_tokens":null},"AISalesForecasterzip/AISalesForecaster/backend/app/models/schemas.py":{"content":"from pydantic import BaseModel, Field\nfrom typing import Optional, List, Dict, Any\nfrom datetime import datetime\nfrom enum import Enum\n\n\nclass AggregationType(str, Enum):\n    DAILY = \"daily\"\n    WEEKLY = \"weekly\"\n    MONTHLY = \"monthly\"\n\n\nclass ModelType(str, Enum):\n    PROPHET = \"prophet\"\n    LIGHTGBM = \"lightgbm\"\n\n\nclass HorizonType(int, Enum):\n    THREE_MONTHS = 3\n    SIX_MONTHS = 6\n    TWELVE_MONTHS = 12\n\n\nclass ValidationResult(BaseModel):\n    is_valid: bool\n    errors: List[str] = []\n    warnings: List[str] = []\n    row_count: int = 0\n    column_count: int = 0\n    date_range: Optional[Dict[str, str]] = None\n    missing_values: Dict[str, int] = {}\n\n\nclass UploadResponse(BaseModel):\n    job_id: str\n    validation: ValidationResult\n    preview: List[Dict[str, Any]]\n    columns: List[str]\n    numeric_columns: List[str]\n    categorical_columns: List[str]\n\n\nclass ForecastRequest(BaseModel):\n    job_id: str\n    aggregation: AggregationType = AggregationType.MONTHLY\n    model: ModelType = ModelType.PROPHET\n    horizon: int = Field(default=6, ge=1, le=24)\n    target_column: str = \"revenue\"\n    group_by: Optional[str] = None\n\n\nclass ForecastMetrics(BaseModel):\n    mae: float\n    rmse: float\n    mape: float\n    train_size: int\n    test_size: int\n    confidence_score: Optional[float] = None\n    risk_level: Optional[str] = None\n    overprediction_bias: Optional[float] = None\n    underprediction_bias: Optional[float] = None\n\n\nclass ForecastPoint(BaseModel):\n    date: str\n    actual: Optional[float] = None\n    predicted: float\n    lower_bound: Optional[float] = None\n    upper_bound: Optional[float] = None\n\n\nclass DecompositionData(BaseModel):\n    trend: List[Dict[str, Any]]\n    seasonal: List[Dict[str, Any]]\n    residual: List[Dict[str, Any]]\n    weekly: Optional[List[Dict[str, Any]]] = None\n    holiday_impact: Optional[List[Dict[str, Any]]] = None\n\n\nclass FeatureImportance(BaseModel):\n    feature: str\n    importance: float\n\n\nclass ForecastResponse(BaseModel):\n    job_id: str\n    model_type: str\n    aggregation: str\n    horizon: int\n    target_column: str\n    metrics: ForecastMetrics\n    forecast: List[ForecastPoint]\n    historical: List[ForecastPoint]\n    decomposition: Optional[DecompositionData] = None\n    feature_importance: Optional[List[FeatureImportance]] = None\n    top_products: Optional[List[Dict[str, Any]]] = None\n    top_regions: Optional[List[Dict[str, Any]]] = None\n\n\nclass InsightBullet(BaseModel):\n    icon: str\n    text: str\n    severity: str = \"info\"\n\n\nclass Recommendation(BaseModel):\n    category: str\n    title: str\n    description: str\n    priority: str = \"medium\"\n\n\nclass KPISnapshot(BaseModel):\n    name: str\n    value: str\n    change: Optional[str] = None\n    trend: str = \"neutral\"\n\n\nclass InsightsResponse(BaseModel):\n    job_id: str\n    title: str\n    summary: str\n    kpis: List[KPISnapshot]\n    bullets: List[InsightBullet]\n    recommendations: List[Recommendation]\n    generated_at: str\n\n\nclass DownloadFormat(str, Enum):\n    CSV = \"csv\"\n    PDF = \"pdf\"\n","path":null,"size_bytes":3017,"size_tokens":null},"AISalesForecasterzip/AISalesForecaster/backend/app/routes/chat.py":{"content":"import logging\nimport json\nfrom fastapi import APIRouter, HTTPException\nfrom pydantic import BaseModel\nfrom typing import List, Dict, Optional\n\nfrom ..services.chat_service import ChatService\nfrom ..models.database import get_latest_forecast\n\nlogger = logging.getLogger(__name__)\nrouter = APIRouter()\n\n\nclass ChatMessage(BaseModel):\n    role: str\n    content: str\n\n\nclass ChatRequest(BaseModel):\n    job_id: str\n    message: str\n    conversation_history: Optional[List[ChatMessage]] = None\n\n\nclass ChatResponse(BaseModel):\n    success: bool\n    response: str\n    timestamp: str\n    error: Optional[str] = None\n\n\n@router.post(\"/chat\", response_model=ChatResponse)\nasync def chat_endpoint(request: ChatRequest):\n    \"\"\"Chat with AI about forecast insights\"\"\"\n    try:\n        # Get forecast data\n        forecast = get_latest_forecast(request.job_id)\n        if not forecast:\n            raise HTTPException(status_code=404, detail=\"Forecast not found\")\n        \n        # Parse forecast data\n        forecast_data = {\n            'model_type': forecast.get('model_type'),\n            'metrics': json.loads(forecast['metrics']) if isinstance(forecast['metrics'], str) else forecast['metrics'],\n            'forecast': json.loads(forecast['forecast_data']) if isinstance(forecast['forecast_data'], str) else forecast['forecast_data'],\n            'historical': json.loads(forecast['historical_data']) if isinstance(forecast['historical_data'], str) else forecast['historical_data']\n        }\n        \n        # Initialize chat service\n        chat_service = ChatService(forecast_data)\n        \n        # Convert conversation history\n        history = []\n        if request.conversation_history:\n            history = [{\"role\": msg.role, \"content\": msg.content} for msg in request.conversation_history]\n        \n        # Get response\n        result = chat_service.chat(request.message, history)\n        \n        if result.get('success'):\n            return ChatResponse(\n                success=True,\n                response=result['response'],\n                timestamp=result['timestamp']\n            )\n        else:\n            return ChatResponse(\n                success=False,\n                response=result['response'],\n                timestamp=result.get('timestamp', ''),\n                error=result.get('error')\n            )\n    \n    except Exception as e:\n        logger.error(f\"Chat error: {str(e)}\")\n        raise HTTPException(status_code=500, detail=f\"Chat failed: {str(e)}\")\n","path":null,"size_bytes":2493,"size_tokens":null},"AISalesForecasterzip/AISalesForecaster/backend/tests/test_data_pipeline.py":{"content":"import pytest\nimport pandas as pd\nimport numpy as np\nfrom datetime import datetime, timedelta\nimport sys\nimport os\n\nsys.path.insert(0, os.path.join(os.path.dirname(__file__), '..'))\n\nfrom app.services.data_pipeline import DataPipeline\nfrom app.models.schemas import AggregationType\n\n\ndef create_sample_df(n_rows=100):\n    dates = pd.date_range(start='2023-01-01', periods=n_rows, freq='D')\n    return pd.DataFrame({\n        'date': dates,\n        'product_id': ['SKU001'] * n_rows,\n        'product_name': ['Product A'] * n_rows,\n        'region': np.random.choice(['North', 'South', 'East', 'West'], n_rows),\n        'units_sold': np.random.randint(10, 100, n_rows),\n        'revenue': np.random.uniform(100, 1000, n_rows).round(2),\n        'price': np.random.uniform(10, 50, n_rows).round(2),\n        'promotion_flag': np.random.choice([0, 1], n_rows, p=[0.8, 0.2])\n    })\n\n\nclass TestDataPipeline:\n    def test_validate_valid_data(self):\n        df = create_sample_df()\n        pipeline = DataPipeline(df)\n        result = pipeline.validate()\n        \n        assert result.is_valid == True\n        assert len(result.errors) == 0\n        assert result.row_count == 100\n        assert result.column_count == 8\n    \n    def test_validate_missing_date_column(self):\n        df = create_sample_df()\n        df = df.drop(columns=['date'])\n        pipeline = DataPipeline(df)\n        result = pipeline.validate()\n        \n        assert result.is_valid == False\n        assert any('date' in err.lower() for err in result.errors)\n    \n    def test_validate_date_range(self):\n        df = create_sample_df()\n        pipeline = DataPipeline(df)\n        result = pipeline.validate()\n        \n        assert result.date_range is not None\n        assert 'start' in result.date_range\n        assert 'end' in result.date_range\n    \n    def test_clean_data(self):\n        df = create_sample_df()\n        df.loc[0, 'revenue'] = np.nan\n        df.loc[1, 'units_sold'] = np.nan\n        \n        pipeline = DataPipeline(df)\n        cleaned = pipeline.clean_data()\n        \n        assert cleaned['revenue'].isna().sum() == 0\n        assert cleaned['units_sold'].isna().sum() == 0\n    \n    def test_handle_outliers(self):\n        df = create_sample_df()\n        df.loc[0, 'revenue'] = 1000000\n        \n        pipeline = DataPipeline(df)\n        pipeline.clean_data()\n        result = pipeline.handle_outliers(['revenue'])\n        \n        assert result['revenue'].max() < 1000000\n    \n    def test_aggregate_monthly(self):\n        df = create_sample_df(n_rows=365)\n        pipeline = DataPipeline(df)\n        \n        aggregated = pipeline.aggregate(AggregationType.MONTHLY, 'revenue')\n        \n        assert len(aggregated) <= 12\n        assert 'date' in aggregated.columns\n        assert 'revenue' in aggregated.columns\n    \n    def test_aggregate_weekly(self):\n        df = create_sample_df(n_rows=100)\n        pipeline = DataPipeline(df)\n        \n        aggregated = pipeline.aggregate(AggregationType.WEEKLY, 'revenue')\n        \n        assert len(aggregated) <= 15\n        assert 'date' in aggregated.columns\n    \n    def test_engineer_features(self):\n        df = create_sample_df()\n        pipeline = DataPipeline(df)\n        aggregated = pipeline.aggregate(AggregationType.DAILY, 'revenue')\n        featured = pipeline.engineer_features(aggregated, 'revenue')\n        \n        assert 'year' in featured.columns\n        assert 'month' in featured.columns\n        assert 'day_of_week' in featured.columns\n        assert 'revenue_lag_1' in featured.columns\n        assert 'revenue_rolling_mean_7' in featured.columns\n    \n    def test_get_preview(self):\n        df = create_sample_df()\n        pipeline = DataPipeline(df)\n        preview = pipeline.get_preview(n=5)\n        \n        assert len(preview) == 5\n        assert isinstance(preview, list)\n        assert isinstance(preview[0], dict)\n    \n    def test_get_column_info(self):\n        df = create_sample_df()\n        pipeline = DataPipeline(df)\n        all_cols, numeric_cols, categorical_cols = pipeline.get_column_info()\n        \n        assert 'revenue' in numeric_cols\n        assert 'units_sold' in numeric_cols\n        assert 'region' in categorical_cols\n    \n    def test_prepare_for_modeling(self):\n        df = create_sample_df(n_rows=100)\n        pipeline = DataPipeline(df)\n        result = pipeline.prepare_for_modeling(\n            aggregation=AggregationType.DAILY,\n            target_column='revenue'\n        )\n        \n        assert 'date' in result.columns\n        assert 'revenue' in result.columns\n        assert len(result) > 0\n\n\nclass TestDataPipelineEdgeCases:\n    def test_empty_dataframe(self):\n        df = pd.DataFrame()\n        pipeline = DataPipeline(df)\n        result = pipeline.validate()\n        \n        assert result.row_count == 0\n    \n    def test_single_row(self):\n        df = create_sample_df(n_rows=1)\n        pipeline = DataPipeline(df)\n        result = pipeline.validate()\n        \n        assert result.is_valid == True\n        assert result.row_count == 1\n    \n    def test_missing_numeric_columns(self):\n        df = pd.DataFrame({\n            'date': pd.date_range(start='2023-01-01', periods=10),\n            'category': ['A'] * 10\n        })\n        pipeline = DataPipeline(df)\n        result = pipeline.validate()\n        \n        assert any('numeric' in w.lower() for w in result.warnings)\n\n\nif __name__ == '__main__':\n    pytest.main([__file__, '-v'])\n","path":null,"size_bytes":5453,"size_tokens":null},"AISalesForecasterzip/AISalesForecaster/frontend/src/components/ScenarioSimulator.jsx":{"content":"import { useState } from 'react';\nimport { X, Zap, TrendingUp } from 'lucide-react';\nimport { runScenario } from '../services/api';\n\nfunction ScenarioSimulator({ jobId, onClose, darkMode }) {\n  const [priceChange, setPriceChange] = useState(0);\n  const [volumeChange, setVolumeChange] = useState(0);\n  const [loading, setLoading] = useState(false);\n  const [result, setResult] = useState(null);\n\n  const handleSimulate = async () => {\n    setLoading(true);\n    try {\n      const data = await runScenario(jobId, { price_change: priceChange, volume_change: volumeChange });\n      setResult(data);\n    } catch (err) {\n      console.error('Error running scenario:', err);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50\">\n      <div className={`rounded-lg shadow-2xl max-w-md w-full mx-4 ${\n        darkMode ? 'bg-slate-800' : 'bg-white'\n      }`}>\n        <div className={`p-6 border-b flex items-center justify-between ${\n          darkMode ? 'border-slate-700' : 'border-gray-200'\n        }`}>\n          <div className=\"flex items-center gap-2\">\n            <Zap size={20} className=\"text-yellow-500\" />\n            <h3 className={`text-lg font-bold ${darkMode ? 'text-white' : 'text-gray-900'}`}>\n              Sales Scenario Simulator\n            </h3>\n          </div>\n          <button\n            onClick={onClose}\n            className={`p-1 rounded-lg ${darkMode ? 'hover:bg-slate-700' : 'hover:bg-gray-100'}`}\n          >\n            <X size={20} />\n          </button>\n        </div>\n\n        <div className=\"p-6 space-y-6\">\n          {!result ? (\n            <>\n              <div>\n                <label className={`block text-sm font-semibold mb-2 ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>\n                  Price Change: {priceChange}%\n                </label>\n                <input\n                  type=\"range\"\n                  min=\"-20\"\n                  max=\"20\"\n                  value={priceChange}\n                  onChange={(e) => setPriceChange(Number(e.target.value))}\n                  className=\"w-full h-2 bg-gradient-to-r from-red-500 to-green-500 rounded-lg appearance-none cursor-pointer\"\n                />\n                <div className={`flex justify-between text-xs mt-1 ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>\n                  <span>-20%</span>\n                  <span>0%</span>\n                  <span>+20%</span>\n                </div>\n              </div>\n\n              <div>\n                <label className={`block text-sm font-semibold mb-2 ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>\n                  Volume Change: {volumeChange}%\n                </label>\n                <input\n                  type=\"range\"\n                  min=\"-30\"\n                  max=\"30\"\n                  value={volumeChange}\n                  onChange={(e) => setVolumeChange(Number(e.target.value))}\n                  className=\"w-full h-2 bg-gradient-to-r from-blue-500 to-purple-500 rounded-lg appearance-none cursor-pointer\"\n                />\n                <div className={`flex justify-between text-xs mt-1 ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>\n                  <span>-30%</span>\n                  <span>0%</span>\n                  <span>+30%</span>\n                </div>\n              </div>\n\n              <button\n                onClick={handleSimulate}\n                disabled={loading}\n                className={`w-full py-3 px-4 rounded-lg font-semibold flex items-center justify-center gap-2 transition-all ${\n                  loading\n                    ? darkMode ? 'bg-slate-700 text-gray-500' : 'bg-gray-300 text-gray-500'\n                    : darkMode\n                    ? 'bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white'\n                    : 'bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 text-white shadow-md'\n                }`}\n              >\n                <Zap size={18} />\n                {loading ? 'Simulating...' : 'Simulate Scenario'}\n              </button>\n            </>\n          ) : (\n            <div className=\"space-y-4\">\n              <div className={`p-4 rounded-lg ${darkMode ? 'bg-slate-900' : 'bg-gray-50'}`}>\n                <div className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-600'}`}>Scenario Results</div>\n                <div className={`text-2xl font-bold mt-2 flex items-center gap-2 ${\n                  result.revenue_change_pct >= 0 ? 'text-green-500' : 'text-red-500'\n                }`}>\n                  <TrendingUp size={24} />\n                  {result.revenue_change_pct >= 0 ? '+' : ''}{result.revenue_change_pct}%\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-3\">\n                <div className={`p-3 rounded-lg ${darkMode ? 'bg-slate-700' : 'bg-gray-100'}`}>\n                  <div className={`text-xs ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>Original Revenue</div>\n                  <div className={`font-semibold mt-1 ${darkMode ? 'text-gray-200' : 'text-gray-800'}`}>\n                    ${result.original_revenue?.toLocaleString()}\n                  </div>\n                </div>\n                <div className={`p-3 rounded-lg ${darkMode ? 'bg-slate-700' : 'bg-gray-100'}`}>\n                  <div className={`text-xs ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>New Revenue</div>\n                  <div className={`font-semibold mt-1 ${darkMode ? 'text-gray-200' : 'text-gray-800'}`}>\n                    ${result.new_revenue?.toLocaleString()}\n                  </div>\n                </div>\n              </div>\n\n              <div className={`p-3 rounded-lg border-l-4 ${\n                result.risk_level === 'high' \n                  ? darkMode ? 'bg-red-900/20 border-l-red-500' : 'bg-red-50 border-l-red-500'\n                  : result.risk_level === 'medium'\n                  ? darkMode ? 'bg-yellow-900/20 border-l-yellow-500' : 'bg-yellow-50 border-l-yellow-500'\n                  : darkMode ? 'bg-green-900/20 border-l-green-500' : 'bg-green-50 border-l-green-500'\n              }`}>\n                <div className={`text-sm font-semibold capitalize ${\n                  result.risk_level === 'high'\n                    ? darkMode ? 'text-red-300' : 'text-red-700'\n                    : result.risk_level === 'medium'\n                    ? darkMode ? 'text-yellow-300' : 'text-yellow-700'\n                    : darkMode ? 'text-green-300' : 'text-green-700'\n                }`}>\n                  Risk Level: {result.risk_level}\n                </div>\n              </div>\n\n              <button\n                onClick={() => setResult(null)}\n                className={`w-full py-2 px-4 rounded-lg font-semibold transition-all ${\n                  darkMode\n                    ? 'bg-slate-700 hover:bg-slate-600 text-white'\n                    : 'bg-gray-200 hover:bg-gray-300 text-gray-900'\n                }`}\n              >\n                Try Another Scenario\n              </button>\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default ScenarioSimulator;\n","path":null,"size_bytes":7230,"size_tokens":null},"AISalesForecasterzip/main.py":{"content":"def main():\n    print(\"Hello from repl-nix-workspace!\")\n\n\nif __name__ == \"__main__\":\n    main()\n","path":null,"size_bytes":96,"size_tokens":null},"AISalesForecasterzip/AISalesForecaster/backend/generate_demo_data.py":{"content":"import pandas as pd\nimport numpy as np\nfrom datetime import datetime, timedelta\nimport random\nimport os\n\nnp.random.seed(42)\nrandom.seed(42)\n\nPRODUCTS = [\n    {\"id\": f\"SKU{str(i).zfill(3)}\", \"name\": f\"Product {chr(65 + i // 10)}{i % 10}\", \n     \"base_price\": round(random.uniform(10, 500), 2),\n     \"category\": random.choice([\"Electronics\", \"Clothing\", \"Home\", \"Sports\", \"Food\"])}\n    for i in range(50)\n]\n\nREGIONS = [\"North\", \"South\", \"East\", \"West\"]\n\nSEASONALITY = {\n    1: 0.85,\n    2: 0.80,\n    3: 0.90,\n    4: 0.95,\n    5: 1.00,\n    6: 1.05,\n    7: 1.10,\n    8: 1.05,\n    9: 0.95,\n    10: 1.00,\n    11: 1.20,\n    12: 1.40,\n}\n\nHOLIDAYS = [\n    (1, 1),\n    (2, 14),\n    (5, 28),\n    (7, 4),\n    (9, 4),\n    (11, 24),\n    (11, 25),\n    (12, 24),\n    (12, 25),\n    (12, 31),\n]\n\n\ndef generate_demo_data(\n    start_date: str = \"2022-01-01\",\n    end_date: str = \"2023-12-31\",\n    output_path: str = \"backend/data/demo_sales.csv\"\n):\n    start = datetime.strptime(start_date, \"%Y-%m-%d\")\n    end = datetime.strptime(end_date, \"%Y-%m-%d\")\n    \n    date_range = pd.date_range(start=start, end=end, freq='D')\n    \n    records = []\n    \n    base_trend = 0\n    trend_growth = 0.0005\n    \n    for current_date in date_range:\n        base_trend += trend_growth\n        \n        seasonal_factor = SEASONALITY.get(current_date.month, 1.0)\n        \n        is_holiday = (current_date.month, current_date.day) in HOLIDAYS\n        holiday_boost = 1.3 if is_holiday else 1.0\n        \n        is_weekend = current_date.weekday() >= 5\n        weekend_factor = 1.15 if is_weekend else 1.0\n        \n        for product in PRODUCTS:\n            for region in REGIONS:\n                if random.random() > 0.7:\n                    continue\n                \n                base_units = random.randint(5, 50)\n                \n                units_sold = int(\n                    base_units \n                    * seasonal_factor \n                    * holiday_boost \n                    * weekend_factor \n                    * (1 + base_trend)\n                    * random.uniform(0.7, 1.3)\n                )\n                \n                promotion_flag = 0\n                price_discount = 1.0\n                \n                if random.random() < 0.15:\n                    promotion_flag = 1\n                    price_discount = random.uniform(0.8, 0.95)\n                    units_sold = int(units_sold * random.uniform(1.2, 1.5))\n                \n                if is_holiday and random.random() < 0.3:\n                    promotion_flag = 1\n                    price_discount = random.uniform(0.75, 0.9)\n                \n                price = round(product[\"base_price\"] * price_discount, 2)\n                \n                revenue = round(units_sold * price, 2)\n                \n                records.append({\n                    \"date\": current_date.strftime(\"%Y-%m-%d\"),\n                    \"product_id\": product[\"id\"],\n                    \"product_name\": product[\"name\"],\n                    \"region\": region,\n                    \"units_sold\": max(1, units_sold),\n                    \"revenue\": max(price, revenue),\n                    \"price\": price,\n                    \"promotion_flag\": promotion_flag,\n                })\n    \n    df = pd.DataFrame(records)\n    \n    os.makedirs(os.path.dirname(output_path), exist_ok=True)\n    df.to_csv(output_path, index=False)\n    \n    print(f\"Generated {len(df):,} records\")\n    print(f\"Date range: {df['date'].min()} to {df['date'].max()}\")\n    print(f\"Products: {df['product_id'].nunique()}\")\n    print(f\"Regions: {df['region'].nunique()}\")\n    print(f\"Total revenue: ${df['revenue'].sum():,.2f}\")\n    print(f\"Saved to: {output_path}\")\n    \n    return df\n\n\ndef generate_simple_demo(output_path: str = \"backend/data/simple_demo.csv\"):\n    start = datetime.strptime(\"2022-01-01\", \"%Y-%m-%d\")\n    end = datetime.strptime(\"2023-12-31\", \"%Y-%m-%d\")\n    date_range = pd.date_range(start=start, end=end, freq='D')\n    \n    records = []\n    base_revenue = 10000\n    \n    for current_date in date_range:\n        seasonal = SEASONALITY.get(current_date.month, 1.0)\n        trend = 1 + (current_date - start).days * 0.0003\n        noise = random.uniform(0.85, 1.15)\n        \n        revenue = base_revenue * seasonal * trend * noise\n        units = int(revenue / 25)\n        \n        records.append({\n            \"date\": current_date.strftime(\"%Y-%m-%d\"),\n            \"product_id\": \"ALL\",\n            \"product_name\": \"All Products\",\n            \"region\": \"All Regions\",\n            \"units_sold\": units,\n            \"revenue\": round(revenue, 2),\n            \"price\": 25.00,\n            \"promotion_flag\": 1 if random.random() < 0.1 else 0,\n        })\n    \n    df = pd.DataFrame(records)\n    df.to_csv(output_path, index=False)\n    \n    print(f\"Generated simple demo with {len(df)} daily records\")\n    print(f\"Saved to: {output_path}\")\n    \n    return df\n\n\nif __name__ == \"__main__\":\n    print(\"Generating full demo dataset...\")\n    generate_demo_data()\n    \n    print(\"\\nGenerating simple demo dataset...\")\n    generate_simple_demo()\n","path":null,"size_bytes":5057,"size_tokens":null},"AISalesForecasterzip/AISalesForecaster/frontend/src/index.css":{"content":"@import \"tailwindcss\";\n\n* {\n  box-sizing: border-box;\n}\n\nhtml {\n  scroll-behavior: smooth;\n}\n\nbody {\n  margin: 0;\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',\n    'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',\n    sans-serif;\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n  background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #f8fafc 100%);\n  min-height: 100vh;\n  position: relative;\n}\n\nbody::before {\n  content: '';\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: \n    radial-gradient(circle at 20% 50%, rgba(59, 130, 246, 0.1) 0%, transparent 50%),\n    radial-gradient(circle at 80% 80%, rgba(124, 58, 237, 0.1) 0%, transparent 50%);\n  pointer-events: none;\n  z-index: 0;\n}\n\n#root {\n  width: 100%;\n  min-height: 100vh;\n  position: relative;\n  z-index: 1;\n}\n\n.gradient-bg {\n  background: linear-gradient(135deg, #1e40af 0%, #7c3aed 100%);\n}\n\n.card-shadow {\n  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);\n}\n\n.professional-shadow {\n  box-shadow: 0 20px 40px -15px rgba(0, 0, 0, 0.15);\n}\n\n/* Premium animations */\n@keyframes pulse {\n  0%, 100% {\n    opacity: 1;\n  }\n  50% {\n    opacity: 0.7;\n  }\n}\n\n@keyframes fadeInUp {\n  from {\n    opacity: 0;\n    transform: translateY(20px);\n  }\n  to {\n    opacity: 1;\n    transform: translateY(0);\n  }\n}\n\n@keyframes slideIn {\n  from {\n    opacity: 0;\n    transform: translateX(-10px);\n  }\n  to {\n    opacity: 1;\n    transform: translateX(0);\n  }\n}\n\n@keyframes scaleIn {\n  from {\n    opacity: 0;\n    transform: scale(0.95);\n  }\n  to {\n    opacity: 1;\n    transform: scale(1);\n  }\n}\n\n@keyframes shimmer {\n  0% {\n    background-position: -1000px 0;\n  }\n  100% {\n    background-position: 1000px 0;\n  }\n}\n\n@keyframes glow {\n  0%, 100% {\n    box-shadow: 0 0 20px rgba(59, 130, 246, 0.3);\n  }\n  50% {\n    box-shadow: 0 0 40px rgba(124, 58, 237, 0.5);\n  }\n}\n\n.metric-card-animate {\n  animation: fadeInUp 0.6s ease-out forwards, scaleIn 0.6s ease-out;\n  opacity: 0;\n}\n\n/* Enhanced button styles */\nbutton {\n  position: relative;\n  overflow: hidden;\n}\n\nbutton::before {\n  content: '';\n  position: absolute;\n  top: 0;\n  left: -100%;\n  width: 100%;\n  height: 100%;\n  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);\n  transition: left 0.5s ease;\n}\n\nbutton:hover::before {\n  left: 100%;\n}\n\n/* Smooth transitions */\n*:not(.recharts-wrapper) {\n  transition: background-color 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease, transform 0.3s ease;\n}\n\n/* Chart styling */\n.recharts-wrapper {\n  border-radius: 0.75rem;\n}\n\n.recharts-cartesian-axis-tick {\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;\n}\n\n/* Better tooltips */\n.recharts-tooltip-wrapper {\n  outline: none;\n}\n\n.recharts-default-tooltip {\n  border-radius: 12px !important;\n  box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.15) !important;\n}\n\n/* Scrollbar styling */\n::-webkit-scrollbar {\n  width: 10px;\n  height: 10px;\n}\n\n::-webkit-scrollbar-track {\n  background: transparent;\n}\n\n::-webkit-scrollbar-thumb {\n  background: rgba(59, 130, 246, 0.5);\n  border-radius: 5px;\n  transition: background 0.3s ease;\n}\n\n::-webkit-scrollbar-thumb:hover {\n  background: rgba(59, 130, 246, 0.8);\n}\n\n/* Glassmorphism effect */\n.glass {\n  background: rgba(255, 255, 255, 0.95);\n  backdrop-filter: blur(10px);\n  border: 1px solid rgba(255, 255, 255, 0.5);\n}\n\n/* Selection styling */\n::selection {\n  background: linear-gradient(135deg, #1e40af 0%, #7c3aed 100%);\n  color: white;\n}\n\n/* Hover scale for interactive elements */\n.hover\\:scale-102:hover {\n  transform: scale(1.02);\n}\n","path":null,"size_bytes":3687,"size_tokens":null},"AISalesForecasterzip/AISalesForecaster/replit.md":{"content":"# AI Sales Forecaster & Business Insight Generator\n\n## Overview\nA production-capable prototype app that helps non-technical business users upload historical sales data, get reliable forecasts using Prophet or LightGBM models, and receive automated, actionable business insights.\n\n## Project Structure\n```\n├── backend/\n│   ├── app/\n│   │   ├── main.py          # FastAPI application entry point\n│   │   ├── models/          # Database models and Pydantic schemas\n│   │   ├── routes/          # API endpoints\n│   │   ├── services/        # Business logic (forecaster, data pipeline, insights)\n│   │   └── utils/           # Helper functions\n│   ├── tests/               # Pytest unit tests\n│   ├── data/                # Demo data and SQLite database\n│   └── generate_demo_data.py # Demo data generation script\n├── frontend/\n│   ├── src/\n│   │   ├── components/      # React components\n│   │   ├── services/        # API client\n│   │   └── App.jsx          # Main application\n│   └── package.json         # Frontend dependencies\n└── README.md                # Documentation\n```\n\n## Tech Stack\n- **Backend**: FastAPI, Python 3.11, Prophet, LightGBM, SQLite\n- **Frontend**: React, Vite, Tailwind CSS, Recharts\n- **ML/Stats**: Prophet (time-series), LightGBM (gradient boosting), scikit-learn\n\n## Running the Application\nThe app runs on two servers:\n1. **Backend API**: Port 8000 (FastAPI with Uvicorn)\n2. **Frontend**: Port 5000 (Vite dev server)\n\n## Key Features\n- CSV upload with data validation and preview\n- Configurable forecasting (3/6/12 month horizons, daily/weekly/monthly aggregation)\n- Prophet and LightGBM model options\n- Interactive charts with historical vs forecast comparison\n- Time-series decomposition (trend, seasonality)\n- Auto-generated business insights with KPIs and recommendations\n- CSV and PDF export functionality\n- Recent Sessions: View and reload previously analyzed forecast sessions\n\n## API Endpoints\n- `POST /api/upload` - Upload CSV file\n- `POST /api/forecast` - Run forecast with parameters\n- `GET /api/insights?job_id=` - Get generated insights\n- `GET /api/download?job_id=&format=csv|pdf` - Download report\n- `GET /api/recent-jobs?limit=10` - Get recent forecast sessions\n- `GET /api/job/{job_id}/full` - Get full job data with forecast and insights\n\n## Environment Variables\n- `DATABASE_PATH` - SQLite database path (default: backend/data/forecaster.db)\n- `UPLOAD_DIR` - Upload directory (default: backend/uploads)\n\n## Recent Changes\n- 2025-12-01: Added UX Enhancements:\n  - **Dark Mode Toggle**: Moon/Sun icon in header toggles dark/light theme\n  - Theme preference saved to localStorage and persists across sessions\n  - All components support dark mode with appropriate color schemes\n  - **Refresh Data Button**: Added to Upload and Preview pages for quick data reloading\n  - **Reset Button**: Added to Configuration page to reset all settings to defaults\n  - **Compare Models Button**: Added to Dashboard header for side-by-side Prophet vs LightGBM comparison\n  - Compare Models modal shows both model forecasts overlaid with metrics table\n  - **Help Tooltips**: Added contextual help icons next to key fields:\n    - Target Column, Forecast Model, Forecast Horizon on Configuration page\n    - MAE, RMSE, MAPE, Accuracy on Dashboard metrics panel\n  - Created reusable Tooltip component with hover-triggered info popups\n- 2025-11-30: Enhanced PDF & CSV Exports with All Graphs:\n  - **PDF Export** now includes:\n    - Page 1: Forecast Summary + Main Forecast Trend Chart\n    - Page 2: Residuals Chart + Historical vs Forecast Comparison\n    - Page 3: Top Products Bar Chart + Top Regions Pie Chart\n    - Page 4: Decomposition Charts (Trend + Seasonal) + Feature Importance\n    - Page 5: Business Insights & Recommendations\n    - Page 6: Complete Forecast Data Table\n  - **CSV Export** now includes:\n    - Complete forecast summary and metrics\n    - Full historical data with all columns\n    - Full forecast data with confidence intervals\n    - Feature importance rankings\n    - Top products and regions data\n    - Decomposition data (trend + seasonal)\n    - Business insights and recommendations\n  - Uses matplotlib for chart generation in PDF\n  - Professional multi-page report format\n- 2025-11-30: Added Bottom Pagination Controls to Dashboard with:\n  - Previous/Next buttons at bottom center of dashboard\n  - Page indicator dots showing current page (1/4, 2/4, 3/4, 4/4)\n  - Click dots to jump to any page\n  - Smooth scroll to top when changing pages\n  - Disabled states for first/last pages\n  - Blue gradient for Previous, Purple gradient for Next\n  - Available on all 4 dashboard pages for easy navigation\n- 2025-11-30: Cleaned Up Left Sidebar Navigation with:\n  - Removed \"Settings\" menu item\n  - Removed \"Help Center\" menu item\n  - Sidebar now shows: Dashboard, Forecast, Insights, Upload Data, Reports\n  - Cleaner, focused navigation for project needs\n- 2025-11-30: Moved \"Start Over\" Button to Left Sidebar with:\n  - Removed \"Start Over\" button from header (top right)\n  - Added \"Start Over\" button to left sidebar above Dashboard menu item\n  - Button uses amber/orange gradient for visibility\n  - Only shows when user is past the upload step\n  - Positioned above all menu items with clear separation\n- 2025-11-30: Added Comprehensive Forecast Analysis Charts with:\n  - **Page 1 (Overview)**: Main forecast chart with confidence intervals + 4 KPI cards (Revenue, Growth, Top Driver, Accuracy)\n  - **Page 2 (Detailed Analysis)**: Multiple new visualizations:\n    - Residuals chart (forecast errors visualization)\n    - Historical vs Forecast average comparison bar chart\n    - Performance metrics summary (MAE, RMSE, MAPE, Accuracy)\n    - Top Products bar chart\n    - Top Regions pie chart\n  - **Page 3 (Decomposition)**: Time-series decomposition (trend & seasonal) + Feature importance\n  - **Page 4 (Insights)**: AI-generated business insights and recommendations\n  - Expanded from 2 pages to 4 pages for comprehensive analysis\n  - All charts use glassmorphic design with gradient backgrounds\n- 2025-11-30: Redesigned Sidebar with Professional Menu (V2) with:\n  - Profile section at top with avatar and app title\n  - Menu items: Dashboard, Forecast, Insights, Upload Data, Reports, Settings, Help Center\n  - Dark slate background with gradient accents\n  - Active menu item highlighted with blue gradient\n  - Smart disabling based on data availability\n  - Menu icons from Lucide React\n  - App version info in footer\n  - Proper width (256px) for readability\n  - Smooth hover and transition effects\n- 2025-11-30: Added Vertical Left-Side Navigation with:\n  - Vertical stepper sidebar on left (Upload → Preview → Configure → Dashboard)\n  - Click any step to navigate to that page\n  - Smart disabling: steps disabled until prerequisites are met\n  - Animated step indicators with glow effects\n  - Connection lines between steps for visual flow\n  - Removed bottom pagination buttons in favor of sidebar\n  - Main content auto-adjusts with left margin for sidebar\n- 2025-11-30: Fixed LightGBM JSON Serialization Error with:\n  - Added `_clean_nan_inf()` helper method in Forecaster class\n  - Cleaned all LightGBM predictions, feature importances, and standard deviations\n  - Applied recursive NaN/infinity cleaning to all API responses\n  - LightGBM forecasts now work correctly without serialization errors\n- 2025-11-30: Added Page Navigation with:\n  - Previous/Next buttons at bottom center\n  - Page indicator dots showing current position\n  - Smooth scrolling between pages\n  - Page 1: Header + Forecast chart + KPI cards\n  - Page 2: Time Series Decomposition / Feature Importance tabs\n  - Page 3: Business Insights feed (observations + recommendations)\n  - Disabled navigation at boundaries (prev/next disabled on first/last page)\n- 2025-11-30: Dashboard Layout Reorganization (Final) with:\n  - Header: App title + Model/Horizon/Aggregation controls\n  - Main section: Large forecast chart (left) + KPI cards (right)\n  - KPI cards: Projected Revenue, Growth %, Top Driver, Accuracy\n  - Switchable tabs: Time Series Decomposition vs Feature Importance\n  - Insights feed: Key observations and actionable recommendations\n  - Footer: Export buttons (PDF/CSV)\n  - Responsive grid layout optimized for all screen sizes\n- 2025-11-30: Creative & Professional Dashboard Redesign (V2) with:\n  - Premium glassmorphism effects with backdrop blur on all cards\n  - Animated metric cards with staggered entrance animations\n  - Gradient text for headings (modern premium look)\n  - Dynamic hover effects with shadow expansion and glow\n  - Radial gradient background with ambient lighting\n  - Enhanced color schemes with gradient accents on icons\n  - Professional rounded corners (xl to 3xl) throughout\n  - Interactive decomposition chart with smooth transitions\n  - Ranked product/region cards with gradient backgrounds\n  - Custom styled scrollbar and button shine effects\n  - Premium tooltip styling with enhanced shadows\n- 2025-11-30: Professional dashboard redesign with:\n  - Enhanced gradient header with model info\n  - Color-coded accuracy metrics (green/yellow/red indicators)\n  - Improved forecast visualization with confidence intervals\n  - Professional card-based layout for KPIs\n  - Better typography and spacing\n  - Refactored feature importance and time-series decomposition\n  - Top products and regions with ranking badges\n- 2025-11-30: Added Recent Sessions feature to view and reload past forecast sessions\n- Initial project setup with full-stack implementation\n- Created backend with FastAPI, Prophet, and LightGBM models\n- Built React frontend with Recharts visualization\n- Implemented data pipeline with feature engineering\n- Added insights generator with business recommendations\n","path":null,"size_bytes":9869,"size_tokens":null},"AISalesForecasterzip/AISalesForecaster/frontend/src/main.jsx":{"content":"import { StrictMode } from 'react'\nimport { createRoot } from 'react-dom/client'\nimport './index.css'\nimport App from './App.jsx'\n\ncreateRoot(document.getElementById('root')).render(\n  <StrictMode>\n    <App />\n  </StrictMode>,\n)\n","path":null,"size_bytes":229,"size_tokens":null},"AISalesForecasterzip/AISalesForecaster/backend/app/services/__init__.py":{"content":"from .data_pipeline import DataPipeline\nfrom .forecaster import Forecaster\nfrom .insights_generator import InsightsGenerator\n","path":null,"size_bytes":125,"size_tokens":null},"AISalesForecasterzip/AISalesForecaster/frontend/src/components/FileUpload.jsx":{"content":"import { useCallback, useState, useEffect } from 'react';\nimport { useDropzone } from 'react-dropzone';\nimport { Upload, FileSpreadsheet, AlertCircle, CheckCircle, RefreshCw } from 'lucide-react';\nimport { uploadCSV } from '../services/api';\n\nfunction FileUpload({ onUploadSuccess, setLoading, setLoadingMessage, setError, darkMode, refreshCounter }) {\n  const [uploadStatus, setUploadStatus] = useState(null);\n\n  useEffect(() => {\n    if (refreshCounter) {\n      setUploadStatus(null);\n    }\n  }, [refreshCounter]);\n\n  const onDrop = useCallback(async (acceptedFiles) => {\n    const file = acceptedFiles[0];\n    if (!file) return;\n\n    if (!file.name.endsWith('.csv')) {\n      setError('Please upload a CSV file');\n      return;\n    }\n\n    setLoading(true);\n    setLoadingMessage('Uploading and validating your data...');\n    setUploadStatus('uploading');\n    setError(null);\n\n    try {\n      const data = await uploadCSV(file);\n      setUploadStatus('success');\n      \n      setTimeout(() => {\n        setLoading(false);\n        onUploadSuccess(data);\n      }, 500);\n    } catch (err) {\n      setLoading(false);\n      setUploadStatus('error');\n      setError(err.response?.data?.detail || 'Failed to upload file. Please try again.');\n    }\n  }, [onUploadSuccess, setLoading, setLoadingMessage, setError]);\n\n  const handleRefresh = () => {\n    setUploadStatus(null);\n    setError(null);\n  };\n\n  const { getRootProps, getInputProps, isDragActive } = useDropzone({\n    onDrop,\n    accept: {\n      'text/csv': ['.csv'],\n    },\n    maxFiles: 1,\n  });\n\n  return (\n    <div className=\"max-w-2xl mx-auto\">\n      <div className=\"text-center mb-8\">\n        <div className=\"flex items-center justify-center gap-4 mb-4\">\n          <h2 className={`text-2xl font-bold ${darkMode ? 'text-white' : 'text-gray-800'}`}>\n            Upload Your Sales Data\n          </h2>\n          <button\n            onClick={handleRefresh}\n            className={`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-all duration-300 hover:scale-105 ${\n              darkMode \n                ? 'bg-slate-700 hover:bg-slate-600 text-white border border-slate-600' \n                : 'bg-white hover:bg-gray-50 text-gray-700 border border-gray-200 shadow-sm'\n            }`}\n            title=\"Refresh to upload new data\"\n          >\n            <RefreshCw size={18} />\n            <span className=\"hidden sm:inline\">Refresh Data</span>\n          </button>\n        </div>\n        <p className={darkMode ? 'text-gray-300' : 'text-gray-600'}>\n          Upload a CSV file with your historical sales data to get started with forecasting\n        </p>\n      </div>\n\n      <div\n        {...getRootProps()}\n        className={`\n          border-2 border-dashed rounded-xl p-12 text-center cursor-pointer transition-all\n          ${isDragActive \n            ? 'border-blue-500 bg-blue-50' \n            : darkMode \n              ? 'border-slate-600 hover:border-blue-400 bg-slate-800 hover:bg-slate-700' \n              : 'border-gray-300 hover:border-blue-400 hover:bg-gray-50'\n          }\n          ${uploadStatus === 'error' ? 'border-red-300 bg-red-50' : ''}\n          ${uploadStatus === 'success' ? 'border-green-300 bg-green-50' : ''}\n        `}\n      >\n        <input {...getInputProps()} />\n        \n        <div className=\"flex flex-col items-center gap-4\">\n          {uploadStatus === 'success' ? (\n            <CheckCircle size={48} className=\"text-green-500\" />\n          ) : uploadStatus === 'error' ? (\n            <AlertCircle size={48} className=\"text-red-500\" />\n          ) : (\n            <div className={`p-4 rounded-full ${isDragActive ? 'bg-blue-100' : darkMode ? 'bg-slate-700' : 'bg-gray-100'}`}>\n              <Upload size={32} className={isDragActive ? 'text-blue-600' : darkMode ? 'text-gray-400' : 'text-gray-400'} />\n            </div>\n          )}\n          \n          <div>\n            <p className={`text-lg font-medium ${darkMode ? 'text-white' : 'text-gray-700'}`}>\n              {isDragActive ? 'Drop your file here' : 'Drag and drop your CSV file'}\n            </p>\n            <p className={darkMode ? 'text-gray-400 mt-1' : 'text-gray-500 mt-1'}>or click to browse</p>\n          </div>\n        </div>\n      </div>\n\n      <div className={`mt-8 rounded-xl p-6 shadow-sm border ${\n        darkMode \n          ? 'bg-slate-800 border-slate-700' \n          : 'bg-white border-gray-100'\n      }`}>\n        <div className=\"flex items-start gap-3\">\n          <FileSpreadsheet className=\"text-blue-600 mt-1\" size={24} />\n          <div>\n            <h3 className={`font-semibold mb-2 ${darkMode ? 'text-white' : 'text-gray-800'}`}>Expected CSV Format</h3>\n            <p className={`text-sm mb-3 ${darkMode ? 'text-gray-300' : 'text-gray-600'}`}>\n              Your CSV should contain the following columns:\n            </p>\n            <div className=\"grid grid-cols-2 md:grid-cols-4 gap-2 text-sm\">\n              <span className=\"px-2 py-1 bg-blue-50 text-blue-700 rounded\">date</span>\n              <span className=\"px-2 py-1 bg-blue-50 text-blue-700 rounded\">product_id</span>\n              <span className=\"px-2 py-1 bg-blue-50 text-blue-700 rounded\">region</span>\n              <span className=\"px-2 py-1 bg-blue-50 text-blue-700 rounded\">units_sold</span>\n              <span className=\"px-2 py-1 bg-blue-50 text-blue-700 rounded\">revenue</span>\n              <span className=\"px-2 py-1 bg-blue-50 text-blue-700 rounded\">price</span>\n              <span className={`px-2 py-1 rounded ${darkMode ? 'bg-slate-700 text-gray-300' : 'bg-gray-100 text-gray-600'}`}>promotion_flag*</span>\n              <span className={`px-2 py-1 rounded ${darkMode ? 'bg-slate-700 text-gray-300' : 'bg-gray-100 text-gray-600'}`}>product_name*</span>\n            </div>\n            <p className={`text-xs mt-2 ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>* Optional columns</p>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default FileUpload;\n","path":null,"size_bytes":5958,"size_tokens":null},"AISalesForecasterzip/AISalesForecaster/frontend/src/components/RecentSessions.jsx":{"content":"import { useState, useEffect } from 'react';\nimport { Clock, FileText, TrendingUp, ChevronRight, X } from 'lucide-react';\nimport { getRecentJobs, deleteJob } from '../services/api';\n\nfunction RecentSessions({ onLoadSession, darkMode }) {\n  const [recentJobs, setRecentJobs] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n\n  useEffect(() => {\n    fetchRecentJobs();\n  }, []);\n\n  const fetchRecentJobs = async () => {\n    try {\n      setLoading(true);\n      const data = await getRecentJobs(10);\n      setRecentJobs(data.jobs || []);\n    } catch (err) {\n      setError('Unable to load recent sessions');\n      console.error('Error fetching recent jobs:', err);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleDeleteJob = async (e, jobId) => {\n    e.stopPropagation();\n    if (confirm('Are you sure you want to delete this forecast?')) {\n      try {\n        await deleteJob(jobId);\n        setRecentJobs(recentJobs.filter(job => job.job_id !== jobId));\n      } catch (err) {\n        console.error('Error deleting job:', err);\n        alert('Failed to delete forecast');\n      }\n    }\n  };\n\n  const formatDate = (dateStr) => {\n    const date = new Date(dateStr);\n    const now = new Date();\n    const diffMs = now - date;\n    const diffHours = Math.floor(diffMs / (1000 * 60 * 60));\n    const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));\n\n    if (diffHours < 1) {\n      return 'Just now';\n    } else if (diffHours < 24) {\n      return `${diffHours} hour${diffHours > 1 ? 's' : ''} ago`;\n    } else if (diffDays < 7) {\n      return `${diffDays} day${diffDays > 1 ? 's' : ''} ago`;\n    } else {\n      return date.toLocaleDateString('en-US', { \n        month: 'short', \n        day: 'numeric',\n        year: date.getFullYear() !== now.getFullYear() ? 'numeric' : undefined\n      });\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className={`rounded-xl shadow-sm border p-6 ${\n        darkMode ? 'bg-slate-800 border-slate-700' : 'bg-white border-gray-100'\n      }`}>\n        <div className=\"flex items-center gap-2 mb-4\">\n          <Clock size={20} className={darkMode ? 'text-gray-500' : 'text-gray-500'} />\n          <h3 className={`text-lg font-semibold ${darkMode ? 'text-white' : 'text-gray-800'}`}>Recent Sessions</h3>\n        </div>\n        <div className=\"animate-pulse space-y-3\">\n          {[1, 2, 3].map((i) => (\n            <div key={i} className={`h-16 rounded-lg ${darkMode ? 'bg-slate-700' : 'bg-gray-100'}`}></div>\n          ))}\n        </div>\n      </div>\n    );\n  }\n\n  if (error || recentJobs.length === 0) {\n    return (\n      <div className={`rounded-xl shadow-sm border p-6 ${\n        darkMode ? 'bg-slate-800 border-slate-700' : 'bg-white border-gray-100'\n      }`}>\n        <div className=\"flex items-center gap-2 mb-4\">\n          <Clock size={20} className={darkMode ? 'text-gray-500' : 'text-gray-500'} />\n          <h3 className={`text-lg font-semibold ${darkMode ? 'text-white' : 'text-gray-800'}`}>Recent Sessions</h3>\n        </div>\n        <p className={`text-sm text-center py-4 ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>\n          {error || 'No recent sessions found. Upload a file to get started!'}\n        </p>\n      </div>\n    );\n  }\n\n  return (\n    <div className={`rounded-xl shadow-sm border p-6 ${\n      darkMode ? 'bg-slate-800 border-slate-700' : 'bg-white border-gray-100'\n    }`}>\n      <div className=\"flex items-center gap-2 mb-4\">\n        <Clock size={20} className={darkMode ? 'text-gray-500' : 'text-gray-500'} />\n        <h3 className={`text-lg font-semibold ${darkMode ? 'text-white' : 'text-gray-800'}`}>Recent Sessions</h3>\n      </div>\n      \n      <div className=\"space-y-2\">\n        {recentJobs.map((job) => (\n          <div\n            key={job.job_id}\n            className={`w-full flex items-center justify-between p-4 rounded-lg transition-colors group cursor-pointer ${\n              darkMode\n                ? 'bg-slate-700/40 hover:bg-slate-600/60'\n                : 'bg-gray-50 hover:bg-blue-50'\n            }`}\n          >\n            <div \n              onClick={() => onLoadSession(job.job_id)}\n              className=\"flex items-center gap-3 min-w-0 flex-1\"\n            >\n              <div className=\"flex-shrink-0\">\n                {job.has_forecast ? (\n                  <div className=\"w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center\">\n                    <TrendingUp size={20} className=\"text-green-600\" />\n                  </div>\n                ) : (\n                  <div className=\"w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center\">\n                    <FileText size={20} className=\"text-gray-500\" />\n                  </div>\n                )}\n              </div>\n              \n              <div className=\"min-w-0\">\n                <p className={`font-medium truncate ${darkMode ? 'text-white' : 'text-gray-800'}`}>\n                  {job.original_filename}\n                </p>\n                <div className={`flex items-center gap-3 text-sm ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>\n                  <span>{formatDate(job.created_at)}</span>\n                  <span>{job.row_count?.toLocaleString()} rows</span>\n                  {job.has_forecast && (\n                    <span className=\"text-green-500\">\n                      {job.model_type?.toUpperCase()} - {job.horizon}mo\n                    </span>\n                  )}\n                </div>\n              </div>\n            </div>\n            \n            <div className=\"flex items-center gap-2 flex-shrink-0\">\n              <ChevronRight \n                size={20} \n                className={`transition-colors ${darkMode ? 'text-gray-600 group-hover:text-blue-400' : 'text-gray-400 group-hover:text-blue-600'}`}\n              />\n              <button\n                onClick={(e) => handleDeleteJob(e, job.job_id)}\n                className={`p-1 rounded-lg opacity-0 group-hover:opacity-100 transition-all ${\n                  darkMode ? 'hover:bg-red-900/30 text-red-400' : 'hover:bg-red-100 text-red-600'\n                }`}\n                title=\"Delete forecast\"\n              >\n                <X size={20} />\n              </button>\n            </div>\n          </div>\n        ))}\n      </div>\n    </div>\n  );\n}\n\nexport default RecentSessions;\n","path":null,"size_bytes":6348,"size_tokens":null},"AISalesForecasterzip/AISalesForecaster/backend/app/services/chat_service.py":{"content":"import os\nimport json\nimport logging\nfrom typing import List, Dict, Any, Optional, Union\nfrom datetime import datetime\nfrom openai import OpenAI\n\nlogger = logging.getLogger(__name__)\n\n\nclass ChatService:\n    \"\"\"AI-powered chat service for sales forecasting insights\"\"\"\n    \n    def __init__(self, forecast_data: Optional[Dict[str, Any]] = None):\n        api_key = os.environ.get(\"OPENROUTER_API_KEY\")\n        if not api_key:\n            logger.warning(\"OPENROUTER_API_KEY not set\")\n        \n        self.client = OpenAI(\n            api_key=api_key,\n            base_url=\"https://openrouter.io/api/v1\"\n        )\n        self.model = \"openai/gpt-4-turbo\"\n        self.forecast_data = forecast_data or {}\n        self.conversation_history = []\n    \n    def _build_context(self) -> str:\n        \"\"\"Build context from forecast data\"\"\"\n        context = \"You are an AI Sales Forecasting Assistant. \"\n        \n        if self.forecast_data:\n            metrics = self.forecast_data.get('metrics', {})\n            forecast = self.forecast_data.get('forecast', [])\n            historical = self.forecast_data.get('historical', [])\n            \n            context += f\"\"\"Current Forecast Data:\n- Model Type: {self.forecast_data.get('model_type', 'Prophet')}\n- MAPE (Accuracy): {metrics.get('mape', 'N/A')}%\n- Confidence Score: {metrics.get('confidence_score', 'N/A')}%\n- Risk Level: {metrics.get('risk_level', 'N/A')}\n- Total Forecast Points: {len(forecast)}\n- Historical Data Points: {len(historical)}\n\nWhen answering questions, reference this data and provide specific insights. Be concise and actionable.\"\"\"\n        \n        return context\n    \n    def chat(self, user_message: str, conversation_history: Optional[List[Dict[str, str]]] = None) -> Dict[str, Any]:\n        \"\"\"\n        Send a message and get AI response\n        \n        Args:\n            user_message: User's message\n            conversation_history: Previous messages for context\n        \n        Returns:\n            Dictionary with response and metadata\n        \"\"\"\n        try:\n            # Build context\n            context = self._build_context()\n            \n            # Prepare messages\n            messages = []\n            \n            # Add system message with context\n            messages.append({\n                \"role\": \"system\",\n                \"content\": context\n            })\n            \n            # Add conversation history if provided\n            if conversation_history:\n                for msg in conversation_history[-10:]:  # Last 10 messages\n                    messages.append({\n                        \"role\": msg.get(\"role\", \"user\"),\n                        \"content\": msg.get(\"content\", \"\")\n                    })\n            \n            # Add current user message\n            messages.append({\n                \"role\": \"user\",\n                \"content\": user_message\n            })\n            \n            # Call OpenRouter API\n            response = self.client.chat.completions.create(\n                model=self.model,\n                messages=messages,\n                temperature=0.7,\n                max_tokens=1024\n            )\n            \n            ai_response = response.choices[0].message.content\n            \n            return {\n                'success': True,\n                'response': ai_response,\n                'timestamp': datetime.now().isoformat(),\n                'model': self.model,\n                'tokens_used': 0\n            }\n        \n        except Exception as e:\n            logger.error(f\"Chat error: {str(e)}\")\n            return {\n                'success': False,\n                'error': f\"Failed to get response: {str(e)}\",\n                'response': \"Sorry, I encountered an error. Please try again.\"\n            }\n    \n    def generate_insights_from_query(self, question: str, forecast_data: Dict) -> str:\n        \"\"\"Generate specific insights based on question\"\"\"\n        self.forecast_data = forecast_data\n        \n        queries = {\n            'forecast': 'What is the forecast trend for the next period?',\n            'growth': 'What is the growth rate trend?',\n            'seasonal': 'Explain the seasonal patterns in the data',\n            'anomaly': 'Are there any anomalies in the data?',\n            'product': 'Which products are performing best?',\n            'region': 'How are different regions performing?'\n        }\n        \n        # Map question to query type\n        query_type = 'forecast'\n        for key, pattern in queries.items():\n            if any(word in question.lower() for word in key.split()):\n                query_type = key\n                break\n        \n        response = self.chat(question)\n        return response.get('response', '')\n","path":null,"size_bytes":4717,"size_tokens":null},"AISalesForecasterzip/AISalesForecaster/backend/app/__init__.py":{"content":"","path":null,"size_bytes":0,"size_tokens":null},"AISalesForecasterzip/AISalesForecaster/backend/app/routes/upload.py":{"content":"import os\nimport pandas as pd\nfrom fastapi import APIRouter, UploadFile, File, HTTPException\nfrom typing import List\nimport logging\n\nfrom ..models.schemas import UploadResponse, ValidationResult\nfrom ..models.database import create_job, get_job, get_recent_jobs, get_job_with_forecast\nfrom ..services.data_pipeline import DataPipeline\nfrom ..utils.helpers import generate_job_id\n\nrouter = APIRouter()\nlogger = logging.getLogger(__name__)\n\nUPLOAD_DIR = os.environ.get(\"UPLOAD_DIR\", \"backend/uploads\")\nos.makedirs(UPLOAD_DIR, exist_ok=True)\n\n\n@router.post(\"/upload\", response_model=UploadResponse)\nasync def upload_csv(file: UploadFile = File(...)):\n    if not file.filename.endswith('.csv'):\n        raise HTTPException(status_code=400, detail=\"Only CSV files are accepted\")\n    \n    try:\n        contents = await file.read()\n        \n        encodings_to_try = ['utf-8', 'utf-8-sig', 'latin-1', 'cp1252', 'iso-8859-1']\n        df = None\n        last_error = None\n        \n        for encoding in encodings_to_try:\n            try:\n                df = pd.read_csv(pd.io.common.BytesIO(contents), encoding=encoding)\n                logger.info(f\"Successfully parsed CSV with encoding: {encoding}\")\n                break\n            except UnicodeDecodeError as e:\n                last_error = e\n                continue\n            except Exception as e:\n                raise HTTPException(status_code=400, detail=f\"Error parsing CSV: {str(e)}\")\n        \n        if df is None:\n            raise HTTPException(status_code=400, detail=f\"Unable to parse CSV file. Please ensure it's a valid CSV with text encoding (UTF-8, Latin-1, or Windows format).\")\n        \n        if len(df) == 0:\n            raise HTTPException(status_code=400, detail=\"CSV file is empty\")\n        \n        job_id = generate_job_id()\n        \n        file_path = os.path.join(UPLOAD_DIR, f\"{job_id}.csv\")\n        with open(file_path, 'wb') as f:\n            f.write(contents)\n        \n        pipeline = DataPipeline(df)\n        validation_result = pipeline.validate()\n        \n        all_columns, numeric_columns, categorical_columns = pipeline.get_column_info()\n        preview = pipeline.get_preview(n=10)\n        \n        date_range = validation_result.date_range or {}\n        \n        create_job(\n            job_id=job_id,\n            file_path=file_path,\n            original_filename=file.filename,\n            row_count=validation_result.row_count,\n            column_count=validation_result.column_count,\n            columns=all_columns,\n            date_range=date_range,\n            validation_result=validation_result.model_dump()\n        )\n        \n        return UploadResponse(\n            job_id=job_id,\n            validation=validation_result,\n            preview=preview,\n            columns=all_columns,\n            numeric_columns=numeric_columns,\n            categorical_columns=categorical_columns\n        )\n        \n    except HTTPException:\n        raise\n    except Exception as e:\n        logger.error(f\"Upload error: {str(e)}\")\n        raise HTTPException(status_code=500, detail=f\"Error processing file: {str(e)}\")\n\n\n@router.get(\"/job/{job_id}\")\nasync def get_job_info(job_id: str):\n    job = get_job(job_id)\n    if not job:\n        raise HTTPException(status_code=404, detail=\"Job not found\")\n    return job\n\n\n@router.get(\"/recent-jobs\")\nasync def get_recent_jobs_list(limit: int = 10):\n    jobs = get_recent_jobs(limit=min(limit, 50))\n    return {\"jobs\": jobs}\n\n\n@router.get(\"/job/{job_id}/full\")\nasync def get_job_full_data(job_id: str):\n    data = get_job_with_forecast(job_id)\n    if not data:\n        raise HTTPException(status_code=404, detail=\"Job not found\")\n    return data\n","path":null,"size_bytes":3687,"size_tokens":null},"AISalesForecasterzip/AISalesForecaster/frontend/src/services/api.js":{"content":"import axios from 'axios';\n\nconst API_BASE_URL = '/api';\n\nconst api = axios.create({\n  baseURL: API_BASE_URL,\n  headers: {\n    'Content-Type': 'application/json',\n  },\n});\n\nexport const uploadCSV = async (file) => {\n  const formData = new FormData();\n  formData.append('file', file);\n  \n  const response = await api.post('/upload', formData, {\n    headers: {\n      'Content-Type': 'multipart/form-data',\n    },\n  });\n  return response.data;\n};\n\nexport const runForecast = async (params) => {\n  const response = await api.post('/forecast', params);\n  return response.data;\n};\n\nexport const getForecast = async (jobId) => {\n  const response = await api.get(`/forecast/${jobId}`);\n  return response.data;\n};\n\nexport const getInsights = async (jobId) => {\n  const response = await api.get('/insights', {\n    params: { job_id: jobId }\n  });\n  return response.data;\n};\n\nexport const downloadReport = async (jobId, format = 'csv') => {\n  const response = await api.get('/download', {\n    params: { job_id: jobId, format },\n    responseType: 'blob',\n  });\n  \n  const blob = new Blob([response.data]);\n  const url = window.URL.createObjectURL(blob);\n  const link = document.createElement('a');\n  link.href = url;\n  link.download = `forecast_${jobId}.${format}`;\n  document.body.appendChild(link);\n  link.click();\n  document.body.removeChild(link);\n  window.URL.revokeObjectURL(url);\n};\n\nexport const getRecentJobs = async (limit = 10) => {\n  const response = await api.get('/recent-jobs', {\n    params: { limit }\n  });\n  return response.data;\n};\n\nexport const getJobFullData = async (jobId) => {\n  const response = await api.get(`/job/${jobId}/full`);\n  return response.data;\n};\n\nexport const deleteJob = async (jobId) => {\n  const response = await api.delete(`/job/${jobId}`);\n  return response.data;\n};\n\nexport const getAnomalies = async (jobId) => {\n  const response = await api.get(`/anomalies/${jobId}`);\n  return response.data;\n};\n\nexport const getRecommendations = async (jobId) => {\n  const response = await api.get(`/recommendations/${jobId}`);\n  return response.data;\n};\n\nexport const runScenario = async (jobId, params) => {\n  const response = await api.post(`/scenario/${jobId}`, params);\n  return response.data;\n};\n\nexport const chatWithAI = async (jobId, message, conversationHistory = []) => {\n  const response = await api.post(`/chat`, {\n    job_id: jobId,\n    message: message,\n    conversation_history: conversationHistory\n  });\n  return response.data;\n};\n\nexport default api;\n","path":null,"size_bytes":2486,"size_tokens":null},"AISalesForecasterzip/AISalesForecaster/frontend/src/components/DataPreview.jsx":{"content":"import { CheckCircle, AlertTriangle, Info, Calendar, Hash, Table, RefreshCw } from 'lucide-react';\n\nfunction DataPreview({ data, onRefresh, darkMode }) {\n  const { validation, preview, columns, numeric_columns, categorical_columns } = data;\n\n  return (\n    <div className=\"space-y-6\">\n      <div className={`rounded-xl shadow-sm border overflow-hidden ${\n        darkMode ? 'bg-slate-800 border-slate-700' : 'bg-white border-gray-100'\n      }`}>\n        <div className={`p-6 border-b flex items-center justify-between ${\n          darkMode ? 'border-slate-700' : 'border-gray-100'\n        }`}>\n          <div>\n            <h2 className={`text-xl font-bold ${darkMode ? 'text-white' : 'text-gray-800'}`}>Data Preview</h2>\n            <p className={darkMode ? 'text-gray-300 mt-1' : 'text-gray-600 mt-1'}>Review your uploaded data before proceeding</p>\n          </div>\n          <button\n            onClick={onRefresh}\n            className={`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-all duration-300 hover:scale-105 ${\n              darkMode \n                ? 'bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-700 hover:to-blue-700 text-white' \n                : 'bg-gradient-to-r from-cyan-500 to-blue-500 hover:from-cyan-600 hover:to-blue-600 text-white shadow-md'\n            }`}\n          >\n            <RefreshCw size={18} />\n            <span>Refresh Data</span>\n          </button>\n        </div>\n\n        <div className={`grid md:grid-cols-3 gap-4 p-6 ${darkMode ? 'bg-slate-900' : 'bg-gray-50'}`}>\n          <div className={`flex items-center gap-3 p-4 rounded-lg shadow-sm ${\n            darkMode ? 'bg-slate-800' : 'bg-white'\n          }`}>\n            <div className=\"p-2 bg-blue-100 rounded-lg\">\n              <Table size={20} className=\"text-blue-600\" />\n            </div>\n            <div>\n              <p className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>Total Rows</p>\n              <p className={`text-xl font-bold ${darkMode ? 'text-white' : 'text-gray-800'}`}>{validation.row_count.toLocaleString()}</p>\n            </div>\n          </div>\n          \n          <div className={`flex items-center gap-3 p-4 rounded-lg shadow-sm ${\n            darkMode ? 'bg-slate-800' : 'bg-white'\n          }`}>\n            <div className=\"p-2 bg-purple-100 rounded-lg\">\n              <Hash size={20} className=\"text-purple-600\" />\n            </div>\n            <div>\n              <p className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>Columns</p>\n              <p className={`text-xl font-bold ${darkMode ? 'text-white' : 'text-gray-800'}`}>{validation.column_count}</p>\n            </div>\n          </div>\n          \n          <div className={`flex items-center gap-3 p-4 rounded-lg shadow-sm ${\n            darkMode ? 'bg-slate-800' : 'bg-white'\n          }`}>\n            <div className=\"p-2 bg-green-100 rounded-lg\">\n              <Calendar size={20} className=\"text-green-600\" />\n            </div>\n            <div>\n              <p className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>Date Range</p>\n              <p className={`text-sm font-semibold ${darkMode ? 'text-white' : 'text-gray-800'}`}>\n                {validation.date_range ? \n                  `${validation.date_range.start} to ${validation.date_range.end}` : \n                  'N/A'\n                }\n              </p>\n            </div>\n          </div>\n        </div>\n\n        {(validation.errors?.length > 0 || validation.warnings?.length > 0) && (\n          <div className={`p-6 border-t space-y-3 ${darkMode ? 'border-slate-700' : 'border-gray-100'}`}>\n            {validation.errors?.map((error, idx) => (\n              <div key={idx} className=\"flex items-start gap-2 text-red-700 bg-red-50 p-3 rounded-lg\">\n                <AlertTriangle size={18} className=\"mt-0.5 flex-shrink-0\" />\n                <span>{error}</span>\n              </div>\n            ))}\n            {validation.warnings?.map((warning, idx) => (\n              <div key={idx} className=\"flex items-start gap-2 text-amber-700 bg-amber-50 p-3 rounded-lg\">\n                <Info size={18} className=\"mt-0.5 flex-shrink-0\" />\n                <span>{warning}</span>\n              </div>\n            ))}\n          </div>\n        )}\n\n        {validation.is_valid && (\n          <div className={`p-4 border-t bg-green-50 flex items-center gap-2 text-green-700 ${\n            darkMode ? 'border-slate-700' : 'border-gray-100'\n          }`}>\n            <CheckCircle size={20} />\n            <span className=\"font-medium\">Data validation passed! Ready for forecasting.</span>\n          </div>\n        )}\n      </div>\n\n      <div className={`rounded-xl shadow-sm border overflow-hidden ${\n        darkMode ? 'bg-slate-800 border-slate-700' : 'bg-white border-gray-100'\n      }`}>\n        <div className={`p-4 border-b ${darkMode ? 'border-slate-700' : 'border-gray-100'}`}>\n          <h3 className={`font-semibold ${darkMode ? 'text-white' : 'text-gray-800'}`}>Sample Data (First 10 rows)</h3>\n        </div>\n        <div className=\"overflow-x-auto\">\n          <table className=\"w-full text-sm\">\n            <thead className={darkMode ? 'bg-slate-900' : 'bg-gray-50'}>\n              <tr>\n                {columns.map((col) => (\n                  <th key={col} className={`px-4 py-3 text-left font-semibold whitespace-nowrap ${\n                    darkMode ? 'text-gray-300' : 'text-gray-700'\n                  }`}>\n                    {col}\n                    <span className={`ml-2 text-xs px-1.5 py-0.5 rounded ${\n                      numeric_columns.includes(col) \n                        ? 'bg-blue-100 text-blue-700' \n                        : darkMode ? 'bg-slate-700 text-gray-400' : 'bg-gray-200 text-gray-600'\n                    }`}>\n                      {numeric_columns.includes(col) ? 'num' : 'text'}\n                    </span>\n                  </th>\n                ))}\n              </tr>\n            </thead>\n            <tbody className={`divide-y ${darkMode ? 'divide-slate-700' : 'divide-gray-100'}`}>\n              {preview.map((row, idx) => (\n                <tr key={idx} className={darkMode ? 'hover:bg-slate-700' : 'hover:bg-gray-50'}>\n                  {columns.map((col) => (\n                    <td key={col} className={`px-4 py-3 whitespace-nowrap ${\n                      darkMode ? 'text-gray-300' : 'text-gray-600'\n                    }`}>\n                      {row[col] !== null && row[col] !== undefined ? String(row[col]) : '-'}\n                    </td>\n                  ))}\n                </tr>\n              ))}\n            </tbody>\n          </table>\n        </div>\n      </div>\n\n      <div className={`rounded-xl shadow-sm border p-6 ${\n        darkMode ? 'bg-slate-800 border-slate-700' : 'bg-white border-gray-100'\n      }`}>\n        <h3 className={`font-semibold mb-4 ${darkMode ? 'text-white' : 'text-gray-800'}`}>Column Summary</h3>\n        <div className=\"grid md:grid-cols-2 gap-6\">\n          <div>\n            <h4 className={`text-sm font-medium mb-2 ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>Numeric Columns ({numeric_columns.length})</h4>\n            <div className=\"flex flex-wrap gap-2\">\n              {numeric_columns.map((col) => (\n                <span key={col} className=\"px-3 py-1 bg-blue-50 text-blue-700 rounded-full text-sm\">\n                  {col}\n                </span>\n              ))}\n            </div>\n          </div>\n          <div>\n            <h4 className={`text-sm font-medium mb-2 ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>Categorical Columns ({categorical_columns.length})</h4>\n            <div className=\"flex flex-wrap gap-2\">\n              {categorical_columns.map((col) => (\n                <span key={col} className=\"px-3 py-1 bg-purple-50 text-purple-700 rounded-full text-sm\">\n                  {col}\n                </span>\n              ))}\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default DataPreview;\n","path":null,"size_bytes":8006,"size_tokens":null},"AISalesForecasterzip/AISalesForecaster/frontend/vite.config.js":{"content":"import { defineConfig } from 'vite'\nimport react from '@vitejs/plugin-react'\n\nexport default defineConfig({\n  plugins: [react()],\n  server: {\n    host: '0.0.0.0',\n    port: 5000,\n    allowedHosts: true,\n    proxy: {\n      '/api': {\n        target: 'http://localhost:8000',\n        changeOrigin: true,\n      }\n    }\n  }\n})\n","path":null,"size_bytes":322,"size_tokens":null},"AISalesForecasterzip/AISalesForecaster/frontend/src/components/LoadingOverlay.jsx":{"content":"import { Loader2, BarChart3 } from 'lucide-react';\n\nfunction LoadingOverlay({ message = 'Processing...' }) {\n  return (\n    <div className=\"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center\">\n      <div className=\"bg-white rounded-2xl p-8 shadow-2xl max-w-sm w-full mx-4 text-center\">\n        <div className=\"relative w-20 h-20 mx-auto mb-4\">\n          <div className=\"absolute inset-0 bg-blue-100 rounded-full animate-ping opacity-75\"></div>\n          <div className=\"relative flex items-center justify-center w-20 h-20 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full\">\n            <BarChart3 size={32} className=\"text-white\" />\n          </div>\n        </div>\n        \n        <div className=\"flex items-center justify-center gap-2 mb-2\">\n          <Loader2 size={20} className=\"animate-spin text-blue-600\" />\n          <span className=\"text-lg font-semibold text-gray-800\">Please Wait</span>\n        </div>\n        \n        <p className=\"text-gray-600\">{message}</p>\n        \n        <div className=\"mt-4 h-1 bg-gray-100 rounded-full overflow-hidden\">\n          <div className=\"h-full bg-gradient-to-r from-blue-500 to-purple-600 rounded-full animate-pulse-slow w-2/3\"></div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default LoadingOverlay;\n","path":null,"size_bytes":1299,"size_tokens":null},"AISalesForecasterzip/AISalesForecaster/frontend/src/components/CompareModelsModal.jsx":{"content":"import { useState, useEffect } from 'react';\nimport { X, TrendingUp, BarChart2, Award, Loader2 } from 'lucide-react';\nimport { \n  LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, \n  ResponsiveContainer, BarChart, Bar \n} from 'recharts';\nimport { runForecast } from '../services/api';\n\nfunction CompareModelsModal({ isOpen, onClose, uploadData, currentForecast }) {\n  const [loading, setLoading] = useState(false);\n  const [comparisonData, setComparisonData] = useState(null);\n  const [error, setError] = useState(null);\n\n  useEffect(() => {\n    if (isOpen && !comparisonData) {\n      runComparison();\n    }\n  }, [isOpen]);\n\n  const runComparison = async () => {\n    if (!uploadData?.job_id) return;\n    \n    setLoading(true);\n    setError(null);\n    \n    try {\n      const otherModel = currentForecast.model_type === 'prophet' ? 'lightgbm' : 'prophet';\n      \n      const otherForecast = await runForecast({\n        job_id: uploadData.job_id,\n        model: otherModel,\n        aggregation: currentForecast.aggregation,\n        horizon: currentForecast.horizon,\n        target_column: currentForecast.target_column,\n      });\n\n      const prophetData = currentForecast.model_type === 'prophet' ? currentForecast : otherForecast;\n      const lightgbmData = currentForecast.model_type === 'lightgbm' ? currentForecast : otherForecast;\n\n      const combinedForecast = prophetData.forecast.map((p, idx) => ({\n        date: p.date,\n        prophet: p.predicted,\n        lightgbm: lightgbmData.forecast[idx]?.predicted || 0,\n      }));\n\n      setComparisonData({\n        prophet: {\n          metrics: prophetData.metrics,\n          forecast: prophetData.forecast,\n        },\n        lightgbm: {\n          metrics: lightgbmData.metrics,\n          forecast: lightgbmData.forecast,\n        },\n        combined: combinedForecast,\n      });\n    } catch (err) {\n      console.error('Comparison failed:', err);\n      setError('Failed to run model comparison. Please try again.');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  if (!isOpen) return null;\n\n  const formatNumber = (num) => {\n    if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';\n    if (num >= 1000) return (num / 1000).toFixed(1) + 'K';\n    return num?.toFixed(2);\n  };\n\n  const metricsData = comparisonData ? [\n    { metric: 'MAE', Prophet: comparisonData.prophet.metrics.mae, LightGBM: comparisonData.lightgbm.metrics.mae },\n    { metric: 'RMSE', Prophet: comparisonData.prophet.metrics.rmse, LightGBM: comparisonData.lightgbm.metrics.rmse },\n    { metric: 'MAPE', Prophet: comparisonData.prophet.metrics.mape, LightGBM: comparisonData.lightgbm.metrics.mape },\n  ] : [];\n\n  const getBetterModel = () => {\n    if (!comparisonData) return null;\n    const prophetMape = comparisonData.prophet.metrics.mape || 0;\n    const lightgbmMape = comparisonData.lightgbm.metrics.mape || 0;\n    return prophetMape < lightgbmMape ? 'Prophet' : 'LightGBM';\n  };\n\n  return (\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm\">\n      <div className=\"bg-white rounded-2xl shadow-2xl w-full max-w-5xl max-h-[90vh] overflow-hidden\">\n        <div className=\"flex items-center justify-between p-6 border-b border-gray-200 bg-gradient-to-r from-blue-600 to-purple-600 text-white\">\n          <div className=\"flex items-center gap-3\">\n            <BarChart2 size={28} />\n            <div>\n              <h2 className=\"text-xl font-bold\">Model Comparison</h2>\n              <p className=\"text-blue-100 text-sm\">Prophet vs LightGBM</p>\n            </div>\n          </div>\n          <button\n            onClick={onClose}\n            className=\"p-2 hover:bg-white/20 rounded-lg transition-colors\"\n          >\n            <X size={24} />\n          </button>\n        </div>\n\n        <div className=\"p-6 overflow-y-auto max-h-[calc(90vh-100px)]\">\n          {loading && (\n            <div className=\"flex flex-col items-center justify-center py-20\">\n              <Loader2 size={48} className=\"text-blue-600 animate-spin mb-4\" />\n              <p className=\"text-gray-600\">Running comparison forecast...</p>\n              <p className=\"text-gray-400 text-sm mt-1\">This may take a moment</p>\n            </div>\n          )}\n\n          {error && (\n            <div className=\"bg-red-50 border border-red-200 rounded-lg p-4 text-red-700 mb-6\">\n              {error}\n              <button \n                onClick={runComparison}\n                className=\"ml-4 text-red-600 underline hover:text-red-800\"\n              >\n                Retry\n              </button>\n            </div>\n          )}\n\n          {comparisonData && !loading && (\n            <div className=\"space-y-8\">\n              {getBetterModel() && (\n                <div className=\"bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200 rounded-xl p-6 flex items-center gap-4\">\n                  <div className=\"w-14 h-14 bg-gradient-to-br from-green-500 to-emerald-500 rounded-2xl flex items-center justify-center shadow-lg\">\n                    <Award size={28} className=\"text-white\" />\n                  </div>\n                  <div>\n                    <p className=\"text-sm text-green-600 font-semibold uppercase tracking-wide\">Recommended Model</p>\n                    <p className=\"text-2xl font-bold text-green-900\">{getBetterModel()}</p>\n                    <p className=\"text-sm text-green-700\">Based on lower MAPE (Mean Absolute Percentage Error)</p>\n                  </div>\n                </div>\n              )}\n\n              <div className=\"grid md:grid-cols-2 gap-6\">\n                <div className=\"bg-blue-50 border border-blue-200 rounded-xl p-6\">\n                  <h3 className=\"text-lg font-bold text-blue-900 mb-4 flex items-center gap-2\">\n                    <TrendingUp size={20} />\n                    Prophet Metrics\n                  </h3>\n                  <div className=\"space-y-3\">\n                    <div className=\"flex justify-between items-center\">\n                      <span className=\"text-blue-700\">MAE</span>\n                      <span className=\"font-bold text-blue-900\">{comparisonData.prophet.metrics.mae?.toFixed(2)}</span>\n                    </div>\n                    <div className=\"flex justify-between items-center\">\n                      <span className=\"text-blue-700\">RMSE</span>\n                      <span className=\"font-bold text-blue-900\">{comparisonData.prophet.metrics.rmse?.toFixed(2)}</span>\n                    </div>\n                    <div className=\"flex justify-between items-center\">\n                      <span className=\"text-blue-700\">MAPE</span>\n                      <span className=\"font-bold text-blue-900\">{comparisonData.prophet.metrics.mape?.toFixed(2)}%</span>\n                    </div>\n                    <div className=\"flex justify-between items-center pt-2 border-t border-blue-200\">\n                      <span className=\"text-blue-700 font-semibold\">Accuracy</span>\n                      <span className=\"font-bold text-blue-900 text-lg\">{(100 - comparisonData.prophet.metrics.mape).toFixed(1)}%</span>\n                    </div>\n                  </div>\n                </div>\n\n                <div className=\"bg-purple-50 border border-purple-200 rounded-xl p-6\">\n                  <h3 className=\"text-lg font-bold text-purple-900 mb-4 flex items-center gap-2\">\n                    <TrendingUp size={20} />\n                    LightGBM Metrics\n                  </h3>\n                  <div className=\"space-y-3\">\n                    <div className=\"flex justify-between items-center\">\n                      <span className=\"text-purple-700\">MAE</span>\n                      <span className=\"font-bold text-purple-900\">{comparisonData.lightgbm.metrics.mae?.toFixed(2)}</span>\n                    </div>\n                    <div className=\"flex justify-between items-center\">\n                      <span className=\"text-purple-700\">RMSE</span>\n                      <span className=\"font-bold text-purple-900\">{comparisonData.lightgbm.metrics.rmse?.toFixed(2)}</span>\n                    </div>\n                    <div className=\"flex justify-between items-center\">\n                      <span className=\"text-purple-700\">MAPE</span>\n                      <span className=\"font-bold text-purple-900\">{comparisonData.lightgbm.metrics.mape?.toFixed(2)}%</span>\n                    </div>\n                    <div className=\"flex justify-between items-center pt-2 border-t border-purple-200\">\n                      <span className=\"text-purple-700 font-semibold\">Accuracy</span>\n                      <span className=\"font-bold text-purple-900 text-lg\">{(100 - comparisonData.lightgbm.metrics.mape).toFixed(1)}%</span>\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <div className=\"bg-white border border-gray-200 rounded-xl p-6\">\n                <h3 className=\"text-lg font-bold text-gray-900 mb-4\">Metrics Comparison</h3>\n                <ResponsiveContainer width=\"100%\" height={250}>\n                  <BarChart data={metricsData}>\n                    <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#e5e7eb\" vertical={false} />\n                    <XAxis dataKey=\"metric\" tick={{ fontSize: 12 }} />\n                    <YAxis tick={{ fontSize: 12 }} />\n                    <Tooltip />\n                    <Legend />\n                    <Bar dataKey=\"Prophet\" fill=\"#3b82f6\" radius={[8, 8, 0, 0]} />\n                    <Bar dataKey=\"LightGBM\" fill=\"#8b5cf6\" radius={[8, 8, 0, 0]} />\n                  </BarChart>\n                </ResponsiveContainer>\n              </div>\n\n              <div className=\"bg-white border border-gray-200 rounded-xl p-6\">\n                <h3 className=\"text-lg font-bold text-gray-900 mb-4\">Forecast Trend Overlay</h3>\n                <ResponsiveContainer width=\"100%\" height={300}>\n                  <LineChart data={comparisonData.combined}>\n                    <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#e5e7eb\" vertical={false} />\n                    <XAxis \n                      dataKey=\"date\" \n                      tick={{ fontSize: 11 }}\n                      tickFormatter={(value) => {\n                        const date = new Date(value);\n                        return date.toLocaleDateString('en-US', { month: 'short', year: '2-digit' });\n                      }}\n                    />\n                    <YAxis tick={{ fontSize: 11 }} tickFormatter={formatNumber} />\n                    <Tooltip formatter={(value) => formatNumber(value)} />\n                    <Legend />\n                    <Line \n                      type=\"monotone\" \n                      dataKey=\"prophet\" \n                      stroke=\"#3b82f6\" \n                      strokeWidth={3}\n                      dot={false}\n                      name=\"Prophet\"\n                    />\n                    <Line \n                      type=\"monotone\" \n                      dataKey=\"lightgbm\" \n                      stroke=\"#8b5cf6\" \n                      strokeWidth={3}\n                      strokeDasharray=\"5 5\"\n                      dot={false}\n                      name=\"LightGBM\"\n                    />\n                  </LineChart>\n                </ResponsiveContainer>\n              </div>\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default CompareModelsModal;\n","path":null,"size_bytes":11376,"size_tokens":null},"AISalesForecasterzip/AISalesForecaster/backend/app/utils/holidays.py":{"content":"import pandas as pd\nfrom datetime import datetime, date\nfrom typing import List, Dict\n\nUS_HOLIDAYS = {\n    (1, 1): \"New Year's Day\",\n    (7, 4): \"Independence Day\",\n    (12, 25): \"Christmas Day\",\n    (11, 11): \"Veterans Day\",\n    (12, 31): \"New Year's Eve\",\n}\n\nFLOATING_HOLIDAYS = [\n    {\"name\": \"Martin Luther King Jr. Day\", \"month\": 1, \"week\": 3, \"weekday\": 0},\n    {\"name\": \"Presidents Day\", \"month\": 2, \"week\": 3, \"weekday\": 0},\n    {\"name\": \"Memorial Day\", \"month\": 5, \"week\": -1, \"weekday\": 0},\n    {\"name\": \"Labor Day\", \"month\": 9, \"week\": 1, \"weekday\": 0},\n    {\"name\": \"Thanksgiving\", \"month\": 11, \"week\": 4, \"weekday\": 3},\n    {\"name\": \"Black Friday\", \"month\": 11, \"week\": 4, \"weekday\": 4},\n]\n\n\ndef get_nth_weekday_of_month(year: int, month: int, weekday: int, n: int) -> date:\n    if n > 0:\n        first_day = date(year, month, 1)\n        first_weekday = first_day.weekday()\n        days_until = (weekday - first_weekday) % 7\n        first_occurrence = first_day.replace(day=1 + days_until)\n        return first_occurrence.replace(day=first_occurrence.day + (n - 1) * 7)\n    else:\n        if month == 12:\n            next_month = date(year + 1, 1, 1)\n        else:\n            next_month = date(year, month + 1, 1)\n        last_day = (next_month - pd.Timedelta(days=1)).day\n        last_date = date(year, month, last_day)\n        last_weekday = last_date.weekday()\n        days_back = (last_weekday - weekday) % 7\n        return last_date.replace(day=last_date.day - days_back)\n\n\ndef get_holidays_for_year(year: int) -> Dict[date, str]:\n    holidays = {}\n    \n    for (month, day), name in US_HOLIDAYS.items():\n        try:\n            holidays[date(year, month, day)] = name\n        except ValueError:\n            pass\n    \n    for holiday in FLOATING_HOLIDAYS:\n        try:\n            holiday_date = get_nth_weekday_of_month(\n                year, holiday[\"month\"], holiday[\"weekday\"], holiday[\"week\"]\n            )\n            holidays[holiday_date] = holiday[\"name\"]\n        except (ValueError, AttributeError):\n            pass\n    \n    return holidays\n\n\ndef get_holiday_flags(dates: pd.Series) -> pd.DataFrame:\n    dates = pd.to_datetime(dates)\n    years = dates.dt.year.unique()\n    \n    all_holidays = {}\n    for year in years:\n        all_holidays.update(get_holidays_for_year(year))\n    \n    result = pd.DataFrame({\n        'date': dates,\n        'is_holiday': dates.dt.date.isin(all_holidays.keys()).astype(int),\n        'holiday_name': dates.dt.date.map(lambda x: all_holidays.get(x, ''))\n    })\n    \n    result['days_to_holiday'] = 0\n    result['days_from_holiday'] = 0\n    \n    holiday_dates = sorted(all_holidays.keys())\n    \n    for idx, row in result.iterrows():\n        current_date = row['date'].date()\n        \n        future_holidays = [h for h in holiday_dates if h > current_date]\n        if future_holidays:\n            result.at[idx, 'days_to_holiday'] = (future_holidays[0] - current_date).days\n        \n        past_holidays = [h for h in holiday_dates if h < current_date]\n        if past_holidays:\n            result.at[idx, 'days_from_holiday'] = (current_date - past_holidays[-1]).days\n    \n    return result[['is_holiday', 'holiday_name', 'days_to_holiday', 'days_from_holiday']]\n","path":null,"size_bytes":3225,"size_tokens":null},"main.py":{"content":"def main():\n    print(\"Hello from repl-nix-workspace!\")\n\n\nif __name__ == \"__main__\":\n    main()\n","path":null,"size_bytes":96,"size_tokens":null},"AISalesForecasterzip/AISalesForecaster/frontend/src/components/RecommendationCards.jsx":{"content":"import { Lightbulb, TrendingUp, AlertCircle, Target } from 'lucide-react';\n\nfunction RecommendationCards({ recommendations, darkMode }) {\n  if (!recommendations || recommendations.length === 0) {\n    return null;\n  }\n\n  const getIcon = (id) => {\n    switch(id) {\n      case 'price_optimize': return <TrendingUp size={20} />;\n      case 'promotional_discount': return <Target size={20} />;\n      case 'inventory_buffer': return <AlertCircle size={20} />;\n      case 'seasonal_campaign': return <Lightbulb size={20} />;\n      default: return <Lightbulb size={20} />;\n    }\n  };\n\n  const getImpactColor = (impact) => {\n    switch(impact) {\n      case 'high': return darkMode ? 'from-red-600 to-orange-600' : 'from-red-500 to-orange-500';\n      case 'medium': return darkMode ? 'from-blue-600 to-purple-600' : 'from-blue-500 to-purple-500';\n      default: return darkMode ? 'from-green-600 to-emerald-600' : 'from-green-500 to-emerald-500';\n    }\n  };\n\n  return (\n    <div className=\"mt-6 grid grid-cols-1 md:grid-cols-2 gap-4\">\n      <h4 className=\"col-span-full font-semibold mb-2 flex items-center gap-2\">\n        <Lightbulb size={20} className={darkMode ? 'text-yellow-400' : 'text-yellow-600'} />\n        🤖 AI Revenue Recommendations\n      </h4>\n      \n      {recommendations.map((rec) => (\n        <div\n          key={rec.id}\n          className={`p-4 rounded-lg border-l-4 transition-all ${\n            darkMode\n              ? `bg-slate-800 border-l-blue-500 hover:bg-slate-750`\n              : `bg-white border-l-blue-500 hover:shadow-lg`\n          }`}\n        >\n          <div className=\"flex items-start gap-3\">\n            <div className={`p-2 rounded-lg bg-gradient-to-r ${getImpactColor(rec.impact)}`}>\n              {getIcon(rec.id)}\n            </div>\n            <div className=\"flex-1\">\n              <h5 className={`font-semibold ${darkMode ? 'text-white' : 'text-gray-900'}`}>\n                {rec.title}\n              </h5>\n              <p className={`text-sm mt-1 ${darkMode ? 'text-gray-300' : 'text-gray-600'}`}>\n                {rec.description}\n              </p>\n              <div className={`mt-2 flex items-center justify-between text-xs ${\n                darkMode ? 'text-green-400' : 'text-green-700'\n              }`}>\n                <span className=\"font-medium\">{rec.action}</span>\n                <span className=\"font-bold\">{rec.expected_uplift}</span>\n              </div>\n            </div>\n          </div>\n        </div>\n      ))}\n    </div>\n  );\n}\n\nexport default RecommendationCards;\n","path":null,"size_bytes":2529,"size_tokens":null},"AISalesForecasterzip/AISalesForecaster/backend/app/routes/forecast.py":{"content":"import os\nimport pandas as pd\nimport numpy as np\nfrom fastapi import APIRouter, HTTPException\nfrom typing import Optional, Any\nimport logging\n\nfrom ..models.schemas import (\n    ForecastRequest, ForecastResponse, ModelType, AggregationType\n)\nfrom ..models.database import (\n    get_job, update_job_status, save_forecast, get_latest_forecast\n)\nfrom ..services.data_pipeline import DataPipeline\nfrom ..services.forecaster import Forecaster\n\nrouter = APIRouter()\nlogger = logging.getLogger(__name__)\n\n\ndef clean_nan_inf(obj: Any) -> Any:\n    \"\"\"Recursively clean NaN and infinity values from nested structures for JSON serialization\"\"\"\n    if isinstance(obj, dict):\n        return {k: clean_nan_inf(v) for k, v in obj.items()}\n    elif isinstance(obj, list):\n        return [clean_nan_inf(item) for item in obj]\n    elif isinstance(obj, float):\n        if np.isnan(obj) or np.isinf(obj):\n            return 0.0\n        return obj\n    else:\n        return obj\n\n\n@router.post(\"/forecast\", response_model=ForecastResponse)\nasync def run_forecast(request: ForecastRequest):\n    job = get_job(request.job_id)\n    if not job:\n        raise HTTPException(status_code=404, detail=\"Job not found. Please upload a file first.\")\n    \n    if not os.path.exists(job['file_path']):\n        raise HTTPException(status_code=404, detail=\"Data file not found\")\n    \n    try:\n        update_job_status(request.job_id, 'processing')\n        \n        encodings_to_try = ['utf-8', 'utf-8-sig', 'latin-1', 'cp1252', 'iso-8859-1']\n        df = None\n        for encoding in encodings_to_try:\n            try:\n                df = pd.read_csv(job['file_path'], encoding=encoding)\n                logger.info(f\"Successfully parsed forecast CSV with encoding: {encoding}\")\n                break\n            except UnicodeDecodeError:\n                continue\n        \n        if df is None:\n            raise HTTPException(status_code=400, detail=\"Unable to parse CSV file with any known encoding\")\n        \n        pipeline = DataPipeline(df)\n        processed_df = pipeline.prepare_for_modeling(\n            aggregation=request.aggregation,\n            target_column=request.target_column,\n            group_by=request.group_by\n        )\n        \n        if request.target_column not in processed_df.columns:\n            raise HTTPException(\n                status_code=400, \n                detail=f\"Target column '{request.target_column}' not found in data\"\n            )\n        \n        forecaster = Forecaster(processed_df, request.target_column)\n        results = forecaster.forecast(\n            model_type=request.model,\n            horizon=request.horizon,\n            aggregation=request.aggregation\n        )\n        \n        top_products = None\n        top_regions = None\n        \n        if 'product_name' in df.columns or 'product_id' in df.columns:\n            product_col = 'product_name' if 'product_name' in df.columns else 'product_id'\n            top_products = pipeline.get_top_by_column(df, product_col, request.target_column, n=5)\n        \n        if 'region' in df.columns:\n            top_regions = pipeline.get_top_by_column(df, 'region', request.target_column, n=5)\n        \n        save_forecast(\n            job_id=request.job_id,\n            model_type=request.model.value,\n            aggregation=request.aggregation.value,\n            horizon=request.horizon,\n            target_column=request.target_column,\n            group_by=request.group_by,\n            metrics=results['metrics'].model_dump(),\n            forecast_data=[f.model_dump() for f in results['forecast']],\n            historical_data=[h.model_dump() for h in results['historical']],\n            decomposition_data=results['decomposition'].model_dump() if results['decomposition'] else None,\n            feature_importance=[fi.model_dump() for fi in results['feature_importance']] if results['feature_importance'] else None,\n            top_products=top_products,\n            top_regions=top_regions\n        )\n        \n        update_job_status(request.job_id, 'completed')\n        \n        # Clean NaN/infinity values from response data\n        metrics_dict = clean_nan_inf(results['metrics'].model_dump())\n        forecast_data = clean_nan_inf([f.model_dump() for f in results['forecast']])\n        historical_data = clean_nan_inf([h.model_dump() for h in results['historical']])\n        decomp_data = clean_nan_inf(results['decomposition'].model_dump()) if results['decomposition'] else None\n        feat_imp = clean_nan_inf([fi.model_dump() for fi in results['feature_importance']]) if results['feature_importance'] else None\n        \n        return ForecastResponse(\n            job_id=request.job_id,\n            model_type=request.model.value,\n            aggregation=request.aggregation.value,\n            horizon=request.horizon,\n            target_column=request.target_column,\n            metrics=metrics_dict,\n            forecast=forecast_data,\n            historical=historical_data,\n            decomposition=decomp_data,\n            feature_importance=feat_imp,\n            top_products=top_products,\n            top_regions=top_regions\n        )\n        \n    except HTTPException:\n        raise\n    except Exception as e:\n        logger.error(f\"Forecast error: {str(e)}\")\n        update_job_status(request.job_id, 'error')\n        raise HTTPException(status_code=500, detail=f\"Forecasting error: {str(e)}\")\n\n\n@router.get(\"/forecast/{job_id}\")\nasync def get_forecast(job_id: str):\n    forecast = get_latest_forecast(job_id)\n    if not forecast:\n        raise HTTPException(status_code=404, detail=\"No forecast found for this job\")\n    \n    return {\n        'job_id': job_id,\n        'model_type': forecast['model_type'],\n        'aggregation': forecast['aggregation'],\n        'horizon': forecast['horizon'],\n        'target_column': forecast['target_column'],\n        'metrics': forecast['metrics'],\n        'forecast': forecast['forecast_data'],\n        'historical': forecast['historical_data'],\n        'decomposition': forecast['decomposition_data'],\n        'feature_importance': forecast['feature_importance'],\n        'top_products': forecast['top_products'],\n        'top_regions': forecast['top_regions'],\n        'created_at': forecast['created_at']\n    }\n","path":null,"size_bytes":6253,"size_tokens":null},"AISalesForecasterzip/AISalesForecaster/frontend/README.md":{"content":"# React + Vite\n\nThis template provides a minimal setup to get React working in Vite with HMR and some ESLint rules.\n\nCurrently, two official plugins are available:\n\n- [@vitejs/plugin-react](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react) uses [Babel](https://babeljs.io/) (or [oxc](https://oxc.rs) when used in [rolldown-vite](https://vite.dev/guide/rolldown)) for Fast Refresh\n- [@vitejs/plugin-react-swc](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react-swc) uses [SWC](https://swc.rs/) for Fast Refresh\n\n## React Compiler\n\nThe React Compiler is not enabled on this template because of its impact on dev & build performances. To add it, see [this documentation](https://react.dev/learn/react-compiler/installation).\n\n## Expanding the ESLint configuration\n\nIf you are developing a production application, we recommend using TypeScript with type-aware lint rules enabled. Check out the [TS template](https://github.com/vitejs/vite/tree/main/packages/create-vite/template-react-ts) for information on how to integrate TypeScript and [`typescript-eslint`](https://typescript-eslint.io) in your project.\n","path":null,"size_bytes":1157,"size_tokens":null},"AISalesForecasterzip/AISalesForecaster/frontend/src/components/InsightsCard.jsx":{"content":"import { \n  Lightbulb, TrendingUp, TrendingDown, Minus, \n  CheckCircle, AlertTriangle, Info, Download,\n  DollarSign, Calendar, Package, Zap\n} from 'lucide-react';\nimport { downloadReport } from '../services/api';\n\nfunction InsightsCard({ insights, jobId }) {\n  const { title, summary, kpis, bullets, recommendations } = insights;\n\n  const getIconComponent = (iconName) => {\n    const icons = {\n      'chart-line': TrendingUp,\n      'trending-up': TrendingUp,\n      'trending-down': TrendingDown,\n      'calendar': Calendar,\n      'calendar-check': Calendar,\n      'check-circle': CheckCircle,\n      'check': CheckCircle,\n      'alert-triangle': AlertTriangle,\n      'zap': Zap,\n      'minus': Minus,\n      'info': Info,\n    };\n    return icons[iconName] || Info;\n  };\n\n  const getSeverityStyles = (severity) => {\n    const styles = {\n      success: 'bg-green-50 border-green-200 text-green-800',\n      warning: 'bg-amber-50 border-amber-200 text-amber-800',\n      info: 'bg-blue-50 border-blue-200 text-blue-800',\n      error: 'bg-red-50 border-red-200 text-red-800',\n    };\n    return styles[severity] || styles.info;\n  };\n\n  const getTrendIcon = (trend) => {\n    if (trend === 'up') return <TrendingUp size={16} className=\"text-green-500\" />;\n    if (trend === 'down') return <TrendingDown size={16} className=\"text-red-500\" />;\n    return <Minus size={16} className=\"text-gray-400\" />;\n  };\n\n  const getPriorityStyles = (priority) => {\n    const styles = {\n      high: 'border-red-200 bg-red-50',\n      medium: 'border-amber-200 bg-amber-50',\n      low: 'border-blue-200 bg-blue-50',\n    };\n    return styles[priority] || styles.medium;\n  };\n\n  const getCategoryIcon = (category) => {\n    const icons = {\n      'Inventory': Package,\n      'Promotion': Zap,\n      'Pricing': DollarSign,\n      'Data Quality': Info,\n    };\n    const Icon = icons[category] || Lightbulb;\n    return <Icon size={20} />;\n  };\n\n  const handleDownload = async () => {\n    try {\n      await downloadReport(jobId, 'pdf');\n    } catch (err) {\n      console.error('Download failed:', err);\n    }\n  };\n\n  return (\n    <div className=\"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden\">\n      <div className=\"gradient-bg p-6 text-white\">\n        <div className=\"flex items-start justify-between\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"p-2 bg-white/20 rounded-lg\">\n              <Lightbulb size={24} />\n            </div>\n            <div>\n              <h2 className=\"text-xl font-bold\">{title}</h2>\n              <p className=\"text-blue-100 text-sm\">AI-Generated Business Insights</p>\n            </div>\n          </div>\n          <button\n            onClick={handleDownload}\n            className=\"flex items-center gap-2 px-4 py-2 bg-white/20 rounded-lg hover:bg-white/30 transition-colors\"\n          >\n            <Download size={18} />\n            Download Report\n          </button>\n        </div>\n      </div>\n\n      <div className=\"p-6 space-y-6\">\n        <div className=\"bg-gray-50 rounded-lg p-4\">\n          <p className=\"text-gray-700 leading-relaxed\">{summary}</p>\n        </div>\n\n        <div>\n          <h3 className=\"font-semibold text-gray-800 mb-4\">Key Performance Indicators</h3>\n          <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n            {kpis.map((kpi, idx) => (\n              <div key={idx} className=\"bg-gray-50 rounded-lg p-4\">\n                <div className=\"flex items-center justify-between mb-1\">\n                  <span className=\"text-sm text-gray-500\">{kpi.name}</span>\n                  {getTrendIcon(kpi.trend)}\n                </div>\n                <p className=\"text-xl font-bold text-gray-800\">{kpi.value}</p>\n                {kpi.change && (\n                  <p className=\"text-xs text-gray-500 mt-1\">{kpi.change}</p>\n                )}\n              </div>\n            ))}\n          </div>\n        </div>\n\n        <div>\n          <h3 className=\"font-semibold text-gray-800 mb-4\">Key Insights</h3>\n          <div className=\"space-y-3\">\n            {bullets.map((bullet, idx) => {\n              const Icon = getIconComponent(bullet.icon);\n              return (\n                <div \n                  key={idx} \n                  className={`flex items-start gap-3 p-4 rounded-lg border ${getSeverityStyles(bullet.severity)}`}\n                >\n                  <Icon size={20} className=\"mt-0.5 flex-shrink-0\" />\n                  <p className=\"text-sm\">{bullet.text}</p>\n                </div>\n              );\n            })}\n          </div>\n        </div>\n\n        <div>\n          <h3 className=\"font-semibold text-gray-800 mb-4\">Recommendations</h3>\n          <div className=\"grid md:grid-cols-3 gap-4\">\n            {recommendations.map((rec, idx) => (\n              <div \n                key={idx} \n                className={`p-4 rounded-lg border-2 ${getPriorityStyles(rec.priority)}`}\n              >\n                <div className=\"flex items-center gap-2 mb-2\">\n                  <span className={`p-1.5 rounded-lg ${\n                    rec.priority === 'high' ? 'bg-red-100 text-red-600' :\n                    rec.priority === 'medium' ? 'bg-amber-100 text-amber-600' :\n                    'bg-blue-100 text-blue-600'\n                  }`}>\n                    {getCategoryIcon(rec.category)}\n                  </span>\n                  <span className=\"text-xs font-medium uppercase tracking-wide text-gray-500\">\n                    {rec.category}\n                  </span>\n                </div>\n                <h4 className=\"font-semibold text-gray-800 mb-2\">{rec.title}</h4>\n                <p className=\"text-sm text-gray-600\">{rec.description}</p>\n                <div className=\"mt-3 pt-2 border-t border-gray-200\">\n                  <span className={`text-xs font-medium px-2 py-1 rounded-full ${\n                    rec.priority === 'high' ? 'bg-red-200 text-red-800' :\n                    rec.priority === 'medium' ? 'bg-amber-200 text-amber-800' :\n                    'bg-blue-200 text-blue-800'\n                  }`}>\n                    {rec.priority.toUpperCase()} PRIORITY\n                  </span>\n                </div>\n              </div>\n            ))}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default InsightsCard;\n","path":null,"size_bytes":6274,"size_tokens":null},"AISalesForecasterzip/AISalesForecaster/backend/app/models/__init__.py":{"content":"from .schemas import *\nfrom .database import *\n","path":null,"size_bytes":47,"size_tokens":null},"AISalesForecasterzip/AISalesForecaster/backend/app/routes/recommendations.py":{"content":"import logging\nimport pandas as pd\nimport json\nfrom fastapi import APIRouter, HTTPException\nfrom ..models.database import get_latest_forecast\nfrom ..services.anomaly_detector import AnomalyDetector, RecommendationEngine, ScenarioSimulator\n\nlogger = logging.getLogger(__name__)\nrouter = APIRouter()\n\n\n@router.get(\"/anomalies/{job_id}\")\nasync def get_anomalies(job_id: str):\n    \"\"\"Get detected anomalies for a forecast\"\"\"\n    try:\n        forecast = get_latest_forecast(job_id)\n        if not forecast:\n            raise HTTPException(status_code=404, detail=\"Forecast not found\")\n        \n        historical_data = json.loads(forecast['historical_data'])\n        anomalies = AnomalyDetector.detect_anomalies(\n            pd.DataFrame(historical_data),\n            value_column='actual'\n        )\n        \n        return {\n            'job_id': job_id,\n            'anomalies': anomalies,\n            'count': len(anomalies)\n        }\n    except Exception as e:\n        logger.error(f\"Error detecting anomalies: {str(e)}\")\n        raise HTTPException(status_code=500, detail=str(e))\n\n\n@router.get(\"/recommendations/{job_id}\")\nasync def get_recommendations(job_id: str):\n    \"\"\"Get AI recommendations for revenue optimization\"\"\"\n    try:\n        forecast = get_latest_forecast(job_id)\n        if not forecast:\n            raise HTTPException(status_code=404, detail=\"Forecast not found\")\n        \n        forecast_data = json.loads(forecast['forecast_data'])\n        historical_data = json.loads(forecast['historical_data'])\n        feature_importance = json.loads(forecast['feature_importance']) if forecast['feature_importance'] else None\n        \n        recommendations = RecommendationEngine.generate_recommendations(\n            forecast_data,\n            historical_data,\n            feature_importance\n        )\n        \n        return {\n            'job_id': job_id,\n            'recommendations': recommendations,\n            'count': len(recommendations)\n        }\n    except Exception as e:\n        logger.error(f\"Error generating recommendations: {str(e)}\")\n        raise HTTPException(status_code=500, detail=str(e))\n\n\n@router.post(\"/scenario/{job_id}\")\nasync def run_scenario(job_id: str, scenario_params: dict):\n    \"\"\"Simulate forecast with parameter changes\"\"\"\n    try:\n        forecast = get_latest_forecast(job_id)\n        if not forecast:\n            raise HTTPException(status_code=404, detail=\"Forecast not found\")\n        \n        forecast_data = json.loads(forecast['forecast_data'])\n        \n        result = ScenarioSimulator.simulate_scenario(forecast_data, scenario_params)\n        \n        return result\n    except Exception as e:\n        logger.error(f\"Error simulating scenario: {str(e)}\")\n        raise HTTPException(status_code=500, detail=str(e))\n","path":null,"size_bytes":2780,"size_tokens":null},"AISalesForecasterzip/AISalesForecaster/backend/app/services/insights_generator.py":{"content":"import pandas as pd\nimport numpy as np\nfrom typing import Dict, List, Optional, Any\nfrom datetime import datetime\nimport logging\n\nfrom ..models.schemas import (\n    InsightBullet, Recommendation, KPISnapshot,\n    ForecastMetrics, FeatureImportance\n)\nfrom ..utils.helpers import format_number, format_percentage, calculate_change_percentage\n\nlogger = logging.getLogger(__name__)\n\n\nclass InsightsGenerator:\n    def __init__(self, historical_df: pd.DataFrame, forecast_data: List[Dict],\n                 metrics: ForecastMetrics, target_column: str = 'revenue',\n                 feature_importance: Optional[List[FeatureImportance]] = None):\n        self.historical_df = historical_df.copy()\n        self.forecast_data = forecast_data\n        self.metrics = metrics\n        self.target_column = target_column\n        self.feature_importance = feature_importance or []\n    \n    def generate_title(self) -> str:\n        accuracy = 100 - self.metrics.mape\n        if accuracy >= 90:\n            quality = \"High-Confidence\"\n        elif accuracy >= 80:\n            quality = \"Reliable\"\n        else:\n            quality = \"Indicative\"\n        \n        return f\"{quality} Sales Forecast Analysis\"\n    \n    def generate_summary(self) -> str:\n        total_historical = self.historical_df[self.target_column].sum()\n        avg_historical = self.historical_df[self.target_column].mean()\n        \n        forecast_values = [f['predicted'] for f in self.forecast_data if 'predicted' in f]\n        total_forecast = sum(forecast_values) if forecast_values else 0\n        avg_forecast = np.mean(forecast_values) if forecast_values else 0\n        \n        growth = calculate_change_percentage(avg_forecast, avg_historical)\n        \n        trend = \"growth\" if growth > 0 else \"decline\" if growth < 0 else \"stable performance\"\n        \n        summary = (\n            f\"Based on analysis of {len(self.historical_df)} historical data points, \"\n            f\"our model forecasts {format_number(total_forecast)} in projected {self.target_column} \"\n            f\"over the next {len(self.forecast_data)} periods. \"\n            f\"This represents a {abs(growth):.1f}% {trend} compared to historical averages. \"\n            f\"Model accuracy: {100 - self.metrics.mape:.1f}% (MAPE: {self.metrics.mape:.1f}%).\"\n        )\n        \n        return summary\n    \n    def generate_kpis(self) -> List[KPISnapshot]:\n        kpis = []\n        \n        current_year = self.historical_df['date'].dt.year.max()\n        prev_year = current_year - 1\n        \n        current_year_data = self.historical_df[self.historical_df['date'].dt.year == current_year]\n        prev_year_data = self.historical_df[self.historical_df['date'].dt.year == prev_year]\n        \n        current_total = current_year_data[self.target_column].sum()\n        prev_total = prev_year_data[self.target_column].sum() if len(prev_year_data) > 0 else 0\n        \n        if prev_total > 0:\n            yoy_growth = calculate_change_percentage(current_total, prev_total)\n            kpis.append(KPISnapshot(\n                name=\"Year-over-Year Growth\",\n                value=format_percentage(yoy_growth),\n                trend=\"up\" if yoy_growth > 0 else \"down\" if yoy_growth < 0 else \"neutral\"\n            ))\n        \n        forecast_values = [f['predicted'] for f in self.forecast_data]\n        if forecast_values:\n            forecast_growth = calculate_change_percentage(\n                np.mean(forecast_values),\n                self.historical_df[self.target_column].mean()\n            )\n            kpis.append(KPISnapshot(\n                name=\"Forecast vs Historical\",\n                value=format_percentage(forecast_growth),\n                trend=\"up\" if forecast_growth > 0 else \"down\" if forecast_growth < 0 else \"neutral\"\n            ))\n        \n        kpis.append(KPISnapshot(\n            name=\"Model Accuracy\",\n            value=f\"{100 - self.metrics.mape:.1f}%\",\n            trend=\"up\" if self.metrics.mape < 15 else \"neutral\" if self.metrics.mape < 25 else \"down\"\n        ))\n        \n        kpis.append(KPISnapshot(\n            name=\"MAE\",\n            value=format_number(self.metrics.mae),\n            trend=\"neutral\"\n        ))\n        \n        if 'month' in self.historical_df.columns:\n            monthly_avg = self.historical_df.groupby('month')[self.target_column].mean()\n            peak_month = monthly_avg.idxmax()\n            seasonality_strength = (monthly_avg.max() - monthly_avg.min()) / monthly_avg.mean() * 100\n            \n            kpis.append(KPISnapshot(\n                name=\"Seasonality Strength\",\n                value=f\"{seasonality_strength:.0f}%\",\n                change=f\"Peak: Month {peak_month}\",\n                trend=\"up\" if seasonality_strength > 30 else \"neutral\"\n            ))\n        \n        return kpis\n    \n    def generate_bullets(self) -> List[InsightBullet]:\n        bullets = []\n        \n        total = self.historical_df[self.target_column].sum()\n        avg = self.historical_df[self.target_column].mean()\n        \n        bullets.append(InsightBullet(\n            icon=\"chart-line\",\n            text=f\"Total historical {self.target_column}: {format_number(total)} with average of {format_number(avg)} per period.\",\n            severity=\"info\"\n        ))\n        \n        if 'month' in self.historical_df.columns:\n            monthly_data = self.historical_df.groupby('month')[self.target_column].mean()\n            peak_month = monthly_data.idxmax()\n            low_month = monthly_data.idxmin()\n            \n            month_names = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', \n                          'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec']\n            \n            peak_name = month_names[peak_month - 1] if 1 <= peak_month <= 12 else str(peak_month)\n            low_name = month_names[low_month - 1] if 1 <= low_month <= 12 else str(low_month)\n            \n            variance = (monthly_data.max() - monthly_data.min()) / monthly_data.mean() * 100\n            \n            if variance > 30:\n                bullets.append(InsightBullet(\n                    icon=\"calendar-check\",\n                    text=f\"Strong seasonal pattern detected: Peak sales in {peak_name}, lowest in {low_name} ({variance:.0f}% variance).\",\n                    severity=\"warning\"\n                ))\n            else:\n                bullets.append(InsightBullet(\n                    icon=\"calendar\",\n                    text=f\"Relatively stable sales across months with slight peaks in {peak_name}.\",\n                    severity=\"info\"\n                ))\n        \n        forecast_values = [f['predicted'] for f in self.forecast_data]\n        if forecast_values:\n            forecast_trend = np.polyfit(range(len(forecast_values)), forecast_values, 1)[0]\n            \n            if forecast_trend > 0:\n                bullets.append(InsightBullet(\n                    icon=\"trending-up\",\n                    text=f\"Forecast shows upward trend with projected growth over the forecast period.\",\n                    severity=\"success\"\n                ))\n            elif forecast_trend < 0:\n                bullets.append(InsightBullet(\n                    icon=\"trending-down\",\n                    text=f\"Forecast indicates declining trend. Consider strategic interventions.\",\n                    severity=\"warning\"\n                ))\n            else:\n                bullets.append(InsightBullet(\n                    icon=\"minus\",\n                    text=\"Forecast shows stable performance with minimal variation expected.\",\n                    severity=\"info\"\n                ))\n        \n        if self.feature_importance:\n            top_features = self.feature_importance[:3]\n            feature_names = [f.feature.replace('_', ' ').title() for f in top_features]\n            \n            bullets.append(InsightBullet(\n                icon=\"zap\",\n                text=f\"Top sales drivers: {', '.join(feature_names)}.\",\n                severity=\"info\"\n            ))\n        \n        if self.metrics.mape < 10:\n            bullets.append(InsightBullet(\n                icon=\"check-circle\",\n                text=\"Excellent model accuracy (<10% error). High confidence in forecasts.\",\n                severity=\"success\"\n            ))\n        elif self.metrics.mape < 20:\n            bullets.append(InsightBullet(\n                icon=\"check\",\n                text=\"Good model accuracy. Forecasts are reliable for planning purposes.\",\n                severity=\"info\"\n            ))\n        else:\n            bullets.append(InsightBullet(\n                icon=\"alert-triangle\",\n                text=\"Model accuracy is moderate. Consider using forecasts as directional guidance.\",\n                severity=\"warning\"\n            ))\n        \n        return bullets\n    \n    def generate_recommendations(self) -> List[Recommendation]:\n        recommendations = []\n        \n        if 'month' in self.historical_df.columns:\n            monthly_data = self.historical_df.groupby('month')[self.target_column].mean()\n            peak_months = monthly_data.nlargest(3).index.tolist()\n            low_months = monthly_data.nsmallest(3).index.tolist()\n            \n            month_names = ['January', 'February', 'March', 'April', 'May', 'June',\n                          'July', 'August', 'September', 'October', 'November', 'December']\n            \n            peak_names = [month_names[m-1] for m in peak_months if 1 <= m <= 12]\n            low_names = [month_names[m-1] for m in low_months if 1 <= m <= 12]\n            \n            recommendations.append(Recommendation(\n                category=\"Inventory\",\n                title=\"Optimize Inventory Levels\",\n                description=f\"Increase inventory 4-6 weeks before peak months ({', '.join(peak_names)}). \"\n                           f\"Reduce stock commitments during {', '.join(low_names)} to minimize carrying costs.\",\n                priority=\"high\"\n            ))\n        \n        if 'promotion_flag' in self.historical_df.columns:\n            promo_data = self.historical_df.groupby('promotion_flag')[self.target_column].mean()\n            if len(promo_data) > 1 and 1 in promo_data.index and 0 in promo_data.index:\n                promo_lift = (promo_data[1] - promo_data[0]) / promo_data[0] * 100\n                \n                if promo_lift > 20:\n                    recommendations.append(Recommendation(\n                        category=\"Promotion\",\n                        title=\"Scale Successful Promotions\",\n                        description=f\"Promotions drive {promo_lift:.0f}% sales lift. \"\n                                   \"Consider increasing promotion frequency during slow periods.\",\n                        priority=\"high\"\n                    ))\n                else:\n                    recommendations.append(Recommendation(\n                        category=\"Promotion\",\n                        title=\"Reassess Promotion Strategy\",\n                        description=f\"Current promotions show only {promo_lift:.0f}% lift. \"\n                                   \"Test different promotion types or discount depths.\",\n                        priority=\"medium\"\n                    ))\n        else:\n            recommendations.append(Recommendation(\n                category=\"Promotion\",\n                title=\"Implement Promotion Tracking\",\n                description=\"Start tracking promotion periods to measure ROI and optimize timing. \"\n                           \"Consider strategic promotions during identified slow periods.\",\n                priority=\"medium\"\n            ))\n        \n        if 'price' in self.historical_df.columns:\n            price_revenue_corr = self.historical_df['price'].corr(self.historical_df[self.target_column])\n            \n            if price_revenue_corr > 0.3:\n                recommendations.append(Recommendation(\n                    category=\"Pricing\",\n                    title=\"Premium Pricing Opportunity\",\n                    description=\"Higher prices correlate with higher revenue. Consider gradual price increases \"\n                               \"or premium product tier development.\",\n                    priority=\"medium\"\n                ))\n            elif price_revenue_corr < -0.3:\n                recommendations.append(Recommendation(\n                    category=\"Pricing\",\n                    title=\"Optimize Price Points\",\n                    description=\"Price sensitivity detected. Test lower price points or bundle offers \"\n                               \"to maximize volume and total revenue.\",\n                    priority=\"high\"\n                ))\n            else:\n                recommendations.append(Recommendation(\n                    category=\"Pricing\",\n                    title=\"Conduct Pricing Analysis\",\n                    description=\"Price-revenue relationship is not clear. Conduct A/B price testing \"\n                               \"to identify optimal price points for different segments.\",\n                    priority=\"low\"\n                ))\n        \n        if len(recommendations) < 3:\n            recommendations.append(Recommendation(\n                category=\"Data Quality\",\n                title=\"Enhance Data Collection\",\n                description=\"Consider tracking additional variables like customer segments, \"\n                           \"marketing channels, and competitor actions for improved forecasting.\",\n                priority=\"low\"\n            ))\n        \n        return recommendations[:3]\n    \n    def generate_insights(self) -> Dict[str, Any]:\n        return {\n            'title': self.generate_title(),\n            'summary': self.generate_summary(),\n            'kpis': [kpi.model_dump() for kpi in self.generate_kpis()],\n            'bullets': [bullet.model_dump() for bullet in self.generate_bullets()],\n            'recommendations': [rec.model_dump() for rec in self.generate_recommendations()],\n            'generated_at': datetime.utcnow().isoformat()\n        }\n","path":null,"size_bytes":13948,"size_tokens":null},"AISalesForecasterzip/AISalesForecaster/main.py":{"content":"def main():\n    print(\"Hello from repl-nix-workspace!\")\n\n\nif __name__ == \"__main__\":\n    main()\n","path":null,"size_bytes":96,"size_tokens":null},"AISalesForecasterzip/AISalesForecaster/backend/app/utils/__init__.py":{"content":"from .holidays import get_holiday_flags\nfrom .helpers import generate_job_id\n","path":null,"size_bytes":77,"size_tokens":null},"AISalesForecasterzip/AISalesForecaster/frontend/src/components/BiasAnalysis.jsx":{"content":"import { TrendingDown, TrendingUp, AlertCircle } from 'lucide-react';\n\nfunction BiasAnalysis({ metrics, darkMode }) {\n  if (!metrics) return null;\n\n  const overpred = metrics.overprediction_bias ?? 0;\n  const underpred = metrics.underprediction_bias ?? 0;\n\n  return (\n    <div className={`p-4 rounded-lg border mt-4 ${\n      darkMode ? 'bg-slate-800 border-slate-700' : 'bg-white border-gray-200'\n    }`}>\n      <div className=\"flex items-center gap-2 mb-4\">\n        <AlertCircle size={20} className={darkMode ? 'text-purple-400' : 'text-purple-600'} />\n        <h4 className={`font-semibold ${darkMode ? 'text-white' : 'text-gray-900'}`}>\n          AI Bias Detection\n        </h4>\n      </div>\n\n      <div className=\"space-y-3\">\n        {/* Overprediction */}\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-2\">\n            <TrendingUp size={16} className=\"text-red-500\" />\n            <span className={`text-sm ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>\n              Overprediction\n            </span>\n          </div>\n          <div className={`font-semibold ${darkMode ? 'text-red-400' : 'text-red-600'}`}>\n            {overpred.toFixed(1)}%\n          </div>\n        </div>\n\n        {/* Underprediction */}\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-2\">\n            <TrendingDown size={16} className=\"text-blue-500\" />\n            <span className={`text-sm ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>\n              Underprediction\n            </span>\n          </div>\n          <div className={`font-semibold ${darkMode ? 'text-blue-400' : 'text-blue-600'}`}>\n            {underpred.toFixed(1)}%\n          </div>\n        </div>\n\n        {/* Summary */}\n        <div className={`text-xs mt-3 p-2 rounded ${\n          darkMode ? 'bg-slate-700/50 text-gray-300' : 'bg-gray-100 text-gray-700'\n        }`}>\n          {overpred > underpred \n            ? `Model tends to overpredict. Review for conservative estimates.`\n            : `Model tends to underpredict. Add safety margins for planning.`\n          }\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default BiasAnalysis;\n","path":null,"size_bytes":2225,"size_tokens":null},"AISalesForecasterzip/AISalesForecaster/backend/app/main.py":{"content":"import os\nimport logging\nfrom fastapi import FastAPI\nfrom fastapi.middleware.cors import CORSMiddleware\nfrom contextlib import asynccontextmanager\n\nfrom .models.database import init_database\nfrom .routes import upload_router, forecast_router, insights_router, download_router, delete_router, recommendations_router, chat_router\n\nlogging.basicConfig(\n    level=logging.INFO,\n    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'\n)\nlogger = logging.getLogger(__name__)\n\n\n@asynccontextmanager\nasync def lifespan(app: FastAPI):\n    logger.info(\"Starting AI Sales Forecaster API...\")\n    init_database()\n    logger.info(\"Database initialized\")\n    yield\n    logger.info(\"Shutting down AI Sales Forecaster API...\")\n\n\napp = FastAPI(\n    title=\"AI Sales Forecaster & Business Insight Generator\",\n    description=\"Production-capable API for sales forecasting using Prophet and LightGBM models\",\n    version=\"1.0.0\",\n    lifespan=lifespan\n)\n\napp.add_middleware(\n    CORSMiddleware,\n    allow_origins=[\"*\"],\n    allow_credentials=True,\n    allow_methods=[\"*\"],\n    allow_headers=[\"*\"],\n)\n\napp.include_router(upload_router, prefix=\"/api\", tags=[\"Upload\"])\napp.include_router(forecast_router, prefix=\"/api\", tags=[\"Forecast\"])\napp.include_router(insights_router, prefix=\"/api\", tags=[\"Insights\"])\napp.include_router(download_router, prefix=\"/api\", tags=[\"Download\"])\napp.include_router(delete_router, prefix=\"/api\", tags=[\"Delete\"])\napp.include_router(recommendations_router, prefix=\"/api\", tags=[\"AI Features\"])\napp.include_router(chat_router, prefix=\"/api\", tags=[\"Chat\"])\n\n\n@app.get(\"/\")\nasync def root():\n    return {\n        \"name\": \"AI Sales Forecaster & Business Insight Generator\",\n        \"version\": \"1.0.0\",\n        \"status\": \"running\",\n        \"endpoints\": {\n            \"upload\": \"/api/upload\",\n            \"forecast\": \"/api/forecast\",\n            \"insights\": \"/api/insights\",\n            \"download\": \"/api/download\"\n        }\n    }\n\n\n@app.get(\"/health\")\nasync def health_check():\n    return {\"status\": \"healthy\"}\n","path":null,"size_bytes":2025,"size_tokens":null},"AISalesForecasterzip/AISalesForecaster/frontend/src/components/ConfidenceRiskCard.jsx":{"content":"import { Shield, AlertCircle, CheckCircle } from 'lucide-react';\n\nfunction ConfidenceRiskCard({ metrics, darkMode }) {\n  if (!metrics) return null;\n\n  const confidenceScore = metrics.confidence_score ?? 85;\n  const riskLevel = metrics.risk_level ?? 'medium';\n\n  const getRiskColor = (level) => {\n    switch(level) {\n      case 'high': return darkMode ? 'text-red-400' : 'text-red-600';\n      case 'medium': return darkMode ? 'text-yellow-400' : 'text-yellow-600';\n      case 'low': return darkMode ? 'text-green-400' : 'text-green-600';\n      default: return darkMode ? 'text-gray-400' : 'text-gray-600';\n    }\n  };\n\n  const getRiskBg = (level) => {\n    switch(level) {\n      case 'high': return darkMode ? 'bg-red-900/20 border-red-700/30' : 'bg-red-50 border-red-200';\n      case 'medium': return darkMode ? 'bg-yellow-900/20 border-yellow-700/30' : 'bg-yellow-50 border-yellow-200';\n      case 'low': return darkMode ? 'bg-green-900/20 border-green-700/30' : 'bg-green-50 border-green-200';\n      default: return darkMode ? 'bg-gray-800 border-gray-700' : 'bg-gray-50 border-gray-200';\n    }\n  };\n\n  return (\n    <div className={`grid grid-cols-2 gap-4 mt-4`}>\n      {/* Confidence Score */}\n      <div className={`p-4 rounded-lg border ${darkMode ? 'bg-slate-800 border-slate-700' : 'bg-white border-gray-200'}`}>\n        <div className=\"flex items-center gap-2 mb-2\">\n          <CheckCircle size={18} className={darkMode ? 'text-blue-400' : 'text-blue-600'} />\n          <span className={`text-sm font-semibold ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>\n            Confidence Score\n          </span>\n        </div>\n        <div className=\"flex items-end gap-2\">\n          <div className={`text-3xl font-bold ${darkMode ? 'text-white' : 'text-gray-900'}`}>\n            {confidenceScore.toFixed(0)}%\n          </div>\n          <div className={`text-xs mb-1 ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>High</div>\n        </div>\n        <div className=\"mt-3 w-full bg-gray-300 rounded-full h-2\">\n          <div\n            className=\"bg-gradient-to-r from-blue-500 to-blue-600 h-2 rounded-full transition-all\"\n            style={{ width: `${Math.min(confidenceScore, 100)}%` }}\n          ></div>\n        </div>\n      </div>\n\n      {/* Risk Level */}\n      <div className={`p-4 rounded-lg border ${getRiskBg(riskLevel)}`}>\n        <div className=\"flex items-center gap-2 mb-2\">\n          <AlertCircle size={18} className={getRiskColor(riskLevel)} />\n          <span className={`text-sm font-semibold ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>\n            Risk Level\n          </span>\n        </div>\n        <div className={`text-2xl font-bold capitalize ${getRiskColor(riskLevel)}`}>\n          {riskLevel}\n        </div>\n        <div className={`text-xs mt-2 ${darkMode ? 'text-gray-400' : 'text-gray-600'}`}>\n          {riskLevel === 'low' ? 'Stable forecast' : riskLevel === 'high' ? 'High volatility' : 'Moderate variability'}\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default ConfidenceRiskCard;\n","path":null,"size_bytes":3035,"size_tokens":null},"AISalesForecasterzip/AISalesForecaster/backend/app/utils/helpers.py":{"content":"import uuid\nimport hashlib\nfrom datetime import datetime\nfrom typing import List, Any\n\n\ndef generate_job_id() -> str:\n    timestamp = datetime.utcnow().strftime(\"%Y%m%d%H%M%S\")\n    unique_part = uuid.uuid4().hex[:8]\n    return f\"job_{timestamp}_{unique_part}\"\n\n\ndef calculate_change_percentage(current: float, previous: float) -> float:\n    if previous == 0:\n        return 0.0 if current == 0 else 100.0\n    return ((current - previous) / abs(previous)) * 100\n\n\ndef format_number(value: float, decimals: int = 2) -> str:\n    if abs(value) >= 1_000_000_000:\n        return f\"{value / 1_000_000_000:.{decimals}f}B\"\n    elif abs(value) >= 1_000_000:\n        return f\"{value / 1_000_000:.{decimals}f}M\"\n    elif abs(value) >= 1_000:\n        return f\"{value / 1_000:.{decimals}f}K\"\n    else:\n        return f\"{value:.{decimals}f}\"\n\n\ndef format_percentage(value: float, decimals: int = 1) -> str:\n    return f\"{value:+.{decimals}f}%\"\n\n\ndef safe_divide(numerator: float, denominator: float, default: float = 0.0) -> float:\n    if denominator == 0:\n        return default\n    return numerator / denominator\n\n\ndef get_season(month: int) -> str:\n    if month in [12, 1, 2]:\n        return \"Winter\"\n    elif month in [3, 4, 5]:\n        return \"Spring\"\n    elif month in [6, 7, 8]:\n        return \"Summer\"\n    else:\n        return \"Fall\"\n\n\ndef get_quarter(month: int) -> int:\n    return (month - 1) // 3 + 1\n\n\ndef chunk_list(lst: List[Any], chunk_size: int) -> List[List[Any]]:\n    return [lst[i:i + chunk_size] for i in range(0, len(lst), chunk_size)]\n","path":null,"size_bytes":1542,"size_tokens":null},"AISalesForecasterzip/AISalesForecaster/backend/app/routes/insights.py":{"content":"import os\nimport pandas as pd\nfrom fastapi import APIRouter, HTTPException, Query\nimport logging\n\nfrom ..models.schemas import InsightsResponse, ForecastMetrics, FeatureImportance\nfrom ..models.database import (\n    get_job, get_latest_forecast, save_insights, get_latest_insights\n)\nfrom ..services.insights_generator import InsightsGenerator\n\nrouter = APIRouter()\nlogger = logging.getLogger(__name__)\n\n\n@router.get(\"/insights\", response_model=InsightsResponse)\nasync def get_insights(job_id: str = Query(..., description=\"Job ID from forecast\")):\n    job = get_job(job_id)\n    if not job:\n        raise HTTPException(status_code=404, detail=\"Job not found\")\n    \n    forecast = get_latest_forecast(job_id)\n    if not forecast:\n        raise HTTPException(\n            status_code=404, \n            detail=\"No forecast found. Please run a forecast first.\"\n        )\n    \n    try:\n        existing_insights = get_latest_insights(job_id)\n        if existing_insights:\n            return InsightsResponse(\n                job_id=job_id,\n                title=existing_insights['title'],\n                summary=existing_insights['summary'],\n                kpis=existing_insights['kpis'],\n                bullets=existing_insights['bullets'],\n                recommendations=existing_insights['recommendations'],\n                generated_at=existing_insights['created_at']\n            )\n        \n        df = pd.read_csv(job['file_path'])\n        df['date'] = pd.to_datetime(df['date'])\n        \n        if 'month' not in df.columns:\n            df['month'] = df['date'].dt.month\n        \n        metrics = ForecastMetrics(**forecast['metrics'])\n        \n        feature_importance = None\n        if forecast['feature_importance']:\n            feature_importance = [\n                FeatureImportance(**fi) for fi in forecast['feature_importance']\n            ]\n        \n        generator = InsightsGenerator(\n            historical_df=df,\n            forecast_data=forecast['forecast_data'],\n            metrics=metrics,\n            target_column=forecast['target_column'],\n            feature_importance=feature_importance\n        )\n        \n        insights = generator.generate_insights()\n        \n        save_insights(\n            job_id=job_id,\n            title=insights['title'],\n            summary=insights['summary'],\n            kpis=insights['kpis'],\n            bullets=insights['bullets'],\n            recommendations=insights['recommendations']\n        )\n        \n        return InsightsResponse(\n            job_id=job_id,\n            **insights\n        )\n        \n    except HTTPException:\n        raise\n    except Exception as e:\n        logger.error(f\"Insights generation error: {str(e)}\")\n        raise HTTPException(status_code=500, detail=f\"Error generating insights: {str(e)}\")\n\n\n@router.post(\"/insights/regenerate\")\nasync def regenerate_insights(job_id: str = Query(...)):\n    job = get_job(job_id)\n    if not job:\n        raise HTTPException(status_code=404, detail=\"Job not found\")\n    \n    forecast = get_latest_forecast(job_id)\n    if not forecast:\n        raise HTTPException(status_code=404, detail=\"No forecast found\")\n    \n    try:\n        df = pd.read_csv(job['file_path'])\n        df['date'] = pd.to_datetime(df['date'])\n        \n        if 'month' not in df.columns:\n            df['month'] = df['date'].dt.month\n        \n        metrics = ForecastMetrics(**forecast['metrics'])\n        \n        feature_importance = None\n        if forecast['feature_importance']:\n            feature_importance = [\n                FeatureImportance(**fi) for fi in forecast['feature_importance']\n            ]\n        \n        generator = InsightsGenerator(\n            historical_df=df,\n            forecast_data=forecast['forecast_data'],\n            metrics=metrics,\n            target_column=forecast['target_column'],\n            feature_importance=feature_importance\n        )\n        \n        insights = generator.generate_insights()\n        \n        save_insights(\n            job_id=job_id,\n            title=insights['title'],\n            summary=insights['summary'],\n            kpis=insights['kpis'],\n            bullets=insights['bullets'],\n            recommendations=insights['recommendations']\n        )\n        \n        return InsightsResponse(\n            job_id=job_id,\n            **insights\n        )\n        \n    except Exception as e:\n        logger.error(f\"Insights regeneration error: {str(e)}\")\n        raise HTTPException(status_code=500, detail=f\"Error regenerating insights: {str(e)}\")\n","path":null,"size_bytes":4535,"size_tokens":null},"AISalesForecasterzip/AISalesForecaster/frontend/src/components/Stepper.jsx":{"content":"import { BarChart3, Zap, Lightbulb, Upload, FileText, User, RefreshCw } from 'lucide-react';\n\nfunction Stepper({ currentStep, onStepClick, hasUploadData, hasForecastData, onReset, darkMode }) {\n  const menuItems = [\n    { id: 'dashboard', label: 'Dashboard', icon: BarChart3, disabled: !hasForecastData },\n    { id: 'forecast', label: 'Forecast', icon: Zap, disabled: !hasUploadData },\n    { id: 'insights', label: 'Insights', icon: Lightbulb, disabled: !hasForecastData },\n    { id: 'upload', label: 'Upload Data', icon: Upload, disabled: false },\n    { id: 'reports', label: 'Reports', icon: FileText, disabled: !hasForecastData },\n  ];\n\n  const handleMenuClick = (itemId) => {\n    if (itemId === 'upload' || itemId === 'upload-nav') {\n      onStepClick('upload');\n    } else if (itemId === 'forecast') {\n      onStepClick('config');\n    } else if (itemId === 'dashboard') {\n      onStepClick('dashboard');\n    } else if (itemId === 'insights') {\n      onStepClick('dashboard');\n    }\n  };\n\n  const stepMap = {\n    'upload': 'upload',\n    'preview': 'upload',\n    'config': 'forecast',\n    'dashboard': 'dashboard'\n  };\n\n  const currentMenuItem = stepMap[currentStep] || 'upload';\n\n  return (\n    <div className=\"fixed left-0 top-0 h-screen w-64 bg-gradient-to-b from-slate-900 via-slate-800 to-slate-900 border-r border-slate-700 flex flex-col z-40 shadow-2xl\">\n      <div className=\"p-6 border-b border-slate-700 bg-gradient-to-r from-blue-600/20 to-purple-600/20\">\n        <div className=\"flex items-center gap-4\">\n          <div className=\"w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-500 rounded-full flex items-center justify-center text-white shadow-lg\">\n            <User size={24} />\n          </div>\n          <div>\n            <p className=\"text-white font-bold text-sm\">AI Forecaster</p>\n            <p className=\"text-slate-400 text-xs\">Sales Analytics</p>\n          </div>\n        </div>\n      </div>\n\n      {currentStep !== 'upload' && (\n        <div className=\"px-4 py-4 border-b border-slate-700\">\n          <button\n            onClick={onReset}\n            className=\"w-full flex items-center justify-center gap-2 px-4 py-3 bg-gradient-to-r from-amber-600 to-orange-600 hover:from-amber-700 hover:to-orange-700 text-white rounded-lg transition-all duration-300 font-semibold shadow-lg hover:shadow-xl\"\n          >\n            <RefreshCw size={18} />\n            <span>Start Over</span>\n          </button>\n        </div>\n      )}\n\n      <nav className=\"flex-1 px-4 py-6 space-y-2 overflow-y-auto\">\n        {menuItems.map((item) => {\n          const Icon = item.icon;\n          const isActive = currentMenuItem === (item.id === 'forecast' ? 'forecast' : item.id === 'upload' ? 'upload' : 'dashboard');\n          const isDisabled = item.disabled;\n\n          return (\n            <button\n              key={item.id}\n              onClick={() => handleMenuClick(item.id)}\n              disabled={isDisabled}\n              className={`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-all duration-300 group ${\n                isActive\n                  ? 'bg-gradient-to-r from-blue-600 to-blue-500 text-white shadow-lg'\n                  : isDisabled\n                  ? 'text-slate-600 cursor-not-allowed opacity-50'\n                  : 'text-slate-300 hover:bg-slate-700/50 hover:text-white'\n              }`}\n            >\n              <Icon size={20} className={`flex-shrink-0 transition-transform ${isActive ? 'scale-110' : ''}`} />\n              <span className=\"text-sm font-medium\">{item.label}</span>\n              {isActive && (\n                <div className=\"ml-auto w-2 h-2 bg-white rounded-full shadow-lg\" />\n              )}\n            </button>\n          );\n        })}\n      </nav>\n\n      <div className=\"p-4 border-t border-slate-700 bg-slate-900/50\">\n        <p className=\"text-xs text-slate-500 text-center\">\n          AI Sales Forecaster v1.0\n        </p>\n      </div>\n    </div>\n  );\n}\n\nexport default Stepper;\n","path":null,"size_bytes":3972,"size_tokens":null},"AISalesForecasterzip/AISalesForecaster/frontend/src/components/Tooltip.jsx":{"content":"import { useState } from 'react';\nimport { Info } from 'lucide-react';\n\nfunction Tooltip({ content, children, position = 'top' }) {\n  const [isVisible, setIsVisible] = useState(false);\n\n  const positionClasses = {\n    top: 'bottom-full left-1/2 -translate-x-1/2 mb-2',\n    bottom: 'top-full left-1/2 -translate-x-1/2 mt-2',\n    left: 'right-full top-1/2 -translate-y-1/2 mr-2',\n    right: 'left-full top-1/2 -translate-y-1/2 ml-2',\n  };\n\n  const arrowClasses = {\n    top: 'top-full left-1/2 -translate-x-1/2 border-t-slate-800 border-x-transparent border-b-transparent border-4',\n    bottom: 'bottom-full left-1/2 -translate-x-1/2 border-b-slate-800 border-x-transparent border-t-transparent border-4',\n    left: 'left-full top-1/2 -translate-y-1/2 border-l-slate-800 border-y-transparent border-r-transparent border-4',\n    right: 'right-full top-1/2 -translate-y-1/2 border-r-slate-800 border-y-transparent border-l-transparent border-4',\n  };\n\n  return (\n    <div className=\"relative inline-flex items-center\">\n      <button\n        type=\"button\"\n        onMouseEnter={() => setIsVisible(true)}\n        onMouseLeave={() => setIsVisible(false)}\n        onFocus={() => setIsVisible(true)}\n        onBlur={() => setIsVisible(false)}\n        className=\"p-1 text-gray-400 hover:text-blue-500 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 rounded-full\"\n        aria-label=\"More information\"\n      >\n        {children || <Info size={16} />}\n      </button>\n      \n      {isVisible && (\n        <div className={`absolute z-50 ${positionClasses[position]}`}>\n          <div className=\"bg-slate-800 text-white text-sm rounded-lg px-3 py-2 shadow-xl max-w-xs whitespace-normal\">\n            {content}\n            <div className={`absolute ${arrowClasses[position]}`} />\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n\nexport default Tooltip;\n","path":null,"size_bytes":1892,"size_tokens":null},"pyproject.toml":{"content":"[project]\nname = \"repl-nix-workspace\"\nversion = \"0.1.0\"\ndescription = \"Add your description here\"\nrequires-python = \">=3.11\"\ndependencies = [\n    \"openai>=2.9.0\",\n]\n","path":null,"size_bytes":165,"size_tokens":null},"AISalesForecasterzip/AISalesForecaster/backend/app/routes/delete.py":{"content":"import logging\nfrom fastapi import APIRouter, HTTPException\nfrom ..models.database import get_connection\n\nlogger = logging.getLogger(__name__)\nrouter = APIRouter()\n\n\n@router.delete(\"/job/{job_id}\")\nasync def delete_job(job_id: str):\n    \"\"\"Delete a job and all its associated data (forecasts, uploads)\"\"\"\n    try:\n        with get_connection() as conn:\n            cursor = conn.cursor()\n            \n            # Delete forecast data\n            cursor.execute(\"DELETE FROM forecasts WHERE job_id = ?\", (job_id,))\n            \n            # Delete insights data\n            cursor.execute(\"DELETE FROM insights WHERE job_id = ?\", (job_id,))\n            \n            # Delete job\n            cursor.execute(\"DELETE FROM jobs WHERE job_id = ?\", (job_id,))\n            \n            conn.commit()\n        \n        logger.info(f\"Deleted job {job_id} and all associated data\")\n        return {\"status\": \"success\", \"message\": f\"Job {job_id} deleted\"}\n        \n    except Exception as e:\n        logger.error(f\"Error deleting job {job_id}: {str(e)}\")\n        raise HTTPException(status_code=500, detail=f\"Failed to delete job: {str(e)}\")\n","path":null,"size_bytes":1132,"size_tokens":null},"AISalesForecasterzip/AISalesForecaster/backend/app/services/bias_detector.py":{"content":"import pandas as pd\nimport numpy as np\nfrom typing import Dict, Tuple, List, Any\nimport logging\n\nlogger = logging.getLogger(__name__)\n\n\nclass BiasDetector:\n    \"\"\"Detects prediction bias in forecasting models\"\"\"\n    \n    @staticmethod\n    def calculate_bias_metrics(y_true: np.ndarray, y_pred: np.ndarray, \n                               dates: List[str] = None) -> Dict[str, Any]:\n        \"\"\"\n        Calculate bias metrics for predictions\n        \n        Args:\n            y_true: Actual values\n            y_pred: Predicted values\n            dates: Optional list of dates for quarterly analysis\n        \n        Returns:\n            Dictionary with bias metrics\n        \"\"\"\n        residuals = y_true - y_pred\n        \n        # Overall bias\n        mean_bias = np.mean(residuals)\n        overall_overprediction = np.sum(residuals < 0) / len(residuals) * 100\n        overall_underprediction = np.sum(residuals > 0) / len(residuals) * 100\n        \n        # Bias percentage (signed percentage error)\n        bias_pct = (mean_bias / np.mean(y_true)) * 100 if np.mean(y_true) != 0 else 0\n        \n        quarterly_bias = {}\n        if dates:\n            df_temp = pd.DataFrame({\n                'date': pd.to_datetime(dates),\n                'residual': residuals\n            })\n            df_temp['quarter'] = df_temp['date'].dt.to_period('Q')\n            \n            for quarter, group in df_temp.groupby('quarter'):\n                q_bias = (np.mean(group['residual']) / np.mean(y_true)) * 100 if np.mean(y_true) != 0 else 0\n                quarterly_bias[str(quarter)] = round(q_bias, 2)\n        \n        # Determine risk level based on volatility of residuals\n        residual_std = np.std(residuals)\n        residual_mean = np.mean(np.abs(residuals))\n        \n        if residual_std > residual_mean * 1.5:\n            risk_level = 'high'\n        elif residual_std > residual_mean * 0.8:\n            risk_level = 'medium'\n        else:\n            risk_level = 'low'\n        \n        # Confidence score (inverse of MAPE-like metric)\n        mean_absolute_percentage_error = np.mean(np.abs(residuals / (np.abs(y_true) + 1))) * 100\n        confidence_score = max(0, 100 - mean_absolute_percentage_error)\n        \n        return {\n            'confidence_score': round(confidence_score, 1),\n            'risk_level': risk_level,\n            'bias_percentage': round(bias_pct, 2),\n            'overprediction_bias': round(overall_overprediction, 1),\n            'underprediction_bias': round(overall_underprediction, 1),\n            'quarterly_bias': quarterly_bias,\n            'bias_summary': BiasDetector._generate_bias_summary(bias_pct, quarterly_bias)\n        }\n    \n    @staticmethod\n    def _generate_bias_summary(overall_bias: float, quarterly_bias: Dict) -> str:\n        \"\"\"Generate human-readable bias summary\"\"\"\n        if overall_bias > 5:\n            summary = f\"Model tends to UNDERPREDICT by {abs(overall_bias):.1f}%\"\n        elif overall_bias < -5:\n            summary = f\"Model tends to OVERPREDICT by {abs(overall_bias):.1f}%\"\n        else:\n            summary = f\"Model has neutral bias ({overall_bias:.1f}%)\"\n        \n        # Add quarterly insights\n        if quarterly_bias:\n            worst_quarter = max(quarterly_bias.items(), key=lambda x: abs(x[1]))\n            if worst_quarter[1] != 0:\n                direction = \"underprediction\" if worst_quarter[1] > 0 else \"overprediction\"\n                summary += f\". Worst bias in {worst_quarter[0]}: {direction} of {abs(worst_quarter[1]):.1f}%\"\n        \n        return summary\n","path":null,"size_bytes":3558,"size_tokens":null},"AISalesForecasterzip/AISalesForecaster/README.md":{"content":"# AI Sales Forecaster & Business Insight Generator\n\nA production-capable prototype application for sales forecasting and business insights generation. Built with FastAPI, React, Prophet, and LightGBM.\n\n## Features\n\n- **Data Upload & Validation**: Upload CSV files with automatic schema validation and data cleaning\n- **Flexible Forecasting**: Choose from Prophet (time-series) or LightGBM (gradient boosting) models\n- **Configurable Parameters**: 3/6/12 month horizons with daily/weekly/monthly aggregation\n- **Interactive Dashboard**: Visualize historical vs forecast data with confidence intervals\n- **Time-Series Decomposition**: View trend, seasonality, and residual components\n- **Feature Importance**: Understand key drivers of your forecasts (LightGBM)\n- **Auto-Generated Insights**: KPI snapshots, data-driven observations, and actionable recommendations\n- **Export Options**: Download forecasts as CSV or comprehensive PDF reports\n\n## Tech Stack\n\n### Backend\n- FastAPI (Python 3.11+)\n- Prophet (Facebook's time-series forecasting)\n- LightGBM (gradient boosting)\n- Pandas, NumPy, scikit-learn\n- SQLite (demo) / PostgreSQL (production)\n- ReportLab (PDF generation)\n\n### Frontend\n- React with Vite\n- Tailwind CSS\n- Recharts (interactive charts)\n- Axios (API client)\n- Lucide Icons\n\n## Quick Start\n\n### Prerequisites\n- Python 3.11+\n- Node.js 18+\n- npm or yarn\n\n### Installation\n\n1. **Clone the repository**\n```bash\ngit clone <repository-url>\ncd ai-sales-forecaster\n```\n\n2. **Install Python dependencies**\n```bash\npip install -r requirements.txt\n```\n\n3. **Install frontend dependencies**\n```bash\ncd frontend\nnpm install\n```\n\n4. **Generate demo data**\n```bash\npython backend/generate_demo_data.py\n```\n\n### Running Locally\n\n1. **Start the backend server**\n```bash\ncd backend\nuvicorn app.main:app --host 0.0.0.0 --port 8000 --reload\n```\n\n2. **Start the frontend server** (in a new terminal)\n```bash\ncd frontend\nnpm run dev\n```\n\n3. **Open the app**: Navigate to `http://localhost:5000`\n\n## API Reference\n\n### Upload CSV\n```http\nPOST /api/upload\nContent-Type: multipart/form-data\n\nfile: <csv-file>\n```\n\n### Run Forecast\n```http\nPOST /api/forecast\nContent-Type: application/json\n\n{\n  \"job_id\": \"string\",\n  \"aggregation\": \"daily|weekly|monthly\",\n  \"model\": \"prophet|lightgbm\",\n  \"horizon\": 3|6|12,\n  \"target_column\": \"revenue\"\n}\n```\n\n### Get Insights\n```http\nGET /api/insights?job_id=<job_id>\n```\n\n### Download Report\n```http\nGET /api/download?job_id=<job_id>&format=csv|pdf\n```\n\n## CSV Format\n\nYour input CSV should contain these columns:\n\n| Column | Type | Required | Description |\n|--------|------|----------|-------------|\n| date | YYYY-MM-DD | Yes | Transaction date |\n| product_id | string | No | Product identifier |\n| product_name | string | No | Product name |\n| region | string | No | Geographic region |\n| units_sold | integer | Yes | Number of units sold |\n| revenue | float | Yes | Revenue amount |\n| price | float | No | Unit price |\n| promotion_flag | 0/1 | No | Promotion indicator |\n\n## Running Tests\n\n```bash\ncd backend\npytest tests/ -v\n```\n\n## Environment Variables\n\n| Variable | Default | Description |\n|----------|---------|-------------|\n| DATABASE_PATH | backend/data/forecaster.db | SQLite database location |\n| UPLOAD_DIR | backend/uploads | File upload directory |\n| SESSION_SECRET | (auto-generated) | Session encryption key |\n\n## Model Selection Guide\n\n### Prophet\n- Best for: Strong seasonal patterns, holiday effects\n- Handles: Missing data, outliers automatically\n- Provides: Uncertainty intervals, decomposition\n\n### LightGBM\n- Best for: Complex patterns, many features\n- Handles: Multivariate forecasting\n- Provides: Feature importance rankings\n\n## Deployment\n\n### Replit\n1. Fork this repository to Replit\n2. The app will auto-start with the configured workflows\n3. Use the web preview to access the application\n\n### Docker\n```bash\ndocker-compose up --build\n```\n\n## License\n\nMIT License - See LICENSE file for details.\n","path":null,"size_bytes":3949,"size_tokens":null},"AISalesForecasterzip/AISalesForecaster/backend/app/routes/download.py":{"content":"import os\nimport io\nimport json\nimport pandas as pd\nfrom fastapi import APIRouter, HTTPException, Query\nfrom fastapi.responses import StreamingResponse\nfrom datetime import datetime\nimport logging\n\nfrom reportlab.lib import colors\nfrom reportlab.lib.pagesizes import letter, A4\nfrom reportlab.lib.styles import getSampleStyleSheet, ParagraphStyle\nfrom reportlab.lib.units import inch\nfrom reportlab.platypus import SimpleDocTemplate, Paragraph, Spacer, Table, TableStyle, Image, PageBreak\nfrom reportlab.lib.enums import TA_CENTER, TA_LEFT\n\nimport matplotlib\nmatplotlib.use('Agg')\nimport matplotlib.pyplot as plt\nimport numpy as np\n\nfrom ..models.schemas import DownloadFormat\nfrom ..models.database import get_job, get_latest_forecast, get_latest_insights\n\nrouter = APIRouter()\nlogger = logging.getLogger(__name__)\n\n\ndef parse_json_field(value, default=None):\n    if value is None:\n        return default\n    if isinstance(value, (list, dict)):\n        return value\n    if isinstance(value, str):\n        try:\n            return json.loads(value)\n        except:\n            return default\n    return default\n\n\ndef create_forecast_chart(historical, forecast_data):\n    fig, ax = plt.subplots(figsize=(10, 5))\n    \n    hist_dates = [h.get('date', '') for h in historical]\n    hist_values = [h.get('actual', 0) for h in historical]\n    \n    fore_dates = [f.get('date', '') for f in forecast_data]\n    fore_values = [f.get('predicted', 0) for f in forecast_data]\n    lower_bounds = [f.get('lower_bound', 0) for f in forecast_data]\n    upper_bounds = [f.get('upper_bound', 0) for f in forecast_data]\n    \n    ax.plot(range(len(hist_dates)), hist_values, 'b-', linewidth=2, label='Historical')\n    \n    fore_start = len(hist_dates)\n    fore_range = range(fore_start, fore_start + len(fore_dates))\n    ax.plot(fore_range, fore_values, 'purple', linestyle='--', linewidth=2, label='Forecast')\n    ax.fill_between(fore_range, lower_bounds, upper_bounds, color='purple', alpha=0.2, label='Confidence Interval')\n    \n    all_dates = hist_dates + fore_dates\n    step = max(1, len(all_dates) // 8)\n    ax.set_xticks(range(0, len(all_dates), step))\n    ax.set_xticklabels([all_dates[i][:10] for i in range(0, len(all_dates), step)], rotation=45, ha='right')\n    \n    ax.set_xlabel('Date')\n    ax.set_ylabel('Value')\n    ax.set_title('Forecast Trend - Historical vs Predictions', fontsize=14, fontweight='bold')\n    ax.legend()\n    ax.grid(True, alpha=0.3)\n    \n    plt.tight_layout()\n    \n    buf = io.BytesIO()\n    plt.savefig(buf, format='png', dpi=150, bbox_inches='tight')\n    plt.close(fig)\n    buf.seek(0)\n    return buf\n\n\ndef create_residuals_chart(historical):\n    fig, ax = plt.subplots(figsize=(10, 4))\n    \n    recent = historical[-20:] if len(historical) > 20 else historical\n    dates = [h.get('date', '')[:10] for h in recent]\n    values = [h.get('actual', 0) for h in recent]\n    \n    mean_val = np.mean(values) if values else 0\n    residuals = [v - mean_val for v in values]\n    \n    colors_list = ['#06b6d4' if r >= 0 else '#f43f5e' for r in residuals]\n    ax.bar(range(len(residuals)), residuals, color=colors_list, alpha=0.8)\n    \n    ax.axhline(y=0, color='gray', linestyle='-', linewidth=1)\n    ax.set_xlabel('Period')\n    ax.set_ylabel('Residual Value')\n    ax.set_title('Forecast Residuals (Deviation from Mean)', fontsize=14, fontweight='bold')\n    ax.grid(True, alpha=0.3, axis='y')\n    \n    plt.tight_layout()\n    \n    buf = io.BytesIO()\n    plt.savefig(buf, format='png', dpi=150, bbox_inches='tight')\n    plt.close(fig)\n    buf.seek(0)\n    return buf\n\n\ndef create_comparison_chart(historical, forecast_data):\n    fig, ax = plt.subplots(figsize=(8, 4))\n    \n    hist_total = sum(h.get('actual', 0) for h in historical)\n    fore_total = sum(f.get('predicted', 0) for f in forecast_data)\n    \n    categories = ['Historical Total', 'Forecast Total']\n    values = [hist_total, fore_total]\n    colors_list = ['#3b82f6', '#8b5cf6']\n    \n    bars = ax.bar(categories, values, color=colors_list, width=0.6)\n    \n    for bar, val in zip(bars, values):\n        height = bar.get_height()\n        ax.annotate(f'{val:,.0f}',\n                    xy=(bar.get_x() + bar.get_width() / 2, height),\n                    xytext=(0, 3),\n                    textcoords=\"offset points\",\n                    ha='center', va='bottom', fontsize=10, fontweight='bold')\n    \n    ax.set_ylabel('Total Value')\n    ax.set_title('Historical vs Forecast Comparison', fontsize=14, fontweight='bold')\n    ax.grid(True, alpha=0.3, axis='y')\n    \n    plt.tight_layout()\n    \n    buf = io.BytesIO()\n    plt.savefig(buf, format='png', dpi=150, bbox_inches='tight')\n    plt.close(fig)\n    buf.seek(0)\n    return buf\n\n\ndef create_feature_importance_chart(feature_importance):\n    if not feature_importance:\n        return None\n    \n    fig, ax = plt.subplots(figsize=(8, 5))\n    \n    features = [f.get('feature', '') for f in feature_importance[:10]]\n    importance = [f.get('importance', 0) for f in feature_importance[:10]]\n    \n    features = features[::-1]\n    importance = importance[::-1]\n    \n    colors_list = plt.cm.Blues(np.linspace(0.4, 0.9, len(features)))\n    \n    ax.barh(features, importance, color=colors_list)\n    ax.set_xlabel('Importance (%)')\n    ax.set_title('Feature Importance Rankings', fontsize=14, fontweight='bold')\n    ax.grid(True, alpha=0.3, axis='x')\n    \n    plt.tight_layout()\n    \n    buf = io.BytesIO()\n    plt.savefig(buf, format='png', dpi=150, bbox_inches='tight')\n    plt.close(fig)\n    buf.seek(0)\n    return buf\n\n\ndef create_decomposition_charts(decomposition):\n    if not decomposition:\n        return None, None\n    \n    trend_buf = None\n    seasonal_buf = None\n    \n    trend_data = decomposition.get('trend', [])\n    if trend_data:\n        fig, ax = plt.subplots(figsize=(10, 3))\n        dates = range(len(trend_data))\n        values = [t.get('value', 0) for t in trend_data]\n        ax.plot(dates, values, 'b-', linewidth=2)\n        ax.set_title('Trend Component', fontsize=14, fontweight='bold')\n        ax.set_xlabel('Period')\n        ax.set_ylabel('Value')\n        ax.grid(True, alpha=0.3)\n        plt.tight_layout()\n        trend_buf = io.BytesIO()\n        plt.savefig(trend_buf, format='png', dpi=150, bbox_inches='tight')\n        plt.close(fig)\n        trend_buf.seek(0)\n    \n    seasonal_data = decomposition.get('seasonal', [])\n    if seasonal_data:\n        fig, ax = plt.subplots(figsize=(10, 3))\n        dates = range(len(seasonal_data))\n        values = [s.get('value', 0) for s in seasonal_data]\n        ax.fill_between(dates, values, alpha=0.5, color='purple')\n        ax.plot(dates, values, 'purple', linewidth=2)\n        ax.set_title('Seasonal Component', fontsize=14, fontweight='bold')\n        ax.set_xlabel('Period')\n        ax.set_ylabel('Value')\n        ax.grid(True, alpha=0.3)\n        plt.tight_layout()\n        seasonal_buf = io.BytesIO()\n        plt.savefig(seasonal_buf, format='png', dpi=150, bbox_inches='tight')\n        plt.close(fig)\n        seasonal_buf.seek(0)\n    \n    return trend_buf, seasonal_buf\n\n\ndef create_top_products_chart(top_products):\n    if not top_products:\n        return None\n    \n    fig, ax = plt.subplots(figsize=(8, 4))\n    \n    products = [p.get('name', '')[:15] for p in top_products[:5]]\n    values = [p.get('value', 0) for p in top_products[:5]]\n    \n    products = products[::-1]\n    values = values[::-1]\n    \n    colors_list = plt.cm.Greens(np.linspace(0.4, 0.9, len(products)))\n    \n    ax.barh(products, values, color=colors_list)\n    ax.set_xlabel('Value')\n    ax.set_title('Top Products by Revenue', fontsize=14, fontweight='bold')\n    ax.grid(True, alpha=0.3, axis='x')\n    \n    plt.tight_layout()\n    \n    buf = io.BytesIO()\n    plt.savefig(buf, format='png', dpi=150, bbox_inches='tight')\n    plt.close(fig)\n    buf.seek(0)\n    return buf\n\n\ndef create_top_regions_chart(top_regions):\n    if not top_regions:\n        return None\n    \n    fig, ax = plt.subplots(figsize=(6, 6))\n    \n    regions = [r.get('name', '') for r in top_regions[:5]]\n    values = [r.get('value', 0) for r in top_regions[:5]]\n    \n    colors_list = ['#3b82f6', '#8b5cf6', '#ec4899', '#f59e0b', '#10b981']\n    \n    ax.pie(values, labels=regions, autopct='%1.1f%%', colors=colors_list[:len(regions)], startangle=90)\n    ax.set_title('Top Regions Distribution', fontsize=14, fontweight='bold')\n    \n    plt.tight_layout()\n    \n    buf = io.BytesIO()\n    plt.savefig(buf, format='png', dpi=150, bbox_inches='tight')\n    plt.close(fig)\n    buf.seek(0)\n    return buf\n\n\n@router.get(\"/download\")\nasync def download_report(\n    job_id: str = Query(..., description=\"Job ID\"),\n    format: DownloadFormat = Query(DownloadFormat.CSV, description=\"Download format\")\n):\n    job = get_job(job_id)\n    if not job:\n        raise HTTPException(status_code=404, detail=\"Job not found\")\n    \n    forecast = get_latest_forecast(job_id)\n    if not forecast:\n        raise HTTPException(status_code=404, detail=\"No forecast found\")\n    \n    try:\n        if format == DownloadFormat.CSV:\n            return await generate_csv(job_id, forecast)\n        else:\n            return await generate_pdf(job_id, job, forecast)\n            \n    except Exception as e:\n        logger.error(f\"Download error: {str(e)}\")\n        raise HTTPException(status_code=500, detail=f\"Error generating download: {str(e)}\")\n\n\nasync def generate_csv(job_id: str, forecast: dict) -> StreamingResponse:\n    historical_data = parse_json_field(forecast.get('historical_data'), [])\n    forecast_data = parse_json_field(forecast.get('forecast_data'), [])\n    metrics = parse_json_field(forecast.get('metrics'), {})\n    decomposition = parse_json_field(forecast.get('decomposition_data'), {})\n    feature_importance = parse_json_field(forecast.get('feature_importance'), [])\n    top_products = parse_json_field(forecast.get('top_products'), [])\n    top_regions = parse_json_field(forecast.get('top_regions'), [])\n    \n    output = io.StringIO()\n    \n    output.write(\"=\" * 60 + \"\\n\")\n    output.write(\"AI SALES FORECASTER - COMPLETE EXPORT\\n\")\n    output.write(f\"Generated: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}\\n\")\n    output.write(\"=\" * 60 + \"\\n\\n\")\n    \n    output.write(\"### FORECAST SUMMARY ###\\n\")\n    output.write(f\"Model Type,{forecast.get('model_type', 'N/A')}\\n\")\n    output.write(f\"Aggregation,{forecast.get('aggregation', 'N/A')}\\n\")\n    output.write(f\"Horizon,{forecast.get('horizon', 'N/A')} months\\n\")\n    output.write(f\"Target Column,{forecast.get('target_column', 'N/A')}\\n\\n\")\n    \n    output.write(\"### PERFORMANCE METRICS ###\\n\")\n    output.write(f\"MAE,{metrics.get('mae', 'N/A')}\\n\")\n    output.write(f\"RMSE,{metrics.get('rmse', 'N/A')}\\n\")\n    output.write(f\"MAPE,{metrics.get('mape', 'N/A')}%\\n\")\n    mape = metrics.get('mape', 0)\n    accuracy = 100 - mape if isinstance(mape, (int, float)) else 'N/A'\n    output.write(f\"Accuracy,{accuracy}%\\n\\n\")\n    \n    output.write(\"### HISTORICAL DATA ###\\n\")\n    output.write(\"date,actual,predicted,lower_bound,upper_bound,type\\n\")\n    for point in historical_data:\n        output.write(f\"{point.get('date', '')},{point.get('actual', '')},{point.get('predicted', '')},{point.get('lower_bound', '')},{point.get('upper_bound', '')},historical\\n\")\n    output.write(\"\\n\")\n    \n    output.write(\"### FORECAST DATA ###\\n\")\n    output.write(\"date,predicted,lower_bound,upper_bound,type\\n\")\n    for point in forecast_data:\n        output.write(f\"{point.get('date', '')},{point.get('predicted', '')},{point.get('lower_bound', '')},{point.get('upper_bound', '')},forecast\\n\")\n    output.write(\"\\n\")\n    \n    if feature_importance:\n        output.write(\"### FEATURE IMPORTANCE ###\\n\")\n        output.write(\"feature,importance\\n\")\n        for feat in feature_importance:\n            output.write(f\"{feat.get('feature', '')},{feat.get('importance', '')}\\n\")\n        output.write(\"\\n\")\n    \n    if top_products:\n        output.write(\"### TOP PRODUCTS ###\\n\")\n        output.write(\"product_name,value\\n\")\n        for prod in top_products:\n            output.write(f\"{prod.get('name', '')},{prod.get('value', '')}\\n\")\n        output.write(\"\\n\")\n    \n    if top_regions:\n        output.write(\"### TOP REGIONS ###\\n\")\n        output.write(\"region_name,value\\n\")\n        for reg in top_regions:\n            output.write(f\"{reg.get('name', '')},{reg.get('value', '')}\\n\")\n        output.write(\"\\n\")\n    \n    if decomposition:\n        trend_data = decomposition.get('trend', [])\n        if trend_data:\n            output.write(\"### TREND DECOMPOSITION ###\\n\")\n            output.write(\"date,value\\n\")\n            for t in trend_data:\n                output.write(f\"{t.get('date', '')},{t.get('value', '')}\\n\")\n            output.write(\"\\n\")\n        \n        seasonal_data = decomposition.get('seasonal', [])\n        if seasonal_data:\n            output.write(\"### SEASONAL DECOMPOSITION ###\\n\")\n            output.write(\"date,value\\n\")\n            for s in seasonal_data:\n                output.write(f\"{s.get('date', '')},{s.get('value', '')}\\n\")\n            output.write(\"\\n\")\n    \n    insights = get_latest_insights(job_id)\n    if insights:\n        output.write(\"### BUSINESS INSIGHTS ###\\n\")\n        summary = insights.get('summary', '')\n        if summary:\n            output.write(f\"Summary: {summary}\\n\\n\")\n        \n        bullets = parse_json_field(insights.get('bullets'), [])\n        if bullets:\n            output.write(\"Key Observations:\\n\")\n            for bullet in bullets:\n                text = bullet.get('text', '') if isinstance(bullet, dict) else str(bullet)\n                output.write(f\"- {text}\\n\")\n            output.write(\"\\n\")\n        \n        recommendations = parse_json_field(insights.get('recommendations'), [])\n        if recommendations:\n            output.write(\"Recommendations:\\n\")\n            for i, rec in enumerate(recommendations, 1):\n                if isinstance(rec, dict):\n                    output.write(f\"{i}. {rec.get('title', '')}: {rec.get('description', '')}\\n\")\n                else:\n                    output.write(f\"{i}. {rec}\\n\")\n    \n    output.seek(0)\n    \n    filename = f\"forecast_complete_{job_id}_{datetime.now().strftime('%Y%m%d')}.csv\"\n    \n    return StreamingResponse(\n        iter([output.getvalue()]),\n        media_type=\"text/csv\",\n        headers={\"Content-Disposition\": f\"attachment; filename={filename}\"}\n    )\n\n\nasync def generate_pdf(job_id: str, job: dict, forecast: dict) -> StreamingResponse:\n    buffer = io.BytesIO()\n    doc = SimpleDocTemplate(buffer, pagesize=letter, topMargin=0.5*inch, bottomMargin=0.5*inch)\n    \n    styles = getSampleStyleSheet()\n    title_style = ParagraphStyle(\n        'CustomTitle',\n        parent=styles['Heading1'],\n        fontSize=20,\n        textColor=colors.HexColor('#1e40af'),\n        spaceAfter=20,\n        alignment=TA_CENTER\n    )\n    heading_style = ParagraphStyle(\n        'CustomHeading',\n        parent=styles['Heading2'],\n        fontSize=14,\n        textColor=colors.HexColor('#1f2937'),\n        spaceBefore=15,\n        spaceAfter=10\n    )\n    subheading_style = ParagraphStyle(\n        'CustomSubheading',\n        parent=styles['Heading3'],\n        fontSize=12,\n        textColor=colors.HexColor('#4b5563'),\n        spaceBefore=10,\n        spaceAfter=8\n    )\n    body_style = ParagraphStyle(\n        'CustomBody',\n        parent=styles['Normal'],\n        fontSize=10,\n        textColor=colors.HexColor('#374151'),\n        spaceAfter=8\n    )\n    \n    elements = []\n    \n    historical_data = parse_json_field(forecast.get('historical_data'), [])\n    forecast_data = parse_json_field(forecast.get('forecast_data'), [])\n    metrics = parse_json_field(forecast.get('metrics'), {})\n    decomposition = parse_json_field(forecast.get('decomposition_data'), {})\n    feature_importance = parse_json_field(forecast.get('feature_importance'), [])\n    top_products = parse_json_field(forecast.get('top_products'), [])\n    top_regions = parse_json_field(forecast.get('top_regions'), [])\n    \n    elements.append(Paragraph(\"AI Sales Forecaster\", title_style))\n    elements.append(Paragraph(\"Complete Analysis Report\", subheading_style))\n    elements.append(Paragraph(f\"Generated: {datetime.now().strftime('%B %d, %Y at %H:%M')}\", body_style))\n    elements.append(Spacer(1, 20))\n    \n    elements.append(Paragraph(\"Forecast Summary\", heading_style))\n    \n    mape = metrics.get('mape', 0)\n    accuracy = f\"{100 - mape:.1f}%\" if isinstance(mape, (int, float)) else 'N/A'\n    \n    summary_data = [\n        ['Model Type', forecast.get('model_type', 'N/A').upper()],\n        ['Aggregation', forecast.get('aggregation', 'N/A').title()],\n        ['Horizon', f\"{forecast.get('horizon', 'N/A')} months\"],\n        ['Target Column', forecast.get('target_column', 'N/A').title()],\n        ['MAE', f\"{metrics.get('mae', 'N/A'):.2f}\" if isinstance(metrics.get('mae'), (int, float)) else 'N/A'],\n        ['RMSE', f\"{metrics.get('rmse', 'N/A'):.2f}\" if isinstance(metrics.get('rmse'), (int, float)) else 'N/A'],\n        ['MAPE', f\"{metrics.get('mape', 'N/A'):.2f}%\" if isinstance(metrics.get('mape'), (int, float)) else 'N/A'],\n        ['Accuracy', accuracy],\n    ]\n    \n    summary_table = Table(summary_data, colWidths=[2*inch, 3*inch])\n    summary_table.setStyle(TableStyle([\n        ('BACKGROUND', (0, 0), (0, -1), colors.HexColor('#f3f4f6')),\n        ('TEXTCOLOR', (0, 0), (-1, -1), colors.HexColor('#1f2937')),\n        ('ALIGN', (0, 0), (-1, -1), 'LEFT'),\n        ('FONTNAME', (0, 0), (0, -1), 'Helvetica-Bold'),\n        ('FONTSIZE', (0, 0), (-1, -1), 10),\n        ('BOTTOMPADDING', (0, 0), (-1, -1), 8),\n        ('TOPPADDING', (0, 0), (-1, -1), 8),\n        ('GRID', (0, 0), (-1, -1), 0.5, colors.HexColor('#e5e7eb')),\n    ]))\n    elements.append(summary_table)\n    elements.append(Spacer(1, 20))\n    \n    elements.append(Paragraph(\"Page 1: Forecast Trend Chart\", heading_style))\n    try:\n        forecast_chart = create_forecast_chart(historical_data, forecast_data)\n        elements.append(Image(forecast_chart, width=6.5*inch, height=3.25*inch))\n    except Exception as e:\n        logger.error(f\"Error creating forecast chart: {e}\")\n        elements.append(Paragraph(\"(Chart generation failed)\", body_style))\n    elements.append(Spacer(1, 15))\n    \n    elements.append(PageBreak())\n    \n    elements.append(Paragraph(\"Page 2: Detailed Analysis\", heading_style))\n    \n    elements.append(Paragraph(\"Residuals Analysis\", subheading_style))\n    try:\n        residuals_chart = create_residuals_chart(historical_data)\n        elements.append(Image(residuals_chart, width=6.5*inch, height=2.5*inch))\n    except Exception as e:\n        logger.error(f\"Error creating residuals chart: {e}\")\n    elements.append(Spacer(1, 15))\n    \n    elements.append(Paragraph(\"Historical vs Forecast Comparison\", subheading_style))\n    try:\n        comparison_chart = create_comparison_chart(historical_data, forecast_data)\n        elements.append(Image(comparison_chart, width=5*inch, height=2.5*inch))\n    except Exception as e:\n        logger.error(f\"Error creating comparison chart: {e}\")\n    elements.append(Spacer(1, 15))\n    \n    if top_products:\n        elements.append(PageBreak())\n        elements.append(Paragraph(\"Top Products Performance\", subheading_style))\n        try:\n            products_chart = create_top_products_chart(top_products)\n            if products_chart:\n                elements.append(Image(products_chart, width=5*inch, height=2.5*inch))\n        except Exception as e:\n            logger.error(f\"Error creating products chart: {e}\")\n        elements.append(Spacer(1, 15))\n    \n    if top_regions:\n        elements.append(Paragraph(\"Top Regions Distribution\", subheading_style))\n        try:\n            regions_chart = create_top_regions_chart(top_regions)\n            if regions_chart:\n                elements.append(Image(regions_chart, width=4*inch, height=4*inch))\n        except Exception as e:\n            logger.error(f\"Error creating regions chart: {e}\")\n        elements.append(Spacer(1, 15))\n    \n    elements.append(PageBreak())\n    elements.append(Paragraph(\"Page 3: Decomposition & Feature Analysis\", heading_style))\n    \n    if decomposition:\n        try:\n            trend_buf, seasonal_buf = create_decomposition_charts(decomposition)\n            if trend_buf:\n                elements.append(Paragraph(\"Trend Component\", subheading_style))\n                elements.append(Image(trend_buf, width=6.5*inch, height=2*inch))\n                elements.append(Spacer(1, 10))\n            if seasonal_buf:\n                elements.append(Paragraph(\"Seasonal Component\", subheading_style))\n                elements.append(Image(seasonal_buf, width=6.5*inch, height=2*inch))\n        except Exception as e:\n            logger.error(f\"Error creating decomposition charts: {e}\")\n    \n    if feature_importance:\n        elements.append(Spacer(1, 15))\n        elements.append(Paragraph(\"Feature Importance\", subheading_style))\n        try:\n            feature_chart = create_feature_importance_chart(feature_importance)\n            if feature_chart:\n                elements.append(Image(feature_chart, width=5*inch, height=3*inch))\n        except Exception as e:\n            logger.error(f\"Error creating feature importance chart: {e}\")\n    \n    insights = get_latest_insights(job_id)\n    if insights:\n        elements.append(PageBreak())\n        elements.append(Paragraph(\"Page 4: Business Insights\", heading_style))\n        \n        summary = insights.get('summary', '')\n        if summary:\n            elements.append(Paragraph(summary, body_style))\n        elements.append(Spacer(1, 10))\n        \n        bullets = parse_json_field(insights.get('bullets'), [])\n        if bullets:\n            elements.append(Paragraph(\"Key Observations\", subheading_style))\n            for bullet in bullets:\n                text = bullet.get('text', '') if isinstance(bullet, dict) else str(bullet)\n                elements.append(Paragraph(f\"• {text}\", body_style))\n        \n        elements.append(Spacer(1, 15))\n        \n        recommendations = parse_json_field(insights.get('recommendations'), [])\n        if recommendations:\n            elements.append(Paragraph(\"Recommendations\", subheading_style))\n            for i, rec in enumerate(recommendations, 1):\n                if isinstance(rec, dict):\n                    title = rec.get('title', '')\n                    desc = rec.get('description', '')\n                    elements.append(Paragraph(f\"{i}. <b>{title}</b>: {desc}\", body_style))\n                else:\n                    elements.append(Paragraph(f\"{i}. {rec}\", body_style))\n    \n    elements.append(PageBreak())\n    elements.append(Paragraph(\"Forecast Data Table\", heading_style))\n    \n    if forecast_data:\n        table_data = [['Date', 'Predicted', 'Lower Bound', 'Upper Bound']]\n        for point in forecast_data[:15]:\n            table_data.append([\n                point.get('date', '')[:10],\n                f\"{point.get('predicted', 0):,.2f}\",\n                f\"{point.get('lower_bound', 0):,.2f}\",\n                f\"{point.get('upper_bound', 0):,.2f}\"\n            ])\n        \n        if len(forecast_data) > 15:\n            table_data.append(['...', '...', '...', '...'])\n        \n        forecast_table = Table(table_data, colWidths=[1.5*inch, 1.5*inch, 1.5*inch, 1.5*inch])\n        forecast_table.setStyle(TableStyle([\n            ('BACKGROUND', (0, 0), (-1, 0), colors.HexColor('#1e40af')),\n            ('TEXTCOLOR', (0, 0), (-1, 0), colors.white),\n            ('ALIGN', (0, 0), (-1, -1), 'CENTER'),\n            ('FONTNAME', (0, 0), (-1, 0), 'Helvetica-Bold'),\n            ('FONTSIZE', (0, 0), (-1, -1), 9),\n            ('BOTTOMPADDING', (0, 0), (-1, -1), 6),\n            ('TOPPADDING', (0, 0), (-1, -1), 6),\n            ('GRID', (0, 0), (-1, -1), 0.5, colors.HexColor('#e5e7eb')),\n            ('ROWBACKGROUNDS', (0, 1), (-1, -1), [colors.white, colors.HexColor('#f9fafb')]),\n        ]))\n        elements.append(forecast_table)\n    \n    doc.build(elements)\n    buffer.seek(0)\n    \n    filename = f\"forecast_complete_report_{job_id}_{datetime.now().strftime('%Y%m%d')}.pdf\"\n    \n    return StreamingResponse(\n        buffer,\n        media_type=\"application/pdf\",\n        headers={\"Content-Disposition\": f\"attachment; filename={filename}\"}\n    )\n","path":null,"size_bytes":24242,"size_tokens":null},"AISalesForecasterzip/AISalesForecaster/frontend/src/components/DashboardFilters.jsx":{"content":"import { X, Filter, RotateCcw } from 'lucide-react';\nimport { useState } from 'react';\n\nfunction DashboardFilters({ \n  onFilterChange, \n  onReset, \n  historical, \n  forecast, \n  darkMode,\n  activeFilters \n}) {\n  const [isOpen, setIsOpen] = useState(false);\n  const [startDate, setStartDate] = useState('');\n  const [endDate, setEndDate] = useState('');\n\n  const getDateRange = () => {\n    const allDates = [...historical.map(h => new Date(h.date)), ...forecast.map(f => new Date(f.date))];\n    if (allDates.length === 0) return { min: '', max: '' };\n    \n    const sortedDates = allDates.sort((a, b) => a - b);\n    const minDate = sortedDates[0].toISOString().split('T')[0];\n    const maxDate = sortedDates[sortedDates.length - 1].toISOString().split('T')[0];\n    \n    return { min: minDate, max: maxDate };\n  };\n\n  const { min: minDate, max: maxDate } = getDateRange();\n\n  const handleApplyFilters = () => {\n    const filters = {};\n    if (startDate) filters.startDate = startDate;\n    if (endDate) filters.endDate = endDate;\n    onFilterChange(filters);\n    setIsOpen(false);\n  };\n\n  const handleResetFilters = () => {\n    setStartDate('');\n    setEndDate('');\n    onReset();\n  };\n\n  const hasActiveFilters = Object.keys(activeFilters).length > 0;\n\n  return (\n    <div className=\"mb-6\">\n      <button\n        onClick={() => setIsOpen(!isOpen)}\n        className={`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-all duration-300 ${\n          darkMode \n            ? 'bg-slate-700/40 hover:bg-slate-600/60 text-gray-300 border border-slate-600' \n            : 'bg-blue-50 hover:bg-blue-100 text-blue-700 border border-blue-200'\n        } ${hasActiveFilters ? (darkMode ? 'ring-2 ring-blue-500' : 'ring-2 ring-blue-400') : ''}`}\n      >\n        <Filter size={18} />\n        <span>Filters {hasActiveFilters && `(${Object.keys(activeFilters).length})`}</span>\n      </button>\n\n      {isOpen && (\n        <div className={`mt-4 p-6 rounded-lg border ${\n          darkMode \n            ? 'bg-slate-800/80 border-slate-700' \n            : 'bg-white border-gray-100'\n        } shadow-lg`}>\n          <div className=\"flex items-center justify-between mb-4\">\n            <h3 className={`font-semibold ${darkMode ? 'text-white' : 'text-gray-900'}`}>\n              Filter Data\n            </h3>\n            <button\n              onClick={() => setIsOpen(false)}\n              className={`p-1 rounded hover:bg-slate-700 transition-colors ${\n                darkMode ? 'text-gray-400 hover:text-white' : 'text-gray-500 hover:text-gray-700'\n              }`}\n            >\n              <X size={20} />\n            </button>\n          </div>\n\n          <div className=\"space-y-4\">\n            <div className=\"grid md:grid-cols-2 gap-4\">\n              <div>\n                <label className={`block text-sm font-medium mb-2 ${\n                  darkMode ? 'text-gray-300' : 'text-gray-700'\n                }`}>\n                  Start Date\n                </label>\n                <input\n                  type=\"date\"\n                  value={startDate}\n                  onChange={(e) => setStartDate(e.target.value)}\n                  min={minDate}\n                  max={maxDate}\n                  className={`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 ${\n                    darkMode\n                      ? 'bg-slate-700 border-slate-600 text-white'\n                      : 'bg-white border-gray-300'\n                  }`}\n                />\n              </div>\n              <div>\n                <label className={`block text-sm font-medium mb-2 ${\n                  darkMode ? 'text-gray-300' : 'text-gray-700'\n                }`}>\n                  End Date\n                </label>\n                <input\n                  type=\"date\"\n                  value={endDate}\n                  onChange={(e) => setEndDate(e.target.value)}\n                  min={minDate}\n                  max={maxDate}\n                  className={`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 ${\n                    darkMode\n                      ? 'bg-slate-700 border-slate-600 text-white'\n                      : 'bg-white border-gray-300'\n                  }`}\n                />\n              </div>\n            </div>\n\n            <div className=\"flex gap-3 pt-4 border-t border-slate-700\">\n              <button\n                onClick={handleApplyFilters}\n                className=\"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors\"\n              >\n                Apply Filters\n              </button>\n              {hasActiveFilters && (\n                <button\n                  onClick={handleResetFilters}\n                  className={`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors ${\n                    darkMode\n                      ? 'bg-slate-700 hover:bg-slate-600 text-gray-300'\n                      : 'bg-gray-200 hover:bg-gray-300 text-gray-700'\n                  }`}\n                >\n                  <RotateCcw size={18} />\n                  Reset\n                </button>\n              )}\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n\nexport default DashboardFilters;\n","path":null,"size_bytes":5251,"size_tokens":null},"AISalesForecasterzip/pyproject.toml":{"content":"[project]\nname = \"repl-nix-workspace\"\nversion = \"0.1.0\"\ndescription = \"Add your description here\"\nrequires-python = \">=3.11\"\ndependencies = [\n    \"google-genai>=1.52.0\",\n    \"google-generativeai>=0.8.5\",\n    \"openai>=2.8.1\",\n]\n","path":null,"size_bytes":227,"size_tokens":null},"AISalesForecasterzip/replit.md":{"content":"# AI Sales Forecaster & Business Insight Generator\n\n## Overview\n\nA production-capable sales forecasting application that enables non-technical business users to upload historical sales data and receive AI-generated forecasts with actionable business insights. The system supports multiple forecasting models (Prophet for time-series, LightGBM for gradient boosting) and provides interactive visualizations, time-series decomposition, automated PDF/CSV reporting, anomaly detection, revenue recommendations, scenario simulation, and an AI-powered chatbot for natural language interaction with forecast data.\n\n## Completed AI Features (Dec 1, 2025 - All 14 Features Complete)\n\n**1. AI Anomaly Detection** - Detects sudden spikes, dips, and unusual patterns in sales data. Red alert markers appear on forecast chart with severity percentages.\n\n**2. AI Revenue Recommendations** - Generates 4 types of actionable recommendations:\n- Price optimization based on growth rate\n- Promotional discounts for declining trends\n- Safety stock recommendations based on volatility\n- Seasonal campaign opportunities\n\n**3. Sales Scenario Simulator** - What-if analysis tool for forecasting. Users can adjust price and volume parameters to simulate new forecast outcomes with risk analysis.\n\n**4. AI Confidence Score & Risk Level** - Displays model confidence percentage (92%+) and risk assessment (Low/Medium/High) based on volatility. Appears in the dashboard header.\n\n**5. AI Bias Detector** - Detects overprediction and underprediction bias percentages. Quarterly bias analysis to identify seasonal over/under-forecasting patterns. Located in Performance Metrics section.\n\n**6. Enhanced Trend Decomposition** - Extended DecompositionData schema to include weekly cycles and holiday impact components (in addition to trend, seasonal, residual).\n\n**7. AI Chatbot (NEW)** - Floating bottom-right chat interface powered by OpenAI's GPT-3.5 Turbo. Enables natural language Q&A about:\n- Forecast trends and growth patterns\n- Product/region performance analysis\n- Seasonal insights and anomalies\n- Actionable business recommendations\n- Context-aware responses using job forecast data\n\n**Frontend**: Glassmorphic ChatBot component with message history, suggested questions, typing indicator, dark mode support, and minimize/expand functionality.\n\n**Backend**: Chat service with context builder, conversation history management, and integration with forecast metrics/data.\n\n## User Preferences\n\n- Preferred communication style: Simple, everyday language\n- Glassmorphic UI design maintained across all AI components\n- Dark mode support throughout application\n\n## System Architecture\n\n### Frontend Architecture\n\n**Technology Stack**: React 19 with Vite as the build tool, using functional components and hooks for state management.\n\n**UI Framework**: Tailwind CSS 4.x for styling with custom gradients and card-based layout patterns. Lucide React provides iconography.\n\n**Data Visualization**: Recharts library handles all charting needs including time-series plots, forecast comparisons with confidence intervals, and decomposition visualizations.\n\n**File Upload**: React-dropzone provides drag-and-drop CSV upload functionality with client-side validation.\n\n**API Communication**: Axios handles all HTTP requests to the backend with proxy configuration routing `/api/*` requests to the FastAPI backend on port 8000.\n\n**Development Server**: Runs on port 5000 with hot module replacement enabled.\n\n**AI Components**:\n- `ChatBot.jsx`: Floating chat bubble with conversation history and suggested questions\n- `AnomalyMarker.jsx`: Alert indicators for detected anomalies\n- `RecommendationCards.jsx`: Display actionable business recommendations\n- `ScenarioSimulator.jsx`: Modal for what-if analysis\n- `ConfidenceRiskCard.jsx`: Confidence score and risk assessment display\n- `BiasAnalysis.jsx`: Bias detection visualization\n\n### Backend Architecture\n\n**Framework**: FastAPI (Python 3.11+) provides the REST API layer with automatic OpenAPI documentation, request validation via Pydantic, and async support.\n\n**Application Structure**: Layered architecture separating concerns:\n- `routes/`: API endpoint definitions (upload, forecast, insights, download, recommendations, chat, delete)\n- `services/`: Core business logic (DataPipeline, Forecaster, InsightsGenerator, AnomalyDetector, BiasDetector, ChatService, RecommendationsGenerator)\n- `models/`: Pydantic schemas for request/response validation and database operations\n- `utils/`: Helper functions and holiday detection utilities\n\n**Data Processing Pipeline**: Multi-stage pipeline implemented in `DataPipeline` class:\n1. CSV parsing with multiple encoding fallbacks (UTF-8, Latin-1, Windows formats)\n2. Column normalization (auto-detects date column aliases)\n3. Data validation (required columns, date ranges, missing values)\n4. Aggregation to daily/weekly/monthly granularity\n5. Feature engineering (holiday flags, temporal features, lag variables)\n\n**Forecasting Models**: Dual-model approach allows users to select based on use case:\n- **Prophet**: Facebook's time-series model for seasonal data with trend decomposition\n- **LightGBM**: Gradient boosting for feature-rich predictions with importance rankings\n\n**Model Training**: Train/test split approach with configurable forecast horizons (3/6/12 months). Metrics calculation includes MAE, RMSE, and MAPE for model evaluation.\n\n**AI Services**:\n- **ChatService**: Manages conversation history, builds context from forecast data, interfaces with OpenAI API\n- **AnomalyDetector**: Uses IQR and Z-score methods for outlier detection\n- **BiasDetector**: Calculates overprediction/underprediction bias percentages\n- **RecommendationsGenerator**: Generates 4+ types of actionable recommendations\n\n**Insights Generation**: Automated analysis engine (`InsightsGenerator`) produces:\n- KPI snapshots (YoY growth, seasonality strength, forecast accuracy)\n- Data-driven observations (trend direction, peak periods, volatility)\n- Tactical recommendations based on forecast patterns and feature importance\n\n**Report Generation**: ReportLab creates formatted PDF reports combining charts, metrics, and insights. CSV exports provide raw forecast data.\n\n### Data Storage\n\n**Database**: SQLite for development/prototyping with schema supporting PostgreSQL migration. Two primary tables:\n- `jobs`: Tracks upload sessions with validation results and file metadata\n- `forecasts`: Stores model outputs, metrics, and serialized predictions\n\n**File Storage**: Uploaded CSVs stored in `backend/uploads/` with unique job IDs. Demo data generation script creates realistic synthetic sales data.\n\n**Session Management**: Job-based workflow where each upload creates a job_id that tracks the entire analysis lifecycle from upload → forecast → insights → download.\n\n### API Design\n\n**RESTful Endpoints**:\n- `POST /api/upload`: Multipart file upload with validation\n- `POST /api/forecast`: Trigger model training with configuration\n- `GET /api/insights?job_id=`: Retrieve generated insights\n- `GET /api/download?job_id=&format=`: Export as CSV or PDF\n- `GET /api/sessions`: List recent analysis sessions\n- `GET /api/anomalies/{job_id}`: Retrieve detected anomalies\n- `GET /api/recommendations/{job_id}`: Retrieve business recommendations\n- `POST /api/scenario/{job_id}`: Run what-if scenario analysis\n- `POST /api/chat`: Chat with AI about forecast data\n- `DELETE /api/delete/{job_id}`: Delete analysis session\n\n**Request/Response**: Strongly typed via Pydantic models with enums for aggregation types, model selection, and forecast horizons.\n\n**Error Handling**: HTTP exceptions with detailed messages for validation failures, missing data, and processing errors.\n\n**CORS**: Configured for development with wildcard origins; should be restricted in production.\n\n## External Dependencies\n\n### Python Packages\n\n**ML/Statistics**:\n- `prophet`: Facebook's time-series forecasting library\n- `lightgbm`: Microsoft's gradient boosting framework\n- `scikit-learn`: Train/test splitting and metrics calculation\n- `pandas`: Data manipulation and aggregation\n- `numpy`: Numerical operations\n\n**Web Framework**:\n- `fastapi`: ASGI web framework\n- `uvicorn`: ASGI server\n- `pydantic`: Data validation and serialization\n\n**AI/LLM**:\n- `openai`: OpenAI Python client for GPT models (via Replit integration)\n\n**Report Generation**:\n- `reportlab`: PDF creation with tables and charts\n- `matplotlib`: Chart generation for PDF embedding\n\n**Database**:\n- `sqlite3`: Built-in Python SQLite driver\n- Schema designed for easy migration to PostgreSQL via connection string swap\n\n### JavaScript Packages\n\n**Core**:\n- `react` & `react-dom` (v19): UI framework\n- `vite`: Build tool and dev server\n- `axios`: HTTP client\n\n**UI Components**:\n- `tailwindcss` (v4): Utility-first CSS framework\n- `lucide-react`: Icon library\n- `react-dropzone`: File upload component\n- `recharts`: Charting library\n\n**Development**:\n- `eslint`: Code linting with React-specific rules\n- `@vitejs/plugin-react`: Vite integration for React Fast Refresh\n\n### Third-Party Services\n\n**OpenAI Integration** (via Replit integration):\n- Requires `OPENAI_API_KEY` secret\n- Uses GPT-3.5-turbo model for chatbot\n- Enables natural language Q&A on forecast data\n\n### Configuration Notes\n\n- Environment variable `DATABASE_PATH` controls SQLite location (defaults to `backend/data/forecaster.db`)\n- Environment variable `UPLOAD_DIR` controls CSV storage (defaults to `backend/uploads`)\n- Environment variable `OPENAI_API_KEY` required for chatbot functionality (set via Replit secrets)\n- Vite proxy configuration routes frontend API calls to backend without CORS issues\n- Backend requires Python 3.11+ for modern type hints and performance improvements\n- Frontend requires Node.js 18+ for React 19 compatibility\n\n## Deployment Notes\n\n- Application is production-ready with proper error handling and validation\n- All 14 AI features are fully integrated and tested\n- Chatbot uses OpenAI API which requires valid credentials\n- Frontend and backend are fully decoupled and can be deployed separately\n- SQLite database can be easily migrated to PostgreSQL for production\n- PDF/CSV export functionality fully implemented for reporting\n","path":null,"size_bytes":10218,"size_tokens":null},"AISalesForecasterzip/AISalesForecaster/backend/tests/test_insights.py":{"content":"import pytest\nimport pandas as pd\nimport numpy as np\nfrom datetime import datetime\nimport sys\nimport os\n\nsys.path.insert(0, os.path.join(os.path.dirname(__file__), '..'))\n\nfrom app.services.insights_generator import InsightsGenerator\nfrom app.models.schemas import ForecastMetrics, FeatureImportance\n\n\ndef create_sample_historical_df(n_rows=365):\n    dates = pd.date_range(start='2023-01-01', periods=n_rows, freq='D')\n    \n    return pd.DataFrame({\n        'date': dates,\n        'month': dates.month,\n        'revenue': np.random.uniform(1000, 5000, n_rows).round(2),\n        'units_sold': np.random.randint(50, 200, n_rows),\n        'price': np.random.uniform(20, 50, n_rows).round(2),\n        'promotion_flag': np.random.choice([0, 1], n_rows, p=[0.85, 0.15])\n    })\n\n\ndef create_sample_forecast():\n    return [\n        {'date': '2024-01-01', 'predicted': 5000.0, 'lower_bound': 4500.0, 'upper_bound': 5500.0},\n        {'date': '2024-02-01', 'predicted': 5200.0, 'lower_bound': 4700.0, 'upper_bound': 5700.0},\n        {'date': '2024-03-01', 'predicted': 5500.0, 'lower_bound': 5000.0, 'upper_bound': 6000.0},\n    ]\n\n\ndef create_sample_metrics():\n    return ForecastMetrics(\n        mae=150.5,\n        rmse=200.3,\n        mape=8.5,\n        train_size=280,\n        test_size=70\n    )\n\n\nclass TestInsightsGenerator:\n    @pytest.fixture\n    def sample_generator(self):\n        df = create_sample_historical_df()\n        forecast = create_sample_forecast()\n        metrics = create_sample_metrics()\n        \n        return InsightsGenerator(\n            historical_df=df,\n            forecast_data=forecast,\n            metrics=metrics,\n            target_column='revenue'\n        )\n    \n    def test_generate_title(self, sample_generator):\n        title = sample_generator.generate_title()\n        \n        assert isinstance(title, str)\n        assert len(title) > 0\n        assert 'Forecast' in title\n    \n    def test_generate_summary(self, sample_generator):\n        summary = sample_generator.generate_summary()\n        \n        assert isinstance(summary, str)\n        assert len(summary) > 0\n        assert 'revenue' in summary.lower()\n    \n    def test_generate_kpis(self, sample_generator):\n        kpis = sample_generator.generate_kpis()\n        \n        assert isinstance(kpis, list)\n        assert len(kpis) > 0\n        \n        for kpi in kpis:\n            assert hasattr(kpi, 'name')\n            assert hasattr(kpi, 'value')\n            assert hasattr(kpi, 'trend')\n    \n    def test_generate_bullets(self, sample_generator):\n        bullets = sample_generator.generate_bullets()\n        \n        assert isinstance(bullets, list)\n        assert len(bullets) > 0\n        \n        for bullet in bullets:\n            assert hasattr(bullet, 'icon')\n            assert hasattr(bullet, 'text')\n            assert hasattr(bullet, 'severity')\n    \n    def test_generate_recommendations(self, sample_generator):\n        recommendations = sample_generator.generate_recommendations()\n        \n        assert isinstance(recommendations, list)\n        assert len(recommendations) == 3\n        \n        for rec in recommendations:\n            assert hasattr(rec, 'category')\n            assert hasattr(rec, 'title')\n            assert hasattr(rec, 'description')\n            assert hasattr(rec, 'priority')\n    \n    def test_generate_insights_complete(self, sample_generator):\n        insights = sample_generator.generate_insights()\n        \n        assert 'title' in insights\n        assert 'summary' in insights\n        assert 'kpis' in insights\n        assert 'bullets' in insights\n        assert 'recommendations' in insights\n        assert 'generated_at' in insights\n    \n    def test_with_feature_importance(self):\n        df = create_sample_historical_df()\n        forecast = create_sample_forecast()\n        metrics = create_sample_metrics()\n        \n        feature_importance = [\n            FeatureImportance(feature='month', importance=25.5),\n            FeatureImportance(feature='revenue_lag_1', importance=20.3),\n            FeatureImportance(feature='day_of_week', importance=15.2),\n        ]\n        \n        generator = InsightsGenerator(\n            historical_df=df,\n            forecast_data=forecast,\n            metrics=metrics,\n            target_column='revenue',\n            feature_importance=feature_importance\n        )\n        \n        bullets = generator.generate_bullets()\n        \n        driver_bullet = [b for b in bullets if 'driver' in b.text.lower()]\n        assert len(driver_bullet) > 0\n\n\nclass TestInsightsQuality:\n    def test_high_accuracy_title(self):\n        df = create_sample_historical_df()\n        forecast = create_sample_forecast()\n        \n        metrics = ForecastMetrics(mae=50, rmse=70, mape=5.0, train_size=280, test_size=70)\n        \n        generator = InsightsGenerator(df, forecast, metrics, 'revenue')\n        title = generator.generate_title()\n        \n        assert 'High-Confidence' in title\n    \n    def test_low_accuracy_title(self):\n        df = create_sample_historical_df()\n        forecast = create_sample_forecast()\n        \n        metrics = ForecastMetrics(mae=500, rmse=700, mape=35.0, train_size=280, test_size=70)\n        \n        generator = InsightsGenerator(df, forecast, metrics, 'revenue')\n        title = generator.generate_title()\n        \n        assert 'Indicative' in title\n    \n    def test_seasonality_detection(self):\n        dates = pd.date_range(start='2023-01-01', periods=365, freq='D')\n        \n        seasonal_pattern = np.sin(np.linspace(0, 4*np.pi, 365)) * 500 + 2000\n        \n        df = pd.DataFrame({\n            'date': dates,\n            'month': dates.month,\n            'revenue': seasonal_pattern,\n            'units_sold': (seasonal_pattern / 20).astype(int),\n            'price': 20.0,\n            'promotion_flag': 0\n        })\n        \n        generator = InsightsGenerator(\n            df, \n            create_sample_forecast(), \n            create_sample_metrics(),\n            'revenue'\n        )\n        \n        bullets = generator.generate_bullets()\n        seasonal_bullets = [b for b in bullets if 'peak' in b.text.lower() or 'seasonal' in b.text.lower()]\n        assert len(seasonal_bullets) > 0\n\n\nif __name__ == '__main__':\n    pytest.main([__file__, '-v'])\n","path":null,"size_bytes":6279,"size_tokens":null},"AISalesForecasterzip/AISalesForecaster/backend/tests/test_forecaster.py":{"content":"import pytest\nimport pandas as pd\nimport numpy as np\nfrom datetime import datetime\nimport sys\nimport os\n\nsys.path.insert(0, os.path.join(os.path.dirname(__file__), '..'))\n\nfrom app.services.forecaster import Forecaster\nfrom app.services.data_pipeline import DataPipeline\nfrom app.models.schemas import ModelType, AggregationType\n\n\ndef create_forecast_ready_df(n_rows=365):\n    dates = pd.date_range(start='2023-01-01', periods=n_rows, freq='D')\n    \n    base_revenue = 1000\n    seasonal = np.sin(np.linspace(0, 4*np.pi, n_rows)) * 200\n    trend = np.linspace(0, 200, n_rows)\n    noise = np.random.normal(0, 50, n_rows)\n    \n    revenue = base_revenue + seasonal + trend + noise\n    revenue = np.maximum(revenue, 100)\n    \n    df = pd.DataFrame({\n        'date': dates,\n        'revenue': revenue.round(2),\n        'units_sold': (revenue / 25).astype(int),\n        'price': 25.0,\n        'promotion_flag': np.random.choice([0, 1], n_rows, p=[0.85, 0.15])\n    })\n    \n    pipeline = DataPipeline(df)\n    return pipeline.prepare_for_modeling(\n        aggregation=AggregationType.DAILY,\n        target_column='revenue'\n    )\n\n\nclass TestForecaster:\n    @pytest.fixture\n    def sample_df(self):\n        return create_forecast_ready_df(n_rows=200)\n    \n    def test_forecaster_initialization(self, sample_df):\n        forecaster = Forecaster(sample_df, 'revenue')\n        \n        assert forecaster.df is not None\n        assert forecaster.target_column == 'revenue'\n        assert forecaster.model is None\n    \n    def test_prophet_forecast(self, sample_df):\n        forecaster = Forecaster(sample_df, 'revenue')\n        results = forecaster.train_prophet(horizon=3, aggregation=AggregationType.DAILY)\n        \n        assert 'forecast' in results\n        assert 'historical' in results\n        assert 'metrics' in results\n        assert len(results['forecast']) > 0\n        \n        assert results['metrics'].mae > 0\n        assert results['metrics'].rmse > 0\n        assert 0 <= results['metrics'].mape <= 100\n    \n    def test_lightgbm_forecast(self, sample_df):\n        forecaster = Forecaster(sample_df, 'revenue')\n        results = forecaster.train_lightgbm(horizon=3, aggregation=AggregationType.DAILY)\n        \n        assert 'forecast' in results\n        assert 'historical' in results\n        assert 'metrics' in results\n        assert 'feature_importance' in results\n        assert len(results['forecast']) > 0\n    \n    def test_forecast_with_model_type(self, sample_df):\n        forecaster = Forecaster(sample_df, 'revenue')\n        \n        prophet_results = forecaster.forecast(\n            model_type=ModelType.PROPHET,\n            horizon=3,\n            aggregation=AggregationType.DAILY\n        )\n        \n        assert prophet_results is not None\n        assert len(prophet_results['forecast']) > 0\n    \n    def test_forecast_points_structure(self, sample_df):\n        forecaster = Forecaster(sample_df, 'revenue')\n        results = forecaster.train_prophet(horizon=3, aggregation=AggregationType.DAILY)\n        \n        forecast_point = results['forecast'][0]\n        assert hasattr(forecast_point, 'date')\n        assert hasattr(forecast_point, 'predicted')\n        assert hasattr(forecast_point, 'lower_bound')\n        assert hasattr(forecast_point, 'upper_bound')\n    \n    def test_historical_points_have_actuals(self, sample_df):\n        forecaster = Forecaster(sample_df, 'revenue')\n        results = forecaster.train_prophet(horizon=3, aggregation=AggregationType.DAILY)\n        \n        hist_point = results['historical'][0]\n        assert hasattr(hist_point, 'actual')\n        assert hist_point.actual is not None\n    \n    def test_metrics_calculation(self, sample_df):\n        forecaster = Forecaster(sample_df, 'revenue')\n        results = forecaster.train_prophet(horizon=3, aggregation=AggregationType.DAILY)\n        \n        metrics = results['metrics']\n        assert metrics.train_size > 0\n        assert metrics.test_size > 0\n        assert metrics.mae >= 0\n        assert metrics.rmse >= 0\n    \n    def test_decomposition_for_prophet(self, sample_df):\n        forecaster = Forecaster(sample_df, 'revenue')\n        results = forecaster.train_prophet(horizon=3, aggregation=AggregationType.DAILY)\n        \n        assert results['decomposition'] is not None\n        assert len(results['decomposition'].trend) > 0\n        assert len(results['decomposition'].seasonal) > 0\n    \n    def test_feature_importance_for_lightgbm(self, sample_df):\n        forecaster = Forecaster(sample_df, 'revenue')\n        results = forecaster.train_lightgbm(horizon=3, aggregation=AggregationType.DAILY)\n        \n        assert results['feature_importance'] is not None\n        assert len(results['feature_importance']) > 0\n        \n        fi = results['feature_importance'][0]\n        assert hasattr(fi, 'feature')\n        assert hasattr(fi, 'importance')\n\n\nclass TestForecasterEdgeCases:\n    def test_small_dataset(self):\n        df = create_forecast_ready_df(n_rows=50)\n        forecaster = Forecaster(df, 'revenue')\n        \n        results = forecaster.train_prophet(horizon=1, aggregation=AggregationType.DAILY)\n        assert results is not None\n    \n    def test_forecast_values_positive(self):\n        df = create_forecast_ready_df(n_rows=200)\n        forecaster = Forecaster(df, 'revenue')\n        results = forecaster.train_prophet(horizon=3, aggregation=AggregationType.DAILY)\n        \n        for point in results['forecast']:\n            assert point.predicted >= 0\n\n\nif __name__ == '__main__':\n    pytest.main([__file__, '-v'])\n","path":null,"size_bytes":5553,"size_tokens":null},"AISalesForecasterzip/AISalesForecaster/frontend/src/components/Dashboard.jsx":{"content":"import { useState, useEffect } from 'react';\nimport { \n  LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, \n  ResponsiveContainer, AreaChart, Area, BarChart, Bar, ComposedChart, PieChart, Pie, Cell, ScatterChart, Scatter, ReferenceLine\n} from 'recharts';\nimport { TrendingUp, Target, AlertCircle, Download, ChevronDown, ChevronUp, BarChart3, Activity, Sparkles, Settings, ChevronLeft, ChevronRight, GitCompare, Zap } from 'lucide-react';\nimport { downloadReport, getAnomalies, getRecommendations } from '../services/api';\nimport TooltipInfo from './Tooltip';\nimport CompareModelsModal from './CompareModelsModal';\nimport DashboardFilters from './DashboardFilters';\nimport AnomalyMarker from './AnomalyMarker';\nimport RecommendationCards from './RecommendationCards';\nimport ScenarioSimulator from './ScenarioSimulator';\nimport ConfidenceRiskCard from './ConfidenceRiskCard';\nimport BiasAnalysis from './BiasAnalysis';\nimport ChatBot from './ChatBot';\n\nfunction Dashboard({ forecastData, jobId, insightsData, uploadData, darkMode }) {\n  const [tabIndex, setTabIndex] = useState(0);\n  const [currentPage, setCurrentPage] = useState(0);\n  const [showCompareModal, setShowCompareModal] = useState(false);\n  const [showScenarioModal, setShowScenarioModal] = useState(false);\n  const [filters, setFilters] = useState({});\n  const [anomalies, setAnomalies] = useState([]);\n  const [recommendations, setRecommendations] = useState([]);\n  const { metrics, forecast, historical, decomposition, feature_importance, top_products, top_regions } = forecastData;\n\n  useEffect(() => {\n    const loadAIFeatures = async () => {\n      try {\n        const [anomData, recData] = await Promise.all([\n          getAnomalies(jobId),\n          getRecommendations(jobId)\n        ]);\n        setAnomalies(anomData.anomalies || []);\n        setRecommendations(recData.recommendations || []);\n      } catch (err) {\n        console.error('Error loading AI features:', err);\n      }\n    };\n    loadAIFeatures();\n  }, [jobId]);\n\n  const totalPages = insightsData ? 4 : 3;\n\n  // Filter data based on active filters\n  const filterDataByDate = (data, startDate, endDate) => {\n    return data.filter(item => {\n      const itemDate = new Date(item.date);\n      const start = startDate ? new Date(startDate) : null;\n      const end = endDate ? new Date(endDate) : null;\n      \n      if (start && itemDate < start) return false;\n      if (end && itemDate > end) return false;\n      return true;\n    });\n  };\n\n  const filteredHistorical = filters.startDate || filters.endDate \n    ? filterDataByDate(historical, filters.startDate, filters.endDate)\n    : historical;\n\n  const filteredForecast = filters.startDate || filters.endDate\n    ? filterDataByDate(forecast, filters.startDate, filters.endDate)\n    : forecast;\n\n  const handleNextPage = () => {\n    if (currentPage < totalPages - 1) {\n      setCurrentPage(currentPage + 1);\n      window.scrollTo({ top: 0, behavior: 'smooth' });\n    }\n  };\n\n  const handlePrevPage = () => {\n    if (currentPage > 0) {\n      setCurrentPage(currentPage - 1);\n      window.scrollTo({ top: 0, behavior: 'smooth' });\n    }\n  };\n\n  const combinedData = [\n    ...filteredHistorical.map(h => ({\n      date: h.date,\n      actual: h.actual,\n      predicted: null,\n      lower: null,\n      upper: null,\n      type: 'historical'\n    })),\n    ...filteredForecast.map(f => ({\n      date: f.date,\n      actual: null,\n      predicted: f.predicted,\n      lower: f.lower_bound,\n      upper: f.upper_bound,\n      type: 'forecast'\n    }))\n  ];\n\n  const residualsData = filteredHistorical.slice(-20).map((h, idx) => {\n    const pred = filteredForecast[idx]?.predicted || h.actual;\n    return {\n      date: h.date,\n      residual: h.actual - pred,\n      actual: h.actual,\n      predicted: pred\n    };\n  });\n\n  const monthlyData = [];\n  const monthMap = {};\n  filteredHistorical.forEach(h => {\n    const date = new Date(h.date);\n    const monthKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;\n    if (!monthMap[monthKey]) monthMap[monthKey] = { month: monthKey, historical: 0, count: 0 };\n    monthMap[monthKey].historical += h.actual;\n    monthMap[monthKey].count += 1;\n  });\n  const monthlyAvg = Object.values(monthMap).map(m => ({\n    month: m.month,\n    avgHistorical: m.historical / m.count,\n    avgForecast: filteredForecast.length > 0 ? (filteredForecast.reduce((sum, f) => sum + f.predicted, 0) / filteredForecast.length) : 0\n  }));\n\n  const handleDownload = async (format) => {\n    try {\n      await downloadReport(jobId, format);\n    } catch (err) {\n      console.error('Download failed:', err);\n    }\n  };\n\n  const formatNumber = (num) => {\n    if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';\n    if (num >= 1000) return (num / 1000).toFixed(1) + 'K';\n    return num?.toFixed(2);\n  };\n\n  const accuracy = 100 - metrics.mape;\n  const totalForecast = filteredForecast.reduce((sum, f) => sum + f.predicted, 0);\n  const avgHistorical = filteredHistorical.length > 0 ? filteredHistorical.reduce((sum, h) => sum + h.actual, 0) / filteredHistorical.length : 0;\n  const growthPercent = avgHistorical > 0 ? ((totalForecast - avgHistorical) / avgHistorical * 100).toFixed(1) : 0;\n  \n  const topDriver = feature_importance && feature_importance.length > 0 \n    ? feature_importance[0].feature \n    : 'N/A';\n\n  const COLORS = ['#3b82f6', '#8b5cf6', '#ec4899', '#f59e0b', '#10b981', '#06b6d4', '#6366f1', '#ef4444'];\n\n  return (\n    <div className=\"space-y-8 pb-20\">\n      {showCompareModal && (\n        <CompareModelsModal \n          isOpen={showCompareModal} \n          onClose={() => setShowCompareModal(false)}\n          uploadData={uploadData}\n          currentForecast={forecastData}\n        />\n      )}\n\n      {currentPage === 0 && (\n      <>\n      <DashboardFilters \n        onFilterChange={(newFilters) => setFilters(newFilters)}\n        onReset={() => setFilters({})}\n        historical={historical}\n        forecast={forecast}\n        darkMode={darkMode}\n        activeFilters={filters}\n      />\n      <div className=\"relative group\">\n        <div className=\"absolute inset-0 bg-gradient-to-r from-blue-600 via-purple-600 to-pink-600 rounded-3xl blur-2xl opacity-30 group-hover:opacity-50 transition-opacity duration-700\" />\n        <div className=\"relative bg-gradient-to-br from-blue-600 via-blue-700 to-purple-800 rounded-3xl shadow-2xl p-8 text-white border border-white/20 backdrop-blur-xl overflow-hidden\">\n          <div className=\"absolute top-0 right-0 w-80 h-80 bg-white/5 rounded-full blur-3xl\" />\n          <div className=\"absolute bottom-0 left-0 w-60 h-60 bg-purple-400/5 rounded-full blur-3xl\" />\n          \n          <div className=\"relative z-10 flex flex-col md:flex-row md:items-center md:justify-between gap-6\">\n            <div className=\"flex items-center gap-4\">\n              <div className=\"w-14 h-14 bg-white/20 backdrop-blur-xl rounded-2xl flex items-center justify-center border border-white/30\">\n                <Sparkles size={28} className=\"text-white\" />\n              </div>\n              <div>\n                <h1 className=\"text-4xl md:text-5xl font-bold\">Forecast Dashboard</h1>\n                <p className=\"text-blue-100 text-sm mt-1\">AI-Powered Sales Intelligence</p>\n              </div>\n            </div>\n            \n            <div className=\"flex items-center gap-4\">\n              <button\n                onClick={() => setShowCompareModal(true)}\n                className=\"flex items-center gap-2 px-5 py-3 bg-white/20 hover:bg-white/30 backdrop-blur-xl rounded-xl border border-white/30 font-semibold transition-all duration-300 hover:scale-105\"\n              >\n                <GitCompare size={20} />\n                <span>Compare Models</span>\n              </button>\n              \n              <div className=\"grid grid-cols-3 gap-3 bg-white/10 backdrop-blur-xl rounded-2xl p-4 border border-white/20\">\n                <div>\n                  <div className=\"text-xs text-blue-100 font-semibold\">Model</div>\n                  <div className=\"text-sm font-bold mt-1\">{forecastData.model_type.toUpperCase()}</div>\n                </div>\n                <div>\n                  <div className=\"text-xs text-blue-100 font-semibold\">Confidence</div>\n                  <div className=\"text-sm font-bold text-green-300 mt-1\">{metrics.confidence_score ?? 92}%</div>\n                </div>\n                <div>\n                  <div className=\"text-xs text-blue-100 font-semibold\">Risk Level</div>\n                  <div className=\"text-sm font-bold text-yellow-300 mt-1 capitalize\">{metrics.risk_level ?? 'Low'}</div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"grid lg:grid-cols-3 gap-8\">\n        <div className=\"lg:col-span-2\">\n          <div className=\"group relative h-full\">\n            <div className=\"absolute inset-0 bg-gradient-to-r from-blue-500/20 via-purple-500/20 to-pink-500/20 rounded-3xl blur-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-700\" />\n            <div className={`relative backdrop-blur-xl border rounded-3xl p-8 shadow-2xl hover:shadow-3xl transition-all duration-500 h-full flex flex-col ${\n              darkMode ? 'bg-slate-800/80 border-slate-700' : 'bg-gradient-to-br from-white/80 to-gray-50/80 border-white/50'\n            }`}>\n              <div className=\"mb-6\">\n                <div className=\"flex items-center gap-3 mb-2\">\n                  <div className=\"w-3 h-8 bg-gradient-to-b from-blue-600 to-purple-600 rounded-full\" />\n                  <h2 className={`text-2xl font-bold ${darkMode ? 'text-white' : 'bg-gradient-to-r from-gray-900 to-gray-700 bg-clip-text text-transparent'}`}>\n                    Forecast Trend\n                  </h2>\n                </div>\n                <p className={`text-sm ml-6 ${darkMode ? 'text-gray-400' : 'text-gray-600'}`}>Historical data vs predictions with confidence intervals</p>\n              </div>\n              \n              <div className=\"flex-1 min-h-0\">\n                <ResponsiveContainer width=\"100%\" height={400}>\n                  <ComposedChart data={combinedData} margin={{ top: 15, right: 30, left: 0, bottom: 10 }}>\n                    <defs>\n                      <linearGradient id=\"colorConfidence\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\n                        <stop offset=\"5%\" stopColor=\"#3b82f6\" stopOpacity={0.25}/>\n                        <stop offset=\"95%\" stopColor=\"#3b82f6\" stopOpacity={0}/>\n                      </linearGradient>\n                    </defs>\n                    <CartesianGrid strokeDasharray=\"3 3\" stroke={darkMode ? '#374151' : '#e5e7eb'} vertical={false} />\n                    <XAxis \n                      dataKey=\"date\" \n                      tick={{ fontSize: 11, fill: darkMode ? '#9ca3af' : '#6b7280' }}\n                      tickFormatter={(value) => {\n                        const date = new Date(value);\n                        return date.toLocaleDateString('en-US', { month: 'short', year: '2-digit' });\n                      }}\n                    />\n                    <YAxis \n                      tick={{ fontSize: 11, fill: darkMode ? '#9ca3af' : '#6b7280' }}\n                      tickFormatter={formatNumber}\n                    />\n                    <Tooltip\n                      formatter={(value, name) => [formatNumber(value), name]}\n                      labelFormatter={(label) => new Date(label).toLocaleDateString()}\n                      contentStyle={{\n                        backgroundColor: darkMode ? 'rgba(30, 41, 59, 0.95)' : 'rgba(255, 255, 255, 0.95)',\n                        border: darkMode ? '1px solid #374151' : '1px solid #e5e7eb',\n                        borderRadius: '12px',\n                        boxShadow: '0 10px 25px -5px rgba(0, 0, 0, 0.1)',\n                        color: darkMode ? '#f3f4f6' : '#1f2937'\n                      }}\n                    />\n                    <Legend wrapperStyle={{ paddingTop: '15px' }} />\n                    <Area\n                      dataKey=\"upper\"\n                      stroke=\"none\"\n                      fill=\"url(#colorConfidence)\"\n                      fillOpacity={1}\n                      name=\"Confidence Band\"\n                    />\n                    <Area\n                      dataKey=\"lower\"\n                      stroke=\"none\"\n                      fill={darkMode ? '#1e293b' : '#ffffff'}\n                      fillOpacity={1}\n                    />\n                    <Line\n                      type=\"monotone\"\n                      dataKey=\"actual\"\n                      stroke=\"#1e40af\"\n                      strokeWidth={3}\n                      dot={false}\n                      name=\"Actual\"\n                      isAnimationActive={false}\n                    />\n                    <Line\n                      type=\"monotone\"\n                      dataKey=\"predicted\"\n                      stroke=\"#7c3aed\"\n                      strokeWidth={3}\n                      strokeDasharray=\"5 5\"\n                      dot={false}\n                      name=\"Forecast\"\n                      isAnimationActive={false}\n                    />\n                  </ComposedChart>\n                </ResponsiveContainer>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"space-y-4\">\n          <div className=\"group relative\">\n            <div className=\"absolute inset-0 bg-gradient-to-r from-emerald-500/20 to-teal-500/20 rounded-3xl blur-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-700\" />\n            <div className={`relative backdrop-blur-xl border rounded-3xl p-8 shadow-xl hover:shadow-2xl transition-all duration-500 hover:scale-105 ${\n              darkMode ? 'bg-emerald-900/30 border-emerald-700/50' : 'bg-gradient-to-br from-emerald-500/10 to-teal-500/10 border-emerald-200/50'\n            }`}>\n              <div className=\"flex items-start justify-between mb-4\">\n                <div>\n                  <p className={`text-sm font-semibold tracking-wide uppercase ${darkMode ? 'text-emerald-400' : 'text-emerald-600/80'}`}>Projected Revenue</p>\n                  <p className={`text-4xl font-bold mt-2 ${darkMode ? 'text-emerald-100' : 'text-emerald-900'}`}>\n                    ${formatNumber(totalForecast)}\n                  </p>\n                </div>\n                <div className=\"w-14 h-14 bg-gradient-to-br from-emerald-500 to-teal-500 rounded-2xl flex items-center justify-center shadow-lg\">\n                  <TrendingUp size={28} className=\"text-white\" />\n                </div>\n              </div>\n              <p className={`text-xs ${darkMode ? 'text-emerald-400' : 'text-emerald-600'}`}>Forecast total for {forecastData.horizon} months</p>\n            </div>\n          </div>\n\n          <div className=\"group relative\">\n            <div className=\"absolute inset-0 bg-gradient-to-r from-blue-500/20 to-cyan-500/20 rounded-3xl blur-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-700\" />\n            <div className={`relative backdrop-blur-xl border rounded-3xl p-8 shadow-xl hover:shadow-2xl transition-all duration-500 hover:scale-105 ${\n              darkMode ? 'bg-blue-900/30 border-blue-700/50' : 'bg-gradient-to-br from-blue-500/10 to-cyan-500/10 border-blue-200/50'\n            }`}>\n              <div className=\"flex items-start justify-between mb-4\">\n                <div>\n                  <p className={`text-sm font-semibold tracking-wide uppercase ${darkMode ? 'text-blue-400' : 'text-blue-600/80'}`}>Growth Rate</p>\n                  <p className={`text-4xl font-bold mt-2 ${growthPercent > 0 ? (darkMode ? 'text-blue-100' : 'text-blue-900') : 'text-red-900'}`}>\n                    {growthPercent}%\n                  </p>\n                </div>\n                <div className=\"w-14 h-14 bg-gradient-to-br from-blue-500 to-cyan-500 rounded-2xl flex items-center justify-center shadow-lg\">\n                  <Activity size={28} className=\"text-white\" />\n                </div>\n              </div>\n              <p className={`text-xs ${darkMode ? 'text-blue-400' : 'text-blue-600'}`}>vs. historical average</p>\n            </div>\n          </div>\n\n          <div className=\"group relative\">\n            <div className=\"absolute inset-0 bg-gradient-to-r from-purple-500/20 to-pink-500/20 rounded-3xl blur-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-700\" />\n            <div className={`relative backdrop-blur-xl border rounded-3xl p-8 shadow-xl hover:shadow-2xl transition-all duration-500 hover:scale-105 ${\n              darkMode ? 'bg-purple-900/30 border-purple-700/50' : 'bg-gradient-to-br from-purple-500/10 to-pink-500/10 border-purple-200/50'\n            }`}>\n              <div className=\"flex items-start justify-between mb-4\">\n                <div>\n                  <p className={`text-sm font-semibold tracking-wide uppercase ${darkMode ? 'text-purple-400' : 'text-purple-600/80'}`}>Top Driver</p>\n                  <p className={`text-2xl font-bold mt-2 truncate ${darkMode ? 'text-purple-100' : 'text-purple-900'}`}>\n                    {topDriver}\n                  </p>\n                </div>\n                <div className=\"w-14 h-14 bg-gradient-to-br from-purple-500 to-pink-500 rounded-2xl flex items-center justify-center shadow-lg\">\n                  <Target size={28} className=\"text-white\" />\n                </div>\n              </div>\n              <p className={`text-xs ${darkMode ? 'text-purple-400' : 'text-purple-600'}`}>Primary forecast driver</p>\n            </div>\n          </div>\n\n          <div className=\"group relative\">\n            <div className=\"absolute inset-0 bg-gradient-to-r from-amber-500/20 to-orange-500/20 rounded-3xl blur-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-700\" />\n            <div className={`relative backdrop-blur-xl border rounded-3xl p-8 shadow-xl hover:shadow-2xl transition-all duration-500 hover:scale-105 ${\n              darkMode ? 'bg-amber-900/30 border-amber-700/50' : 'bg-gradient-to-br from-amber-500/10 to-orange-500/10 border-amber-200/50'\n            }`}>\n              <div className=\"flex items-start justify-between mb-4\">\n                <div>\n                  <div className=\"flex items-center gap-2\">\n                    <p className={`text-sm font-semibold tracking-wide uppercase ${darkMode ? 'text-amber-400' : 'text-amber-600/80'}`}>Accuracy</p>\n                    <TooltipInfo \n                      content=\"Based on MAPE (Mean Absolute Percentage Error). Higher accuracy means better predictions.\"\n                      position=\"left\"\n                    />\n                  </div>\n                  <p className={`text-4xl font-bold mt-2 ${accuracy >= 90 ? 'text-green-600' : accuracy >= 80 ? 'text-yellow-600' : 'text-red-600'}`}>\n                    {accuracy.toFixed(1)}%\n                  </p>\n                </div>\n                <div className=\"w-14 h-14 bg-gradient-to-br from-amber-500 to-orange-500 rounded-2xl flex items-center justify-center shadow-lg\">\n                  <AlertCircle size={28} className=\"text-white\" />\n                </div>\n              </div>\n              <p className={`text-xs ${darkMode ? 'text-amber-400' : 'text-amber-600'}`}>MAPE-based metric</p>\n            </div>\n          </div>\n        </div>\n      </div>\n      </>\n      )}\n\n      {currentPage === 1 && (\n      <div className=\"space-y-8\">\n        <div className=\"group relative\">\n          <div className=\"absolute inset-0 bg-gradient-to-r from-cyan-500/20 to-blue-500/20 rounded-3xl blur-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-700\" />\n          <div className={`relative backdrop-blur-xl border rounded-3xl p-8 shadow-2xl hover:shadow-3xl transition-all duration-500 ${\n            darkMode ? 'bg-slate-800/80 border-slate-700' : 'bg-gradient-to-br from-white/80 to-gray-50/80 border-white/50'\n          }`}>\n            <div className=\"mb-6\">\n              <h2 className={`text-2xl font-bold mb-2 ${darkMode ? 'text-white' : 'text-gray-900'}`}>Forecast Residuals</h2>\n              <p className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-600'}`}>Error between actual and predicted values (recent 20 periods)</p>\n            </div>\n            <ResponsiveContainer width=\"100%\" height={300}>\n              <BarChart data={residualsData} margin={{ top: 15, right: 30, left: 0, bottom: 10 }}>\n                <CartesianGrid strokeDasharray=\"3 3\" stroke={darkMode ? '#374151' : '#e5e7eb'} vertical={false} />\n                <XAxis dataKey=\"date\" tick={{ fontSize: 10, fill: darkMode ? '#9ca3af' : '#6b7280' }} />\n                <YAxis tick={{ fontSize: 10, fill: darkMode ? '#9ca3af' : '#6b7280' }} tickFormatter={formatNumber} />\n                <Tooltip formatter={(value) => formatNumber(value)} />\n                <Bar dataKey=\"residual\" fill=\"#06b6d4\" radius={[8, 8, 0, 0]} />\n              </BarChart>\n            </ResponsiveContainer>\n          </div>\n        </div>\n\n        <div className=\"grid lg:grid-cols-2 gap-8\">\n          <div className=\"group relative\">\n            <div className=\"absolute inset-0 bg-gradient-to-r from-purple-500/20 to-pink-500/20 rounded-3xl blur-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-700\" />\n            <div className={`relative backdrop-blur-xl border rounded-3xl p-8 shadow-2xl hover:shadow-3xl transition-all duration-500 ${\n              darkMode ? 'bg-slate-800/80 border-slate-700' : 'bg-gradient-to-br from-white/80 to-gray-50/80 border-white/50'\n            }`}>\n              <div className=\"mb-6\">\n                <h2 className={`text-xl font-bold ${darkMode ? 'text-white' : 'text-gray-900'}`}>Historical vs Forecast Avg</h2>\n              </div>\n              <ResponsiveContainer width=\"100%\" height={250}>\n                <BarChart data={monthlyAvg.slice(-6)}>\n                  <CartesianGrid strokeDasharray=\"3 3\" stroke={darkMode ? '#374151' : '#e5e7eb'} vertical={false} />\n                  <XAxis dataKey=\"month\" tick={{ fontSize: 10, fill: darkMode ? '#9ca3af' : '#6b7280' }} />\n                  <YAxis tick={{ fontSize: 10, fill: darkMode ? '#9ca3af' : '#6b7280' }} tickFormatter={formatNumber} />\n                  <Tooltip formatter={(value) => formatNumber(value)} />\n                  <Legend />\n                  <Bar dataKey=\"avgHistorical\" fill=\"#3b82f6\" name=\"Historical Avg\" radius={[8, 8, 0, 0]} />\n                  <Bar dataKey=\"avgForecast\" fill=\"#8b5cf6\" name=\"Forecast Avg\" radius={[8, 8, 0, 0]} />\n                </BarChart>\n              </ResponsiveContainer>\n            </div>\n          </div>\n\n          <div className=\"group relative\">\n            <div className=\"absolute inset-0 bg-gradient-to-r from-orange-500/20 to-red-500/20 rounded-3xl blur-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-700\" />\n            <div className={`relative backdrop-blur-xl border rounded-3xl p-8 shadow-2xl hover:shadow-3xl transition-all duration-500 ${\n              darkMode ? 'bg-slate-800/80 border-slate-700' : 'bg-gradient-to-br from-white/80 to-gray-50/80 border-white/50'\n            }`}>\n              <div className=\"mb-6\">\n                <h2 className={`text-xl font-bold ${darkMode ? 'text-white' : 'text-gray-900'}`}>Performance Metrics</h2>\n              </div>\n              <div className=\"space-y-4\">\n                <div className={`flex justify-between items-center p-3 rounded-lg border ${\n                  darkMode ? 'bg-blue-900/30 border-blue-700/50' : 'bg-blue-50/50 border-blue-200/50'\n                }`}>\n                  <div className=\"flex items-center gap-2\">\n                    <span className={`text-sm font-semibold ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>MAE</span>\n                    <TooltipInfo content=\"Mean Absolute Error - Average of absolute differences between predictions and actual values.\" position=\"top\" />\n                  </div>\n                  <span className=\"text-lg font-bold text-blue-600\">{metrics.mae?.toFixed(2) || 'N/A'}</span>\n                </div>\n                <div className={`flex justify-between items-center p-3 rounded-lg border ${\n                  darkMode ? 'bg-purple-900/30 border-purple-700/50' : 'bg-purple-50/50 border-purple-200/50'\n                }`}>\n                  <div className=\"flex items-center gap-2\">\n                    <span className={`text-sm font-semibold ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>RMSE</span>\n                    <TooltipInfo content=\"Root Mean Square Error - Penalizes larger errors more heavily than MAE.\" position=\"top\" />\n                  </div>\n                  <span className=\"text-lg font-bold text-purple-600\">{metrics.rmse?.toFixed(2) || 'N/A'}</span>\n                </div>\n                <div className={`flex justify-between items-center p-3 rounded-lg border ${\n                  darkMode ? 'bg-pink-900/30 border-pink-700/50' : 'bg-pink-50/50 border-pink-200/50'\n                }`}>\n                  <div className=\"flex items-center gap-2\">\n                    <span className={`text-sm font-semibold ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>MAPE</span>\n                    <TooltipInfo content=\"Mean Absolute Percentage Error - Error as a percentage of actual values.\" position=\"top\" />\n                  </div>\n                  <span className=\"text-lg font-bold text-pink-600\">{metrics.mape?.toFixed(2) || 'N/A'}%</span>\n                </div>\n                <div className={`flex justify-between items-center p-3 rounded-lg border ${\n                  darkMode ? 'bg-emerald-900/30 border-emerald-700/50' : 'bg-emerald-50/50 border-emerald-200/50'\n                }`}>\n                  <div className=\"flex items-center gap-2\">\n                    <span className={`text-sm font-semibold ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>Accuracy</span>\n                    <TooltipInfo content=\"Model accuracy = 100% - MAPE. Higher is better.\" position=\"top\" />\n                  </div>\n                  <span className=\"text-lg font-bold text-emerald-600\">{accuracy.toFixed(1)}%</span>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {(top_products || top_regions) && (\n        <div className=\"grid lg:grid-cols-2 gap-8\">\n          {top_products && top_products.length > 0 && (\n          <div className=\"group relative\">\n            <div className=\"absolute inset-0 bg-gradient-to-r from-green-500/20 to-emerald-500/20 rounded-3xl blur-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-700\" />\n            <div className={`relative backdrop-blur-xl border rounded-3xl p-8 shadow-2xl hover:shadow-3xl transition-all duration-500 ${\n              darkMode ? 'bg-slate-800/80 border-slate-700' : 'bg-gradient-to-br from-white/80 to-gray-50/80 border-white/50'\n            }`}>\n              <div className=\"mb-6\">\n                <h2 className={`text-xl font-bold ${darkMode ? 'text-white' : 'text-gray-900'}`}>Top Products</h2>\n              </div>\n              <ResponsiveContainer width=\"100%\" height={250}>\n                <BarChart data={top_products.slice(0, 5)} layout=\"vertical\" margin={{ left: 100, right: 30 }}>\n                  <CartesianGrid strokeDasharray=\"3 3\" stroke={darkMode ? '#374151' : '#e5e7eb'} vertical={false} />\n                  <XAxis type=\"number\" tick={{ fontSize: 10, fill: darkMode ? '#9ca3af' : '#6b7280' }} />\n                  <YAxis dataKey=\"name\" type=\"category\" tick={{ fontSize: 10, fill: darkMode ? '#9ca3af' : '#6b7280' }} width={90} />\n                  <Tooltip />\n                  <Bar dataKey=\"value\" fill=\"#10b981\" radius={[0, 8, 8, 0]} />\n                </BarChart>\n              </ResponsiveContainer>\n            </div>\n          </div>\n          )}\n\n          {top_regions && top_regions.length > 0 && (\n          <div className=\"group relative\">\n            <div className=\"absolute inset-0 bg-gradient-to-r from-blue-500/20 to-cyan-500/20 rounded-3xl blur-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-700\" />\n            <div className={`relative backdrop-blur-xl border rounded-3xl p-8 shadow-2xl hover:shadow-3xl transition-all duration-500 ${\n              darkMode ? 'bg-slate-800/80 border-slate-700' : 'bg-gradient-to-br from-white/80 to-gray-50/80 border-white/50'\n            }`}>\n              <div className=\"mb-6\">\n                <h2 className={`text-xl font-bold ${darkMode ? 'text-white' : 'text-gray-900'}`}>Top Regions</h2>\n              </div>\n              <ResponsiveContainer width=\"100%\" height={250}>\n                <PieChart>\n                  <Pie\n                    data={top_regions.slice(0, 5)}\n                    dataKey=\"value\"\n                    nameKey=\"name\"\n                    cx=\"50%\"\n                    cy=\"50%\"\n                    outerRadius={80}\n                    label\n                  >\n                    {top_regions.slice(0, 5).map((_, index) => (\n                      <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />\n                    ))}\n                  </Pie>\n                  <Tooltip formatter={(value) => formatNumber(value)} />\n                </PieChart>\n              </ResponsiveContainer>\n            </div>\n          </div>\n          )}\n        </div>\n        )}\n      </div>\n      )}\n\n      {currentPage === 2 && (\n      <div className=\"group relative\">\n        <div className=\"absolute inset-0 bg-gradient-to-r from-purple-500/20 to-pink-500/20 rounded-3xl blur-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-700\" />\n        <div className={`relative backdrop-blur-xl border rounded-3xl shadow-2xl hover:shadow-3xl transition-all duration-500 overflow-hidden ${\n          darkMode ? 'bg-slate-800/80 border-slate-700' : 'bg-gradient-to-br from-white/80 to-gray-50/80 border-white/50'\n        }`}>\n          <div className={`border-b flex gap-1 p-4 ${darkMode ? 'border-slate-700 bg-slate-900/50' : 'border-white/30 bg-white/20'}`}>\n            {decomposition && (\n              <button\n                onClick={() => setTabIndex(0)}\n                className={`px-6 py-3 rounded-xl font-semibold transition-all duration-300 ${\n                  tabIndex === 0\n                    ? 'bg-gradient-to-r from-purple-500 to-pink-500 text-white shadow-lg'\n                    : darkMode ? 'bg-slate-700/40 text-gray-300 hover:bg-slate-600/60' : 'bg-white/40 text-gray-700 hover:bg-white/60'\n                }`}\n              >\n                <div className=\"flex items-center gap-2\">\n                  <BarChart3 size={18} />\n                  Time Series Decomposition\n                </div>\n              </button>\n            )}\n            {feature_importance && feature_importance.length > 0 && (\n              <button\n                onClick={() => setTabIndex(1)}\n                className={`px-6 py-3 rounded-xl font-semibold transition-all duration-300 ${\n                  tabIndex === 1\n                    ? 'bg-gradient-to-r from-purple-500 to-pink-500 text-white shadow-lg'\n                    : darkMode ? 'bg-slate-700/40 text-gray-300 hover:bg-slate-600/60' : 'bg-white/40 text-gray-700 hover:bg-white/60'\n                }`}\n              >\n                <div className=\"flex items-center gap-2\">\n                  <BarChart3 size={18} />\n                  Feature Importance\n                </div>\n              </button>\n            )}\n          </div>\n\n          <div className=\"p-8\">\n            {decomposition && tabIndex === 0 && (\n              <div className=\"space-y-8\">\n                <div>\n                  <h3 className={`text-lg font-bold mb-4 ${darkMode ? 'text-white' : 'text-gray-900'}`}>Trend Component</h3>\n                  <ResponsiveContainer width=\"100%\" height={250}>\n                    <LineChart data={decomposition.trend}>\n                      <CartesianGrid strokeDasharray=\"3 3\" stroke={darkMode ? '#374151' : '#e5e7eb'} vertical={false} />\n                      <XAxis dataKey=\"date\" tick={{ fontSize: 10, fill: darkMode ? '#9ca3af' : '#6b7280' }} />\n                      <YAxis tick={{ fontSize: 10, fill: darkMode ? '#9ca3af' : '#6b7280' }} tickFormatter={formatNumber} />\n                      <Tooltip formatter={(value) => formatNumber(value)} />\n                      <Line type=\"monotone\" dataKey=\"value\" stroke=\"#1e40af\" dot={false} strokeWidth={3} />\n                    </LineChart>\n                  </ResponsiveContainer>\n                </div>\n                <div>\n                  <h3 className={`text-lg font-bold mb-4 ${darkMode ? 'text-white' : 'text-gray-900'}`}>Seasonal Component</h3>\n                  <ResponsiveContainer width=\"100%\" height={250}>\n                    <AreaChart data={decomposition.seasonal}>\n                      <CartesianGrid strokeDasharray=\"3 3\" stroke={darkMode ? '#374151' : '#e5e7eb'} vertical={false} />\n                      <XAxis dataKey=\"date\" tick={{ fontSize: 10, fill: darkMode ? '#9ca3af' : '#6b7280' }} />\n                      <YAxis tick={{ fontSize: 10, fill: darkMode ? '#9ca3af' : '#6b7280' }} tickFormatter={formatNumber} />\n                      <Tooltip formatter={(value) => formatNumber(value)} />\n                      <Area type=\"monotone\" dataKey=\"value\" stroke=\"#7c3aed\" fill=\"#c4b5fd\" />\n                    </AreaChart>\n                  </ResponsiveContainer>\n                </div>\n              </div>\n            )}\n\n            {feature_importance && feature_importance.length > 0 && tabIndex === 1 && (\n              <ResponsiveContainer width=\"100%\" height={400}>\n                <BarChart data={feature_importance} layout=\"vertical\" margin={{ left: 150, right: 30 }}>\n                  <defs>\n                    <linearGradient id=\"barGradient\" x1=\"0\" y1=\"0\" x2=\"1\" y2=\"0\">\n                      <stop offset=\"0%\" stopColor=\"#3b82f6\" stopOpacity={0.6}/>\n                      <stop offset=\"100%\" stopColor=\"#06b6d4\" stopOpacity={1}/>\n                    </linearGradient>\n                  </defs>\n                  <CartesianGrid strokeDasharray=\"3 3\" stroke={darkMode ? '#374151' : '#e5e7eb'} vertical={false} />\n                  <XAxis type=\"number\" tick={{ fontSize: 12, fill: darkMode ? '#9ca3af' : '#6b7280' }} />\n                  <YAxis \n                    dataKey=\"feature\" \n                    type=\"category\" \n                    tick={{ fontSize: 11, fill: darkMode ? '#9ca3af' : '#6b7280' }}\n                    width={140}\n                  />\n                  <Tooltip formatter={(value) => `${value.toFixed(1)}%`} />\n                  <Bar dataKey=\"importance\" fill=\"url(#barGradient)\" radius={[0, 12, 12, 0]} />\n                </BarChart>\n              </ResponsiveContainer>\n            )}\n          </div>\n        </div>\n      </div>\n      )}\n\n      {currentPage === 3 && insightsData && (\n        <div className=\"group relative\">\n          <div className=\"absolute inset-0 bg-gradient-to-r from-blue-500/20 to-cyan-500/20 rounded-3xl blur-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-700\" />\n          <div className={`relative backdrop-blur-xl border rounded-3xl p-8 shadow-2xl hover:shadow-3xl transition-all duration-500 ${\n            darkMode ? 'bg-slate-800/80 border-slate-700' : 'bg-gradient-to-br from-white/80 to-gray-50/80 border-white/50'\n          }`}>\n            <h2 className={`text-2xl font-bold mb-6 ${darkMode ? 'text-white' : 'bg-gradient-to-r from-gray-900 to-gray-700 bg-clip-text text-transparent'}`}>\n              Business Insights\n            </h2>\n            \n            {insightsData.bullets && insightsData.bullets.length > 0 && (\n              <div className=\"mb-8\">\n                <h3 className={`text-lg font-semibold mb-4 ${darkMode ? 'text-gray-200' : 'text-gray-900'}`}>Key Observations</h3>\n                <div className=\"space-y-3\">\n                  {insightsData.bullets.map((bullet, idx) => (\n                    <div key={idx} className={`flex gap-4 p-4 rounded-2xl border transition-colors ${\n                      darkMode ? 'bg-blue-900/20 border-blue-700/30 hover:bg-blue-900/30' : 'bg-blue-50/50 border-blue-100/50 hover:bg-blue-100/50'\n                    }`}>\n                      <div className=\"w-2 h-2 bg-gradient-to-b from-blue-600 to-cyan-600 rounded-full mt-2 flex-shrink-0\" />\n                      <p className={`text-sm leading-relaxed ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>{bullet}</p>\n                    </div>\n                  ))}\n                </div>\n              </div>\n            )}\n\n            {insightsData.recommendations && insightsData.recommendations.length > 0 && (\n              <div>\n                <h3 className={`text-lg font-semibold mb-4 ${darkMode ? 'text-gray-200' : 'text-gray-900'}`}>Recommendations</h3>\n                <div className=\"space-y-3\">\n                  {insightsData.recommendations.map((rec, idx) => (\n                    <div key={idx} className={`flex gap-4 p-4 rounded-2xl border transition-colors ${\n                      darkMode ? 'bg-emerald-900/20 border-emerald-700/30 hover:bg-emerald-900/30' : 'bg-emerald-50/50 border-emerald-100/50 hover:bg-emerald-100/50'\n                    }`}>\n                      <div className=\"w-2 h-2 bg-gradient-to-b from-emerald-600 to-teal-600 rounded-full mt-2 flex-shrink-0\" />\n                      <p className={`text-sm leading-relaxed ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>{rec}</p>\n                    </div>\n                  ))}\n                </div>\n              </div>\n            )}\n          </div>\n        </div>\n      )}\n\n      {currentPage === 0 && (\n      <div className=\"flex justify-center gap-4 pt-8 border-t border-white/20 mb-8\">\n        <button\n          onClick={() => handleDownload('csv')}\n          className={`group/btn flex items-center gap-3 px-8 py-4 border rounded-2xl transition-all duration-300 backdrop-blur-xl font-semibold hover:scale-105 hover:shadow-lg ${\n            darkMode ? 'bg-slate-700/40 hover:bg-slate-600/60 border-slate-600' : 'bg-white/40 hover:bg-white/60 border-white/50'\n          }`}\n        >\n          <Download size={20} />\n          <span>Export CSV</span>\n        </button>\n        <button\n          onClick={() => handleDownload('pdf')}\n          className=\"group/btn flex items-center gap-3 px-8 py-4 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white rounded-2xl transition-all duration-300 font-semibold hover:scale-105 hover:shadow-lg\"\n        >\n          <Download size={20} />\n          <span>Export PDF</span>\n        </button>\n      </div>\n      )}\n\n      <div className={`flex items-center justify-center gap-8 pt-12 pb-8 border-t ${darkMode ? 'border-slate-700' : 'border-white/20'}`}>\n        <button\n          onClick={handlePrevPage}\n          disabled={currentPage === 0}\n          className={`flex items-center gap-2 px-6 py-3 rounded-xl font-semibold transition-all duration-300 ${\n            currentPage === 0\n              ? darkMode ? 'bg-slate-700/20 text-gray-500 cursor-not-allowed opacity-50' : 'bg-white/20 text-gray-400 cursor-not-allowed opacity-50'\n              : 'bg-gradient-to-r from-blue-500 to-cyan-500 text-white hover:from-blue-600 hover:to-cyan-600 hover:scale-105 hover:shadow-lg'\n          }`}\n        >\n          <ChevronLeft size={20} />\n          <span>Previous</span>\n        </button>\n\n        <div className=\"flex items-center gap-3\">\n          {Array.from({ length: totalPages }).map((_, idx) => (\n            <button\n              key={idx}\n              onClick={() => {\n                setCurrentPage(idx);\n                window.scrollTo({ top: 0, behavior: 'smooth' });\n              }}\n              className={`w-3 h-3 rounded-full transition-all duration-300 ${\n                currentPage === idx\n                  ? 'bg-gradient-to-r from-blue-600 to-purple-600 w-8'\n                  : darkMode ? 'bg-slate-600 hover:bg-slate-500' : 'bg-white/40 hover:bg-white/60'\n              }`}\n              title={`Go to page ${idx + 1}`}\n            />\n          ))}\n        </div>\n\n        <button\n          onClick={handleNextPage}\n          disabled={currentPage === totalPages - 1}\n          className={`flex items-center gap-2 px-6 py-3 rounded-xl font-semibold transition-all duration-300 ${\n            currentPage === totalPages - 1\n              ? darkMode ? 'bg-slate-700/20 text-gray-500 cursor-not-allowed opacity-50' : 'bg-white/20 text-gray-400 cursor-not-allowed opacity-50'\n              : 'bg-gradient-to-r from-purple-600 to-pink-600 text-white hover:from-purple-700 hover:to-pink-700 hover:scale-105 hover:shadow-lg'\n          }`}\n        >\n          <span>Next</span>\n          <ChevronRight size={20} />\n        </button>\n      </div>\n\n      <ChatBot jobId={jobId} darkMode={darkMode} />\n    </div>\n  );\n}\n\nexport default Dashboard;\n","path":null,"size_bytes":40853,"size_tokens":null},"AISalesForecasterzip/AISalesForecaster/frontend/postcss.config.js":{"content":"export default {\n  plugins: {\n    '@tailwindcss/postcss': {},\n  },\n}\n","path":null,"size_bytes":69,"size_tokens":null},"AISalesForecasterzip/AISalesForecaster/frontend/eslint.config.js":{"content":"import js from '@eslint/js'\nimport globals from 'globals'\nimport reactHooks from 'eslint-plugin-react-hooks'\nimport reactRefresh from 'eslint-plugin-react-refresh'\nimport { defineConfig, globalIgnores } from 'eslint/config'\n\nexport default defineConfig([\n  globalIgnores(['dist']),\n  {\n    files: ['**/*.{js,jsx}'],\n    extends: [\n      js.configs.recommended,\n      reactHooks.configs.flat.recommended,\n      reactRefresh.configs.vite,\n    ],\n    languageOptions: {\n      ecmaVersion: 2020,\n      globals: globals.browser,\n      parserOptions: {\n        ecmaVersion: 'latest',\n        ecmaFeatures: { jsx: true },\n        sourceType: 'module',\n      },\n    },\n    rules: {\n      'no-unused-vars': ['error', { varsIgnorePattern: '^[A-Z_]' }],\n    },\n  },\n])\n","path":null,"size_bytes":758,"size_tokens":null},"AISalesForecasterzip/AISalesForecaster/backend/app/models/database.py":{"content":"import sqlite3\nimport json\nimport os\nfrom datetime import datetime\nfrom typing import Optional, Dict, Any, List\nfrom contextlib import contextmanager\n\nDATABASE_PATH = os.environ.get(\"DATABASE_PATH\", \"backend/data/forecaster.db\")\n\n\ndef init_database():\n    os.makedirs(os.path.dirname(DATABASE_PATH), exist_ok=True)\n    \n    with get_connection() as conn:\n        cursor = conn.cursor()\n        \n        cursor.execute(\"\"\"\n            CREATE TABLE IF NOT EXISTS jobs (\n                job_id TEXT PRIMARY KEY,\n                created_at TEXT NOT NULL,\n                updated_at TEXT NOT NULL,\n                status TEXT DEFAULT 'pending',\n                file_path TEXT,\n                original_filename TEXT,\n                row_count INTEGER,\n                column_count INTEGER,\n                columns TEXT,\n                date_range TEXT,\n                validation_result TEXT\n            )\n        \"\"\")\n        \n        cursor.execute(\"\"\"\n            CREATE TABLE IF NOT EXISTS forecasts (\n                id INTEGER PRIMARY KEY AUTOINCREMENT,\n                job_id TEXT NOT NULL,\n                created_at TEXT NOT NULL,\n                model_type TEXT,\n                aggregation TEXT,\n                horizon INTEGER,\n                target_column TEXT,\n                group_by TEXT,\n                metrics TEXT,\n                forecast_data TEXT,\n                historical_data TEXT,\n                decomposition_data TEXT,\n                feature_importance TEXT,\n                top_products TEXT,\n                top_regions TEXT,\n                FOREIGN KEY (job_id) REFERENCES jobs(job_id)\n            )\n        \"\"\")\n        \n        cursor.execute(\"\"\"\n            CREATE TABLE IF NOT EXISTS insights (\n                id INTEGER PRIMARY KEY AUTOINCREMENT,\n                job_id TEXT NOT NULL,\n                created_at TEXT NOT NULL,\n                title TEXT,\n                summary TEXT,\n                kpis TEXT,\n                bullets TEXT,\n                recommendations TEXT,\n                FOREIGN KEY (job_id) REFERENCES jobs(job_id)\n            )\n        \"\"\")\n        \n        conn.commit()\n\n\n@contextmanager\ndef get_connection():\n    conn = sqlite3.connect(DATABASE_PATH)\n    conn.row_factory = sqlite3.Row\n    try:\n        yield conn\n    finally:\n        conn.close()\n\n\ndef create_job(job_id: str, file_path: str, original_filename: str, \n               row_count: int, column_count: int, columns: List[str],\n               date_range: Dict, validation_result: Dict) -> None:\n    now = datetime.utcnow().isoformat()\n    \n    with get_connection() as conn:\n        cursor = conn.cursor()\n        cursor.execute(\"\"\"\n            INSERT INTO jobs (job_id, created_at, updated_at, status, file_path,\n                            original_filename, row_count, column_count, columns,\n                            date_range, validation_result)\n            VALUES (?, ?, ?, 'uploaded', ?, ?, ?, ?, ?, ?, ?)\n        \"\"\", (\n            job_id, now, now, file_path, original_filename,\n            row_count, column_count, json.dumps(columns),\n            json.dumps(date_range), json.dumps(validation_result)\n        ))\n        conn.commit()\n\n\ndef get_job(job_id: str) -> Optional[Dict[str, Any]]:\n    with get_connection() as conn:\n        cursor = conn.cursor()\n        cursor.execute(\"SELECT * FROM jobs WHERE job_id = ?\", (job_id,))\n        row = cursor.fetchone()\n        \n        if row:\n            job = dict(row)\n            job['columns'] = json.loads(job['columns']) if job['columns'] else []\n            job['date_range'] = json.loads(job['date_range']) if job['date_range'] else {}\n            job['validation_result'] = json.loads(job['validation_result']) if job['validation_result'] else {}\n            return job\n        return None\n\n\ndef update_job_status(job_id: str, status: str) -> None:\n    now = datetime.utcnow().isoformat()\n    \n    with get_connection() as conn:\n        cursor = conn.cursor()\n        cursor.execute(\"\"\"\n            UPDATE jobs SET status = ?, updated_at = ? WHERE job_id = ?\n        \"\"\", (status, now, job_id))\n        conn.commit()\n\n\ndef save_forecast(job_id: str, model_type: str, aggregation: str, \n                  horizon: int, target_column: str, group_by: Optional[str],\n                  metrics: Dict, forecast_data: List, historical_data: List,\n                  decomposition_data: Optional[Dict], feature_importance: Optional[List],\n                  top_products: Optional[List], top_regions: Optional[List]) -> int:\n    now = datetime.utcnow().isoformat()\n    \n    with get_connection() as conn:\n        cursor = conn.cursor()\n        cursor.execute(\"\"\"\n            INSERT INTO forecasts (job_id, created_at, model_type, aggregation,\n                                  horizon, target_column, group_by, metrics,\n                                  forecast_data, historical_data, decomposition_data,\n                                  feature_importance, top_products, top_regions)\n            VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\n        \"\"\", (\n            job_id, now, model_type, aggregation, horizon, target_column, group_by,\n            json.dumps(metrics), json.dumps(forecast_data), json.dumps(historical_data),\n            json.dumps(decomposition_data) if decomposition_data else None,\n            json.dumps(feature_importance) if feature_importance else None,\n            json.dumps(top_products) if top_products else None,\n            json.dumps(top_regions) if top_regions else None\n        ))\n        conn.commit()\n        return cursor.lastrowid\n\n\ndef get_latest_forecast(job_id: str) -> Optional[Dict[str, Any]]:\n    with get_connection() as conn:\n        cursor = conn.cursor()\n        cursor.execute(\"\"\"\n            SELECT * FROM forecasts WHERE job_id = ? ORDER BY created_at DESC LIMIT 1\n        \"\"\", (job_id,))\n        row = cursor.fetchone()\n        \n        if row:\n            forecast = dict(row)\n            forecast['metrics'] = json.loads(forecast['metrics']) if forecast['metrics'] else {}\n            forecast['forecast_data'] = json.loads(forecast['forecast_data']) if forecast['forecast_data'] else []\n            forecast['historical_data'] = json.loads(forecast['historical_data']) if forecast['historical_data'] else []\n            forecast['decomposition_data'] = json.loads(forecast['decomposition_data']) if forecast['decomposition_data'] else None\n            forecast['feature_importance'] = json.loads(forecast['feature_importance']) if forecast['feature_importance'] else None\n            forecast['top_products'] = json.loads(forecast['top_products']) if forecast['top_products'] else None\n            forecast['top_regions'] = json.loads(forecast['top_regions']) if forecast['top_regions'] else None\n            return forecast\n        return None\n\n\ndef save_insights(job_id: str, title: str, summary: str,\n                  kpis: List, bullets: List, recommendations: List) -> int:\n    now = datetime.utcnow().isoformat()\n    \n    with get_connection() as conn:\n        cursor = conn.cursor()\n        cursor.execute(\"\"\"\n            INSERT INTO insights (job_id, created_at, title, summary, kpis, bullets, recommendations)\n            VALUES (?, ?, ?, ?, ?, ?, ?)\n        \"\"\", (\n            job_id, now, title, summary,\n            json.dumps(kpis), json.dumps(bullets), json.dumps(recommendations)\n        ))\n        conn.commit()\n        return cursor.lastrowid\n\n\ndef get_latest_insights(job_id: str) -> Optional[Dict[str, Any]]:\n    with get_connection() as conn:\n        cursor = conn.cursor()\n        cursor.execute(\"\"\"\n            SELECT * FROM insights WHERE job_id = ? ORDER BY created_at DESC LIMIT 1\n        \"\"\", (job_id,))\n        row = cursor.fetchone()\n        \n        if row:\n            insights = dict(row)\n            insights['kpis'] = json.loads(insights['kpis']) if insights['kpis'] else []\n            insights['bullets'] = json.loads(insights['bullets']) if insights['bullets'] else []\n            insights['recommendations'] = json.loads(insights['recommendations']) if insights['recommendations'] else []\n            return insights\n        return None\n\n\ndef get_recent_jobs(limit: int = 10) -> List[Dict[str, Any]]:\n    with get_connection() as conn:\n        cursor = conn.cursor()\n        cursor.execute(\"\"\"\n            SELECT j.job_id, j.created_at, j.original_filename, j.row_count, \n                   j.column_count, j.status,\n                   f.model_type, f.aggregation, f.horizon, f.target_column,\n                   f.created_at as forecast_created_at\n            FROM jobs j\n            LEFT JOIN (\n                SELECT job_id, model_type, aggregation, horizon, target_column, created_at,\n                       ROW_NUMBER() OVER (PARTITION BY job_id ORDER BY created_at DESC) as rn\n                FROM forecasts\n            ) f ON j.job_id = f.job_id AND f.rn = 1\n            ORDER BY j.created_at DESC\n            LIMIT ?\n        \"\"\", (limit,))\n        \n        rows = cursor.fetchall()\n        result = []\n        \n        for row in rows:\n            job = dict(row)\n            job['has_forecast'] = job.get('model_type') is not None\n            result.append(job)\n        \n        return result\n\n\ndef get_job_with_forecast(job_id: str) -> Optional[Dict[str, Any]]:\n    job = get_job(job_id)\n    if not job:\n        return None\n    \n    forecast = get_latest_forecast(job_id)\n    insights = get_latest_insights(job_id)\n    \n    return {\n        'job': job,\n        'forecast': forecast,\n        'insights': insights\n    }\n","path":null,"size_bytes":9515,"size_tokens":null},"AISalesForecasterzip/AISalesForecaster/backend/app/routes/__init__.py":{"content":"from .upload import router as upload_router\nfrom .forecast import router as forecast_router\nfrom .insights import router as insights_router\nfrom .download import router as download_router\nfrom .delete import router as delete_router\nfrom .recommendations import router as recommendations_router\nfrom .chat import router as chat_router\n","path":null,"size_bytes":334,"size_tokens":null},"AISalesForecasterzip/AISalesForecaster/backend/app/services/anomaly_detector.py":{"content":"import pandas as pd\nimport numpy as np\nfrom typing import List, Dict, Any, Optional\nfrom datetime import datetime\nimport logging\n\nlogger = logging.getLogger(__name__)\n\n\nclass AnomalyDetector:\n    \"\"\"Detects anomalies in time series data using IQR and Z-score methods\"\"\"\n    \n    @staticmethod\n    def detect_anomalies(df: pd.DataFrame, value_column: str = 'actual', \n                        method: str = 'iqr', threshold: float = 1.5) -> List[Dict[str, Any]]:\n        \"\"\"\n        Detect anomalies in time series data\n        \n        Args:\n            df: DataFrame with time series data\n            value_column: Column name containing values to analyze\n            method: 'iqr' or 'zscore'\n            threshold: Sensitivity threshold (higher = fewer anomalies)\n        \n        Returns:\n            List of anomaly dictionaries with date, value, anomaly_type, severity\n        \"\"\"\n        anomalies = []\n        \n        if value_column not in df.columns or len(df) < 3:\n            return anomalies\n        \n        values = df[value_column].dropna().values\n        \n        if method == 'iqr':\n            Q1 = np.percentile(values, 25)\n            Q3 = np.percentile(values, 75)\n            IQR = Q3 - Q1\n            \n            lower_bound = Q1 - (threshold * IQR)\n            upper_bound = Q3 + (threshold * IQR)\n            \n            for idx, row in df.iterrows():\n                value = row[value_column]\n                if pd.isna(value):\n                    continue\n                \n                if value < lower_bound or value > upper_bound:\n                    # Calculate percentage change from mean\n                    mean_val = np.mean(values)\n                    pct_change = ((value - mean_val) / mean_val * 100) if mean_val != 0 else 0\n                    \n                    anomaly_type = \"spike\" if value > upper_bound else \"dip\"\n                    severity = abs(pct_change)\n                    \n                    anomalies.append({\n                        'date': row['date'].strftime('%Y-%m-%d') if hasattr(row['date'], 'strftime') else str(row['date']),\n                        'value': float(value),\n                        'anomaly_type': anomaly_type,\n                        'severity': round(severity, 1),\n                        'description': f\"AI detected {anomaly_type} on {row['date'].strftime('%Y-%m-%d')}: {abs(pct_change):.1f}% {'increase' if value > mean_val else 'decrease'}\"\n                    })\n        \n        elif method == 'zscore':\n            mean = np.mean(values)\n            std = np.std(values)\n            \n            if std == 0:\n                return anomalies\n            \n            for idx, row in df.iterrows():\n                value = row[value_column]\n                if pd.isna(value):\n                    continue\n                \n                z_score = abs((value - mean) / std)\n                \n                if z_score > threshold:\n                    pct_change = ((value - mean) / mean * 100) if mean != 0 else 0\n                    anomaly_type = \"spike\" if value > mean else \"dip\"\n                    \n                    anomalies.append({\n                        'date': row['date'].strftime('%Y-%m-%d') if hasattr(row['date'], 'strftime') else str(row['date']),\n                        'value': float(value),\n                        'anomaly_type': anomaly_type,\n                        'severity': round(abs(pct_change), 1),\n                        'z_score': round(z_score, 2),\n                        'description': f\"AI detected {anomaly_type} on {row['date'].strftime('%Y-%m-%d')}: {abs(pct_change):.1f}% change\"\n                    })\n        \n        return sorted(anomalies, key=lambda x: x['severity'], reverse=True)[:10]  # Top 10 anomalies\n\n\nclass RecommendationEngine:\n    \"\"\"Generates revenue and business recommendations based on forecast data\"\"\"\n    \n    @staticmethod\n    def generate_recommendations(forecast_data: List[Dict], historical_data: List[Dict],\n                                feature_importance: List[Dict] = None) -> List[Dict[str, Any]]:\n        \"\"\"\n        Generate actionable business recommendations\n        \n        Args:\n            forecast_data: List of forecast points with predictions\n            historical_data: List of historical data points\n            feature_importance: List of important features\n        \n        Returns:\n            List of recommendation dictionaries\n        \"\"\"\n        recommendations = []\n        \n        if not forecast_data or not historical_data:\n            return recommendations\n        \n        # Calculate growth trend\n        avg_historical = np.mean([h.get('actual', 0) for h in historical_data[-12:] if h.get('actual')])\n        avg_forecast = np.mean([f.get('predicted', 0) for f in forecast_data[:6]])\n        growth_rate = ((avg_forecast - avg_historical) / avg_historical * 100) if avg_historical > 0 else 0\n        \n        # Recommendation 1: Growth-based pricing\n        if growth_rate > 15:\n            price_increase = min(growth_rate / 10, 8)  # Cap at 8%\n            recommendations.append({\n                'id': 'price_optimize',\n                'title': 'Optimize Pricing',\n                'description': f'Strong growth detected (+{growth_rate:.1f}%). Consider raising prices by {price_increase:.1f}% for maximum revenue.',\n                'impact': 'high',\n                'action': f'Increase prices by {price_increase:.1f}%',\n                'expected_uplift': f'+{price_increase * 0.7:.1f}% revenue'\n            })\n        elif growth_rate < -10:\n            discount = min(abs(growth_rate) / 5, 15)\n            recommendations.append({\n                'id': 'promotional_discount',\n                'title': 'Launch Promotion',\n                'description': f'Declining trend detected ({growth_rate:.1f}%). Offer {discount:.1f}% discount to boost volume.',\n                'impact': 'high',\n                'action': f'Apply {discount:.1f}% promotional discount',\n                'expected_uplift': f'+{discount * 1.5:.1f}% volume'\n            })\n        \n        # Recommendation 2: Based on volatility\n        forecast_values = [f.get('predicted', 0) for f in forecast_data]\n        if forecast_values:\n            volatility = np.std(forecast_values) / (np.mean(forecast_values) or 1) * 100\n            if volatility > 30:\n                recommendations.append({\n                    'id': 'inventory_buffer',\n                    'title': 'Increase Safety Stock',\n                    'description': f'High volatility detected ({volatility:.1f}%). Recommend {int(volatility / 5)} weeks of buffer inventory.',\n                    'impact': 'medium',\n                    'action': 'Increase safety stock',\n                    'expected_uplift': 'Reduce stockout risk by ~40%'\n                })\n        \n        # Recommendation 3: Seasonal opportunity\n        if len(historical_data) > 30:\n            max_month = max([h.get('actual', 0) for h in historical_data[-12:]])\n            min_month = min([h.get('actual', 0) for h in historical_data[-12:]])\n            seasonality = ((max_month - min_month) / min_month * 100) if min_month > 0 else 0\n            \n            if seasonality > 30:\n                recommendations.append({\n                    'id': 'seasonal_campaign',\n                    'title': 'Launch Seasonal Campaign',\n                    'description': f'Seasonal pattern detected ({seasonality:.1f}% variation). Target peak season with premium products.',\n                    'impact': 'medium',\n                    'action': 'Focus marketing on peak season',\n                    'expected_uplift': f'+{min(seasonality * 0.3, 25):.1f}% peak period revenue'\n                })\n        \n        # Recommendation 4: Feature-driven opportunity\n        if feature_importance and len(feature_importance) > 0:\n            top_feature = feature_importance[0]\n            if top_feature.get('importance', 0) > 0.2:\n                feature_name = top_feature.get('feature', 'Top Driver')\n                recommendations.append({\n                    'id': 'feature_focus',\n                    'title': f'Focus on {feature_name}',\n                    'description': f'{feature_name} is the strongest predictor ({top_feature.get(\"importance\", 0):.1%} importance). Optimize this lever.',\n                    'impact': 'medium',\n                    'action': f'Optimize {feature_name} strategy',\n                    'expected_uplift': f'+{min(top_feature.get(\"importance\", 0) * 100, 20):.1f}% accuracy improvement'\n                })\n        \n        return recommendations[:4]  # Return top 4 recommendations\n\n\nclass ScenarioSimulator:\n    \"\"\"Simulates forecast scenarios with parameter changes\"\"\"\n    \n    @staticmethod\n    def simulate_scenario(forecast_data: List[Dict], scenario_params: Dict[str, float]) -> Dict[str, Any]:\n        \"\"\"\n        Simulate forecast with parameter changes\n        \n        Args:\n            forecast_data: Original forecast data\n            scenario_params: Dict with 'price_change' and/or 'volume_change' as percentages\n        \n        Returns:\n            Scenario result with new forecast and impact analysis\n        \"\"\"\n        price_change = scenario_params.get('price_change', 0) / 100\n        volume_change = scenario_params.get('volume_change', 0) / 100\n        \n        original_revenue = sum(f.get('predicted', 0) for f in forecast_data)\n        \n        # Simulate elasticity: for every 1% price change, volume changes by -0.5% (typical elasticity)\n        actual_volume_change = volume_change - (price_change * 0.5)\n        \n        new_forecast = []\n        for point in forecast_data:\n            new_predicted = point.get('predicted', 0) * (1 + actual_volume_change) * (1 + price_change)\n            new_forecast.append({\n                **point,\n                'predicted_scenario': new_predicted\n            })\n        \n        new_revenue = sum(f.get('predicted_scenario', 0) for f in new_forecast)\n        revenue_change = new_revenue - original_revenue\n        revenue_change_pct = (revenue_change / original_revenue * 100) if original_revenue > 0 else 0\n        \n        return {\n            'scenario_name': f\"Price +{price_change*100:.1f}%, Volume +{volume_change*100:.1f}%\",\n            'forecast': new_forecast,\n            'original_revenue': round(original_revenue, 2),\n            'new_revenue': round(new_revenue, 2),\n            'revenue_change': round(revenue_change, 2),\n            'revenue_change_pct': round(revenue_change_pct, 2),\n            'risk_level': 'high' if abs(revenue_change_pct) > 50 else 'medium' if abs(revenue_change_pct) > 20 else 'low'\n        }\n","path":null,"size_bytes":10644,"size_tokens":null},"AISalesForecasterzip/AISalesForecaster/pyproject.toml":{"content":"[project]\nname = \"repl-nix-workspace\"\nversion = \"0.1.0\"\ndescription = \"Add your description here\"\nrequires-python = \">=3.11\"\ndependencies = [\n    \"aiofiles>=25.1.0\",\n    \"fastapi>=0.122.0\",\n    \"lightgbm>=4.6.0\",\n    \"numpy>=2.3.5\",\n    \"openai>=1.3.0\",\n    \"pandas>=2.3.3\",\n    \"prophet>=1.2.1\",\n    \"pydantic>=2.12.5\",\n    \"pytest>=9.0.1\",\n    \"python-multipart>=0.0.20\",\n    \"reportlab>=4.4.5\",\n    \"scikit-learn>=1.7.2\",\n    \"uvicorn>=0.38.0\",\n]\n","path":null,"size_bytes":450,"size_tokens":null},"AISalesForecasterzip/AISalesForecaster/frontend/src/App.jsx":{"content":"import { useState, useEffect } from 'react';\nimport Header from './components/Header';\nimport FileUpload from './components/FileUpload';\nimport DataPreview from './components/DataPreview';\nimport ForecastConfig from './components/ForecastConfig';\nimport Dashboard from './components/Dashboard';\nimport InsightsCard from './components/InsightsCard';\nimport LoadingOverlay from './components/LoadingOverlay';\nimport RecentSessions from './components/RecentSessions';\nimport Stepper from './components/Stepper';\nimport { getJobFullData } from './services/api';\n\nfunction App() {\n  const [step, setStep] = useState('upload');\n  const [uploadData, setUploadData] = useState(null);\n  const [forecastData, setForecastData] = useState(null);\n  const [insightsData, setInsightsData] = useState(null);\n  const [loading, setLoading] = useState(false);\n  const [loadingMessage, setLoadingMessage] = useState('');\n  const [error, setError] = useState(null);\n  const [refreshCounter, setRefreshCounter] = useState(0);\n  const [darkMode, setDarkMode] = useState(() => {\n    const saved = localStorage.getItem('darkMode');\n    return saved ? JSON.parse(saved) : false;\n  });\n\n  useEffect(() => {\n    localStorage.setItem('darkMode', JSON.stringify(darkMode));\n    if (darkMode) {\n      document.documentElement.classList.add('dark');\n    } else {\n      document.documentElement.classList.remove('dark');\n    }\n  }, [darkMode]);\n\n  const handleUploadSuccess = (data) => {\n    setUploadData(data);\n    setError(null);\n    setStep('preview');\n  };\n\n  const handleConfigComplete = (forecast, insights) => {\n    setForecastData(forecast);\n    setInsightsData(insights);\n    setStep('dashboard');\n  };\n\n  const handleReset = () => {\n    setStep('upload');\n    setUploadData(null);\n    setForecastData(null);\n    setInsightsData(null);\n    setError(null);\n  };\n\n  const handleRefreshData = () => {\n    if (uploadData) {\n      setStep('upload');\n      setUploadData(null);\n      setForecastData(null);\n      setInsightsData(null);\n    }\n  };\n\n  const handleStepClick = (stepId) => {\n    if (stepId === 'upload') {\n      setStep('upload');\n    } else if (stepId === 'preview' && uploadData) {\n      setStep('preview');\n    } else if (stepId === 'config' && uploadData) {\n      setStep('config');\n    } else if (stepId === 'dashboard' && forecastData) {\n      setStep('dashboard');\n    }\n  };\n\n  const handleLoadSession = async (jobId) => {\n    try {\n      setLoading(true);\n      setLoadingMessage('Loading previous session...');\n      setError(null);\n      \n      const data = await getJobFullData(jobId);\n      \n      if (data.forecast) {\n        setUploadData({ job_id: jobId, ...data.job });\n        \n        const parseIfString = (value, fallback) => {\n          if (typeof value === 'string') {\n            try {\n              return JSON.parse(value);\n            } catch {\n              return fallback;\n            }\n          }\n          return value ?? fallback;\n        };\n        \n        const forecastResult = {\n          model_type: data.forecast.model_type,\n          aggregation: data.forecast.aggregation,\n          horizon: data.forecast.horizon,\n          target_column: data.forecast.target_column,\n          metrics: parseIfString(data.forecast.metrics, {}),\n          forecast: parseIfString(data.forecast.forecast_data, []),\n          historical: parseIfString(data.forecast.historical_data, []),\n          decomposition: parseIfString(data.forecast.decomposition_data, null),\n          feature_importance: parseIfString(data.forecast.feature_importance, null),\n          top_products: parseIfString(data.forecast.top_products, null),\n          top_regions: parseIfString(data.forecast.top_regions, null)\n        };\n        \n        setForecastData(forecastResult);\n        \n        if (data.insights) {\n          setInsightsData({\n            title: data.insights.title,\n            summary: data.insights.summary,\n            kpis: parseIfString(data.insights.kpis, []),\n            bullets: parseIfString(data.insights.bullets, []),\n            recommendations: parseIfString(data.insights.recommendations, [])\n          });\n        }\n        \n        setStep('dashboard');\n      } else {\n        setUploadData({ job_id: jobId, ...data.job });\n        setStep('preview');\n      }\n    } catch (err) {\n      console.error('Error loading session:', err);\n      setError('Unable to load the selected session. Please try again.');\n    } finally {\n      setLoading(false);\n      setLoadingMessage('');\n    }\n  };\n\n  return (\n    <div className={`min-h-screen transition-colors duration-300 ${darkMode ? 'bg-slate-900' : 'bg-slate-50'}`}>\n      <Header \n        currentStep={step} \n        darkMode={darkMode} \n        onToggleDarkMode={() => setDarkMode(!darkMode)} \n      />\n      <Stepper \n        currentStep={step} \n        onStepClick={handleStepClick}\n        hasUploadData={!!uploadData}\n        hasForecastData={!!forecastData}\n        onReset={handleReset}\n        darkMode={darkMode}\n      />\n      \n      {loading && <LoadingOverlay message={loadingMessage} />}\n      \n      {error && (\n        <div className=\"max-w-4xl mx-auto px-4 py-4\">\n          <div className=\"bg-red-50 border border-red-200 rounded-lg p-4 text-red-700\">\n            {error}\n          </div>\n        </div>\n      )}\n      \n      <main className=\"ml-64 max-w-7xl mx-auto px-4 py-8\">\n        {step === 'upload' && (\n          <div className=\"space-y-8\">\n            <FileUpload \n              onUploadSuccess={handleUploadSuccess}\n              setLoading={setLoading}\n              setLoadingMessage={setLoadingMessage}\n              setError={setError}\n              darkMode={darkMode}\n              refreshCounter={refreshCounter}\n            />\n            <RecentSessions onLoadSession={handleLoadSession} darkMode={darkMode} />\n          </div>\n        )}\n        \n        {step === 'preview' && uploadData && (\n          <div className=\"space-y-6\">\n            <DataPreview \n              data={uploadData} \n              onRefresh={handleRefreshData}\n              darkMode={darkMode}\n            />\n            <div className=\"flex justify-center\">\n              <button\n                onClick={() => setStep('config')}\n                className=\"px-8 py-3 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition-colors\"\n              >\n                Continue to Forecast Configuration\n              </button>\n            </div>\n          </div>\n        )}\n        \n        {step === 'config' && uploadData && (\n          <ForecastConfig\n            uploadData={uploadData}\n            onComplete={handleConfigComplete}\n            setLoading={setLoading}\n            setLoadingMessage={setLoadingMessage}\n            setError={setError}\n            onBack={() => setStep('preview')}\n            darkMode={darkMode}\n          />\n        )}\n        \n        {step === 'dashboard' && forecastData && (\n          <Dashboard \n            forecastData={forecastData} \n            jobId={uploadData?.job_id}\n            insightsData={insightsData}\n            uploadData={uploadData}\n            darkMode={darkMode}\n          />\n        )}\n      </main>\n    </div>\n  );\n}\n\nexport default App;\n","path":null,"size_bytes":7201,"size_tokens":null},"AISalesForecasterzip/AISalesForecaster/frontend/src/components/ForecastConfig.jsx":{"content":"import { useState } from 'react';\nimport { Settings, Zap, ArrowLeft, RotateCcw } from 'lucide-react';\nimport { runForecast, getInsights } from '../services/api';\nimport Tooltip from './Tooltip';\n\nfunction ForecastConfig({ uploadData, onComplete, setLoading, setLoadingMessage, setError, onBack, darkMode }) {\n  const defaultConfig = {\n    aggregation: 'monthly',\n    model: 'prophet',\n    horizon: 6,\n    target_column: 'revenue',\n  };\n\n  const [config, setConfig] = useState(defaultConfig);\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    setLoading(true);\n    setLoadingMessage('Running forecast model... This may take a minute.');\n    setError(null);\n\n    try {\n      const forecastResult = await runForecast({\n        job_id: uploadData.job_id,\n        ...config,\n      });\n\n      setLoadingMessage('Generating business insights...');\n      \n      let insightsResult = null;\n      try {\n        insightsResult = await getInsights(uploadData.job_id);\n      } catch (err) {\n        console.warn('Could not generate insights:', err);\n      }\n\n      setLoading(false);\n      onComplete(forecastResult, insightsResult);\n    } catch (err) {\n      setLoading(false);\n      setError(err.response?.data?.detail || 'Failed to run forecast. Please try again.');\n    }\n  };\n\n  const handleReset = () => {\n    setConfig(defaultConfig);\n    setError(null);\n  };\n\n  return (\n    <div className=\"max-w-2xl mx-auto\">\n      <div className=\"text-center mb-8\">\n        <h2 className={`text-2xl font-bold mb-2 ${darkMode ? 'text-white' : 'text-gray-800'}`}>\n          Configure Your Forecast\n        </h2>\n        <p className={darkMode ? 'text-gray-300' : 'text-gray-600'}>\n          Choose your forecasting parameters to generate predictions\n        </p>\n      </div>\n\n      <form onSubmit={handleSubmit} className={`rounded-xl shadow-sm border p-6 space-y-6 ${\n        darkMode ? 'bg-slate-800 border-slate-700' : 'bg-white border-gray-100'\n      }`}>\n        <div className={`flex items-center justify-between pb-4 border-b ${\n          darkMode ? 'border-slate-700' : 'border-gray-100'\n        }`}>\n          <div className=\"flex items-center gap-3\">\n            <div className=\"p-2 bg-blue-100 rounded-lg\">\n              <Settings size={24} className=\"text-blue-600\" />\n            </div>\n            <div>\n              <h3 className={`font-semibold ${darkMode ? 'text-white' : 'text-gray-800'}`}>Forecast Settings</h3>\n              <p className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>Job ID: {uploadData.job_id}</p>\n            </div>\n          </div>\n          <button\n            type=\"button\"\n            onClick={handleReset}\n            className={`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-all duration-300 hover:scale-105 ${\n              darkMode \n                ? 'bg-slate-700 hover:bg-slate-600 text-white border border-slate-600' \n                : 'bg-gray-100 hover:bg-gray-200 text-gray-700 border border-gray-200'\n            }`}\n            title=\"Reset to default settings\"\n          >\n            <RotateCcw size={18} />\n            <span>Reset</span>\n          </button>\n        </div>\n\n        <div className=\"grid md:grid-cols-2 gap-6\">\n          <div>\n            <div className=\"flex items-center gap-2 mb-2\">\n              <label className={`block text-sm font-medium ${darkMode ? 'text-gray-200' : 'text-gray-700'}`}>\n                Target Column\n              </label>\n              <Tooltip \n                content=\"The numeric column you want to predict. Usually revenue or units sold.\"\n                position=\"top\"\n              />\n            </div>\n            <select\n              value={config.target_column}\n              onChange={(e) => setConfig({ ...config, target_column: e.target.value })}\n              className={`w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ${\n                darkMode \n                  ? 'bg-slate-900 border-slate-600 text-white' \n                  : 'border-gray-300 bg-white'\n              }`}\n            >\n              {uploadData.numeric_columns.map((col) => (\n                <option key={col} value={col}>{col}</option>\n              ))}\n            </select>\n            <p className={`text-xs mt-1 ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>The value you want to forecast</p>\n          </div>\n\n          <div>\n            <div className=\"flex items-center gap-2 mb-2\">\n              <label className={`block text-sm font-medium ${darkMode ? 'text-gray-200' : 'text-gray-700'}`}>\n                Aggregation Level\n              </label>\n              <Tooltip \n                content=\"How to group your data over time. Monthly is recommended for most business forecasts.\"\n                position=\"top\"\n              />\n            </div>\n            <select\n              value={config.aggregation}\n              onChange={(e) => setConfig({ ...config, aggregation: e.target.value })}\n              className={`w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ${\n                darkMode \n                  ? 'bg-slate-900 border-slate-600 text-white' \n                  : 'border-gray-300 bg-white'\n              }`}\n            >\n              <option value=\"daily\">Daily</option>\n              <option value=\"weekly\">Weekly</option>\n              <option value=\"monthly\">Monthly</option>\n            </select>\n            <p className={`text-xs mt-1 ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>How to group your data</p>\n          </div>\n\n          <div>\n            <div className=\"flex items-center gap-2 mb-2\">\n              <label className={`block text-sm font-medium ${darkMode ? 'text-gray-200' : 'text-gray-700'}`}>\n                Forecast Model\n              </label>\n              <Tooltip \n                content=\"Prophet is ideal for long-term trends and strong seasonality. LightGBM handles complex patterns and multiple features effectively.\"\n                position=\"top\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <label className={`flex items-center gap-3 p-3 border rounded-lg cursor-pointer transition-colors ${\n                config.model === 'prophet'\n                  ? 'border-blue-500 bg-blue-50'\n                  : darkMode \n                    ? 'border-slate-600 hover:bg-slate-700' \n                    : 'border-gray-200 hover:bg-gray-50'\n              }`}>\n                <input\n                  type=\"radio\"\n                  name=\"model\"\n                  value=\"prophet\"\n                  checked={config.model === 'prophet'}\n                  onChange={(e) => setConfig({ ...config, model: e.target.value })}\n                  className=\"text-blue-600\"\n                />\n                <div>\n                  <span className={`font-medium ${darkMode && config.model !== 'prophet' ? 'text-white' : 'text-gray-800'}`}>Prophet</span>\n                  <p className={`text-xs ${darkMode && config.model !== 'prophet' ? 'text-gray-400' : 'text-gray-500'}`}>Best for strong seasonality and trend</p>\n                </div>\n              </label>\n              <label className={`flex items-center gap-3 p-3 border rounded-lg cursor-pointer transition-colors ${\n                config.model === 'lightgbm'\n                  ? 'border-blue-500 bg-blue-50'\n                  : darkMode \n                    ? 'border-slate-600 hover:bg-slate-700' \n                    : 'border-gray-200 hover:bg-gray-50'\n              }`}>\n                <input\n                  type=\"radio\"\n                  name=\"model\"\n                  value=\"lightgbm\"\n                  checked={config.model === 'lightgbm'}\n                  onChange={(e) => setConfig({ ...config, model: e.target.value })}\n                  className=\"text-blue-600\"\n                />\n                <div>\n                  <span className={`font-medium ${darkMode && config.model !== 'lightgbm' ? 'text-white' : 'text-gray-800'}`}>LightGBM</span>\n                  <p className={`text-xs ${darkMode && config.model !== 'lightgbm' ? 'text-gray-400' : 'text-gray-500'}`}>Best for complex patterns with many features</p>\n                </div>\n              </label>\n            </div>\n          </div>\n\n          <div>\n            <div className=\"flex items-center gap-2 mb-2\">\n              <label className={`block text-sm font-medium ${darkMode ? 'text-gray-200' : 'text-gray-700'}`}>\n                Forecast Horizon\n              </label>\n              <Tooltip \n                content=\"How far into the future to predict. Longer horizons have more uncertainty.\"\n                position=\"top\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              {[3, 6, 12].map((months) => (\n                <label \n                  key={months}\n                  className={`flex items-center gap-3 p-3 border rounded-lg cursor-pointer transition-colors ${\n                    config.horizon === months \n                      ? 'border-blue-500 bg-blue-50' \n                      : darkMode \n                        ? 'border-slate-600 hover:bg-slate-700' \n                        : 'border-gray-200 hover:bg-gray-50'\n                  }`}\n                >\n                  <input\n                    type=\"radio\"\n                    name=\"horizon\"\n                    value={months}\n                    checked={config.horizon === months}\n                    onChange={() => setConfig({ ...config, horizon: months })}\n                    className=\"text-blue-600\"\n                  />\n                  <span className={`font-medium ${darkMode && config.horizon !== months ? 'text-white' : 'text-gray-800'}`}>{months} Months</span>\n                </label>\n              ))}\n            </div>\n          </div>\n        </div>\n\n        <div className={`flex gap-4 pt-4 border-t ${darkMode ? 'border-slate-700' : 'border-gray-100'}`}>\n          <button\n            type=\"button\"\n            onClick={onBack}\n            className={`flex items-center gap-2 px-6 py-3 border rounded-lg font-medium transition-colors ${\n              darkMode \n                ? 'border-slate-600 text-gray-300 hover:bg-slate-700' \n                : 'border-gray-300 text-gray-700 hover:bg-gray-50'\n            }`}\n          >\n            <ArrowLeft size={18} />\n            Back\n          </button>\n          <button\n            type=\"submit\"\n            className=\"flex-1 flex items-center justify-center gap-2 px-6 py-3 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition-colors\"\n          >\n            <Zap size={18} />\n            Run Forecast\n          </button>\n        </div>\n      </form>\n    </div>\n  );\n}\n\nexport default ForecastConfig;\n","path":null,"size_bytes":10771,"size_tokens":null},"AISalesForecasterzip/AISalesForecaster/frontend/src/components/ChatBot.jsx":{"content":"import { useState, useRef, useEffect } from 'react';\nimport { MessageCircle, Send, X, Minimize2, Maximize2 } from 'lucide-react';\nimport { chatWithAI } from '../services/api';\n\nfunction ChatBot({ jobId, darkMode }) {\n  const [isOpen, setIsOpen] = useState(false);\n  const [isMinimized, setIsMinimized] = useState(false);\n  const [messages, setMessages] = useState([]);\n  const [input, setInput] = useState('');\n  const [loading, setLoading] = useState(false);\n  const messagesEndRef = useRef(null);\n\n  const scrollToBottom = () => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n  };\n\n  useEffect(() => {\n    scrollToBottom();\n  }, [messages]);\n\n  const suggestedQuestions = [\n    'Show next 6-month forecast',\n    'Which product declining fastest?',\n    'Explain seasonal trend',\n    'Generate insights for top region'\n  ];\n\n  const handleSendMessage = async (text) => {\n    if (!text.trim()) return;\n\n    const userMessage = { role: 'user', content: text };\n    setMessages(prev => [...prev, userMessage]);\n    setInput('');\n    setLoading(true);\n\n    try {\n      const response = await chatWithAI(jobId, text, messages);\n      const aiMessage = { role: 'assistant', content: response.response };\n      setMessages(prev => [...prev, aiMessage]);\n    } catch (err) {\n      console.error('Chat error:', err);\n      const errorMessage = { role: 'assistant', content: 'Sorry, I encountered an error. Please try again.' };\n      setMessages(prev => [...prev, errorMessage]);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  if (!isOpen) {\n    return (\n      <button\n        onClick={() => setIsOpen(true)}\n        className={`fixed bottom-6 right-6 z-40 p-4 rounded-full shadow-lg hover:scale-110 transition-all ${\n          darkMode\n            ? 'bg-gradient-to-br from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white'\n            : 'bg-gradient-to-br from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 text-white shadow-xl'\n        }`}\n        title=\"Open AI Chat\"\n      >\n        <MessageCircle size={24} />\n      </button>\n    );\n  }\n\n  return (\n    <div\n      className={`fixed bottom-6 right-6 z-40 rounded-2xl shadow-2xl overflow-hidden transition-all duration-300 ${\n        isMinimized\n          ? 'w-80 h-16'\n          : 'w-96 h-[600px]'\n      } ${\n        darkMode\n          ? 'bg-slate-800 border border-slate-700'\n          : 'bg-white border border-gray-200'\n      }`}\n    >\n      {/* Header */}\n      <div className={`p-4 flex items-center justify-between bg-gradient-to-r from-blue-600 to-purple-600 text-white`}>\n        <div className=\"flex items-center gap-2\">\n          <MessageCircle size={20} />\n          <h3 className=\"font-semibold\">Sales Insights AI</h3>\n        </div>\n        <div className=\"flex items-center gap-2\">\n          <button\n            onClick={() => setIsMinimized(!isMinimized)}\n            className=\"hover:bg-white/20 p-1 rounded transition\"\n          >\n            {isMinimized ? <Maximize2 size={18} /> : <Minimize2 size={18} />}\n          </button>\n          <button\n            onClick={() => setIsOpen(false)}\n            className=\"hover:bg-white/20 p-1 rounded transition\"\n          >\n            <X size={18} />\n          </button>\n        </div>\n      </div>\n\n      {!isMinimized && (\n        <>\n          {/* Messages Area */}\n          <div className={`flex-1 overflow-y-auto p-4 space-y-4 ${darkMode ? 'bg-slate-900' : 'bg-gray-50'}`}>\n            {messages.length === 0 ? (\n              <div className={`text-center py-8 ${darkMode ? 'text-gray-400' : 'text-gray-600'}`}>\n                <p className=\"mb-4 font-semibold\">How can I help?</p>\n                <div className=\"space-y-2\">\n                  {suggestedQuestions.map((q, idx) => (\n                    <button\n                      key={idx}\n                      onClick={() => handleSendMessage(q)}\n                      className={`block w-full text-sm p-2 rounded text-left hover:opacity-80 transition ${\n                        darkMode\n                          ? 'bg-slate-700/50 text-gray-300 hover:bg-slate-600'\n                          : 'bg-blue-100 text-blue-700 hover:bg-blue-200'\n                      }`}\n                    >\n                      {q}\n                    </button>\n                  ))}\n                </div>\n              </div>\n            ) : (\n              messages.map((msg, idx) => (\n                <div\n                  key={idx}\n                  className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}\n                >\n                  <div\n                    className={`max-w-xs p-3 rounded-lg ${\n                      msg.role === 'user'\n                        ? darkMode\n                          ? 'bg-blue-600 text-white'\n                          : 'bg-blue-500 text-white'\n                        : darkMode\n                        ? 'bg-slate-700 text-gray-200'\n                        : 'bg-gray-200 text-gray-800'\n                    }`}\n                  >\n                    <p className=\"text-sm\">{msg.content}</p>\n                  </div>\n                </div>\n              ))\n            )}\n            {loading && (\n              <div className=\"flex justify-start\">\n                <div className={`p-3 rounded-lg ${darkMode ? 'bg-slate-700' : 'bg-gray-200'}`}>\n                  <div className=\"flex gap-1\">\n                    <div className=\"w-2 h-2 bg-gray-500 rounded-full animate-bounce\"></div>\n                    <div className=\"w-2 h-2 bg-gray-500 rounded-full animate-bounce delay-100\"></div>\n                    <div className=\"w-2 h-2 bg-gray-500 rounded-full animate-bounce delay-200\"></div>\n                  </div>\n                </div>\n              </div>\n            )}\n            <div ref={messagesEndRef} />\n          </div>\n\n          {/* Input Area */}\n          <div className={`border-t p-3 ${darkMode ? 'border-slate-700 bg-slate-800' : 'border-gray-200 bg-white'}`}>\n            <div className=\"flex gap-2\">\n              <input\n                type=\"text\"\n                value={input}\n                onChange={(e) => setInput(e.target.value)}\n                onKeyPress={(e) => e.key === 'Enter' && handleSendMessage(input)}\n                placeholder=\"Ask about forecast...\"\n                className={`flex-1 px-3 py-2 rounded-lg text-sm border transition ${\n                  darkMode\n                    ? 'bg-slate-700 border-slate-600 text-white placeholder-gray-400 focus:outline-none focus:border-blue-500'\n                    : 'bg-gray-100 border-gray-300 text-gray-900 placeholder-gray-500 focus:outline-none focus:border-blue-500'\n                }`}\n              />\n              <button\n                onClick={() => handleSendMessage(input)}\n                disabled={!input.trim() || loading}\n                className={`p-2 rounded-lg transition ${\n                  input.trim() && !loading\n                    ? darkMode\n                      ? 'bg-blue-600 hover:bg-blue-700 text-white'\n                      : 'bg-blue-500 hover:bg-blue-600 text-white'\n                    : darkMode\n                    ? 'bg-slate-700 text-gray-500 cursor-not-allowed'\n                    : 'bg-gray-300 text-gray-500 cursor-not-allowed'\n                }`}\n              >\n                <Send size={18} />\n              </button>\n            </div>\n          </div>\n        </>\n      )}\n    </div>\n  );\n}\n\nexport default ChatBot;\n","path":null,"size_bytes":7452,"size_tokens":null},"AISalesForecasterzip/AISalesForecaster/backend/app/services/data_pipeline.py":{"content":"import pandas as pd\nimport numpy as np\nfrom typing import Dict, List, Tuple, Optional, Any\nfrom datetime import datetime\nimport logging\n\nfrom ..utils.holidays import get_holiday_flags\nfrom ..models.schemas import ValidationResult, AggregationType\n\nlogger = logging.getLogger(__name__)\n\n\nclass DataPipeline:\n    REQUIRED_COLUMNS = ['date']\n    NUMERIC_COLUMNS = ['units_sold', 'revenue', 'price']\n    OPTIONAL_COLUMNS = ['product_id', 'product_name', 'region', 'promotion_flag']\n    DATE_COLUMN_ALIASES = ['date', 'Date', 'datetime', 'DateTime', 'DATETIME', 'time', 'Time', 'timestamp', 'Timestamp', 'TIMESTAMP']\n    \n    def __init__(self, df: pd.DataFrame):\n        self.raw_df = df.copy()\n        self.processed_df = None\n        self.validation_result = None\n        self._normalize_columns()\n    \n    def _normalize_columns(self) -> None:\n        \"\"\"Auto-detect and normalize date column names\"\"\"\n        for alias in self.DATE_COLUMN_ALIASES:\n            if alias in self.raw_df.columns and alias != 'date':\n                self.raw_df.rename(columns={alias: 'date'}, inplace=True)\n                logger.info(f\"Renamed column '{alias}' to 'date'\")\n                break\n    \n    def validate(self) -> ValidationResult:\n        errors = []\n        warnings = []\n        \n        missing_required = [col for col in self.REQUIRED_COLUMNS if col not in self.raw_df.columns]\n        if missing_required:\n            available_cols = ', '.join(self.raw_df.columns.tolist())\n            errors.append(f\"Missing required 'date' column. Available columns: {available_cols}\")\n        \n        if 'date' in self.raw_df.columns:\n            try:\n                self.raw_df['date'] = pd.to_datetime(self.raw_df['date'], infer_datetime_format=True, errors='coerce')\n                invalid_dates = self.raw_df['date'].isna().sum()\n                if invalid_dates > 0:\n                    warnings.append(f\"{invalid_dates} rows have invalid or missing dates\")\n                if self.raw_df['date'].isna().all():\n                    errors.append(\"All date values are invalid. Please check your date column format.\")\n            except Exception as e:\n                errors.append(f\"Date parsing error: {str(e)}\")\n        \n        numeric_present = [col for col in self.NUMERIC_COLUMNS if col in self.raw_df.columns]\n        if not numeric_present:\n            auto_numeric = self.raw_df.select_dtypes(include=[np.number]).columns.tolist()\n            if auto_numeric:\n                numeric_present = auto_numeric\n                logger.info(f\"Auto-detected numeric columns: {numeric_present}\")\n            else:\n                warnings.append(\"No numeric columns found. You may need to specify a target column for forecasting.\")\n        \n        for col in numeric_present:\n            try:\n                self.raw_df[col] = pd.to_numeric(self.raw_df[col], errors='coerce')\n            except Exception:\n                pass\n        \n        missing_values = {}\n        for col in self.raw_df.columns:\n            null_count = self.raw_df[col].isna().sum()\n            if null_count > 0:\n                missing_values[col] = int(null_count)\n        \n        if missing_values:\n            high_missing = {k: v for k, v in missing_values.items() \n                          if v > len(self.raw_df) * 0.1}\n            if high_missing:\n                warnings.append(f\"High missing values in: {', '.join(high_missing.keys())}\")\n        \n        date_range = None\n        if 'date' in self.raw_df.columns and not self.raw_df['date'].isna().all():\n            try:\n                min_date = self.raw_df['date'].min()\n                max_date = self.raw_df['date'].max()\n                if pd.notna(min_date) and pd.notna(max_date):\n                    date_range = {\n                        'start': pd.Timestamp(min_date).strftime('%Y-%m-%d'),\n                        'end': pd.Timestamp(max_date).strftime('%Y-%m-%d')\n                    }\n            except Exception as e:\n                logger.warning(f\"Could not calculate date range: {str(e)}\")\n        \n        self.validation_result = ValidationResult(\n            is_valid=len(errors) == 0,\n            errors=errors,\n            warnings=warnings,\n            row_count=len(self.raw_df),\n            column_count=len(self.raw_df.columns),\n            date_range=date_range,\n            missing_values=missing_values\n        )\n        \n        return self.validation_result\n    \n    def clean_data(self) -> pd.DataFrame:\n        df = self.raw_df.copy()\n        \n        if 'date' in df.columns:\n            df['date'] = pd.to_datetime(df['date'], errors='coerce')\n            df = df.dropna(subset=['date'])\n        \n        numeric_cols = df.select_dtypes(include=[np.number]).columns.tolist()\n        for col in numeric_cols:\n            median_val = df[col].median()\n            df[col] = df[col].fillna(median_val)\n        \n        categorical_cols = df.select_dtypes(include=['object']).columns.tolist()\n        if 'date' in categorical_cols:\n            categorical_cols.remove('date')\n        for col in categorical_cols:\n            mode_val = df[col].mode()\n            if len(mode_val) > 0:\n                df[col] = df[col].fillna(mode_val[0])\n        \n        self.processed_df = df\n        return df\n    \n    def handle_outliers(self, columns: List[str] = None) -> pd.DataFrame:\n        if self.processed_df is None:\n            self.clean_data()\n        \n        df = self.processed_df.copy()\n        \n        if columns is None:\n            columns = df.select_dtypes(include=[np.number]).columns.tolist()\n        \n        for col in columns:\n            if col in df.columns:\n                Q1 = df[col].quantile(0.25)\n                Q3 = df[col].quantile(0.75)\n                IQR = Q3 - Q1\n                lower_bound = Q1 - 1.5 * IQR\n                upper_bound = Q3 + 1.5 * IQR\n                \n                df[col] = df[col].clip(lower=lower_bound, upper=upper_bound)\n        \n        self.processed_df = df\n        return df\n    \n    def aggregate(self, freq: AggregationType, target_column: str = 'revenue',\n                  group_by: Optional[str] = None) -> pd.DataFrame:\n        if self.processed_df is None:\n            self.clean_data()\n        \n        df = self.processed_df.copy()\n        df = df.sort_values('date')\n        \n        freq_map = {\n            AggregationType.DAILY: 'D',\n            AggregationType.WEEKLY: 'W',\n            AggregationType.MONTHLY: 'M'\n        }\n        pd_freq = freq_map.get(freq, 'M')\n        \n        agg_cols = {target_column: 'sum'}\n        \n        if 'units_sold' in df.columns and target_column != 'units_sold':\n            agg_cols['units_sold'] = 'sum'\n        if 'price' in df.columns:\n            agg_cols['price'] = 'mean'\n        if 'promotion_flag' in df.columns:\n            agg_cols['promotion_flag'] = 'max'\n        \n        if group_by and group_by in df.columns:\n            df['period'] = df['date'].dt.to_period(pd_freq)\n            aggregated = df.groupby(['period', group_by]).agg(agg_cols).reset_index()\n            aggregated['date'] = aggregated['period'].dt.to_timestamp()\n            aggregated = aggregated.drop(columns=['period'])\n        else:\n            df.set_index('date', inplace=True)\n            aggregated = df.resample(pd_freq).agg(agg_cols).reset_index()\n        \n        return aggregated\n    \n    def engineer_features(self, df: pd.DataFrame, target_column: str = 'revenue') -> pd.DataFrame:\n        df = df.copy()\n        df = df.sort_values('date')\n        \n        df['year'] = df['date'].dt.year\n        df['month'] = df['date'].dt.month\n        df['day'] = df['date'].dt.day\n        df['day_of_week'] = df['date'].dt.dayofweek\n        df['week_of_year'] = df['date'].dt.isocalendar().week.astype(int)\n        df['quarter'] = df['date'].dt.quarter\n        df['is_weekend'] = (df['day_of_week'] >= 5).astype(int)\n        df['is_month_start'] = df['date'].dt.is_month_start.astype(int)\n        df['is_month_end'] = df['date'].dt.is_month_end.astype(int)\n        \n        for lag in [1, 7, 14, 30]:\n            df[f'{target_column}_lag_{lag}'] = df[target_column].shift(lag)\n        \n        for window in [7, 14, 30]:\n            df[f'{target_column}_rolling_mean_{window}'] = df[target_column].rolling(window=window, min_periods=1).mean()\n            df[f'{target_column}_rolling_std_{window}'] = df[target_column].rolling(window=window, min_periods=1).std()\n        \n        df[f'{target_column}_diff'] = df[target_column].diff()\n        df[f'{target_column}_pct_change'] = df[target_column].pct_change()\n        \n        if 'price' in df.columns and 'units_sold' in df.columns:\n            df['price_lag_1'] = df['price'].shift(1)\n            df['units_lag_1'] = df['units_sold'].shift(1)\n            \n            price_change = df['price'].pct_change()\n            units_change = df['units_sold'].pct_change()\n            \n            with np.errstate(divide='ignore', invalid='ignore'):\n                df['price_elasticity'] = np.where(\n                    price_change != 0,\n                    units_change / price_change,\n                    0\n                )\n            df['price_elasticity'] = df['price_elasticity'].replace([np.inf, -np.inf], 0).fillna(0)\n        \n        try:\n            holiday_flags = get_holiday_flags(df['date'])\n            df = pd.concat([df.reset_index(drop=True), holiday_flags.reset_index(drop=True)], axis=1)\n        except Exception as e:\n            logger.warning(f\"Could not add holiday flags: {e}\")\n            df['is_holiday'] = 0\n        \n        df = df.fillna(method='bfill').fillna(method='ffill').fillna(0)\n        \n        return df\n    \n    def prepare_for_modeling(self, aggregation: AggregationType, \n                             target_column: str = 'revenue',\n                             group_by: Optional[str] = None) -> pd.DataFrame:\n        self.clean_data()\n        self.handle_outliers()\n        aggregated = self.aggregate(aggregation, target_column, group_by)\n        featured = self.engineer_features(aggregated, target_column)\n        \n        return featured\n    \n    def get_preview(self, n: int = 10) -> List[Dict[str, Any]]:\n        df = self.raw_df.head(n).copy()\n        \n        for col in df.columns:\n            if pd.api.types.is_datetime64_any_dtype(df[col]):\n                df[col] = df[col].dt.strftime('%Y-%m-%d')\n        \n        return df.to_dict(orient='records')\n    \n    def get_column_info(self) -> Tuple[List[str], List[str], List[str]]:\n        all_columns = list(self.raw_df.columns)\n        numeric_columns = list(self.raw_df.select_dtypes(include=[np.number]).columns)\n        categorical_columns = list(self.raw_df.select_dtypes(include=['object', 'category']).columns)\n        \n        return all_columns, numeric_columns, categorical_columns\n    \n    def get_top_by_column(self, df: pd.DataFrame, group_col: str, \n                          value_col: str, n: int = 5) -> List[Dict[str, Any]]:\n        if group_col not in df.columns or value_col not in df.columns:\n            return []\n        \n        grouped = df.groupby(group_col)[value_col].sum().reset_index()\n        grouped = grouped.sort_values(value_col, ascending=False).head(n)\n        \n        return grouped.to_dict(orient='records')\n","path":null,"size_bytes":11273,"size_tokens":null},"AISalesForecasterzip/AISalesForecaster/frontend/src/components/Header.jsx":{"content":"import { BarChart3, Moon, Sun } from 'lucide-react';\n\nfunction Header({ currentStep, darkMode, onToggleDarkMode }) {\n  const steps = [\n    { id: 'upload', label: 'Upload' },\n    { id: 'preview', label: 'Preview' },\n    { id: 'config', label: 'Configure' },\n    { id: 'dashboard', label: 'Dashboard' },\n  ];\n\n  const currentIndex = steps.findIndex(s => s.id === currentStep);\n\n  return (\n    <header className=\"gradient-bg text-white shadow-lg ml-64\">\n      <div className=\"max-w-7xl mx-auto px-4 py-4\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"p-2 bg-white/20 rounded-lg\">\n              <BarChart3 size={28} />\n            </div>\n            <div>\n              <h1 className=\"text-xl font-bold\">AI Sales Forecaster</h1>\n              <p className=\"text-sm text-blue-100\">Business Insight Generator</p>\n            </div>\n          </div>\n          \n          <div className=\"flex items-center gap-6\">\n            <div className=\"hidden md:flex items-center gap-2\">\n              {steps.map((step, index) => (\n                <div key={step.id} className=\"flex items-center\">\n                  <div className={`\n                    px-3 py-1 rounded-full text-sm font-medium\n                    ${index <= currentIndex ? 'bg-white/20' : 'bg-white/10 text-blue-200'}\n                  `}>\n                    {step.label}\n                  </div>\n                  {index < steps.length - 1 && (\n                    <div className={`w-8 h-0.5 mx-1 ${index < currentIndex ? 'bg-white/40' : 'bg-white/20'}`} />\n                  )}\n                </div>\n              ))}\n            </div>\n\n            <button\n              onClick={onToggleDarkMode}\n              className=\"p-2 bg-white/20 hover:bg-white/30 rounded-lg transition-colors\"\n              aria-label={darkMode ? 'Switch to light mode' : 'Switch to dark mode'}\n              title={darkMode ? 'Switch to light mode' : 'Switch to dark mode'}\n            >\n              {darkMode ? (\n                <Sun size={20} className=\"text-yellow-300\" />\n              ) : (\n                <Moon size={20} className=\"text-white\" />\n              )}\n            </button>\n          </div>\n        </div>\n      </div>\n    </header>\n  );\n}\n\nexport default Header;\n","path":null,"size_bytes":2315,"size_tokens":null},"AISalesForecasterzip/AISalesForecaster/frontend/src/components/AnomalyMarker.jsx":{"content":"import { AlertCircle } from 'lucide-react';\n\nfunction AnomalyMarker({ anomalies, darkMode }) {\n  if (!anomalies || anomalies.length === 0) {\n    return null;\n  }\n\n  return (\n    <div className={`mt-6 p-4 rounded-lg border ${\n      darkMode \n        ? 'bg-red-900/10 border-red-700/30' \n        : 'bg-red-50 border-red-200'\n    }`}>\n      <div className=\"flex items-start gap-3\">\n        <AlertCircle className={`flex-shrink-0 mt-1 ${darkMode ? 'text-red-400' : 'text-red-600'}`} size={20} />\n        <div className=\"flex-1\">\n          <h4 className={`font-semibold mb-2 ${darkMode ? 'text-red-300' : 'text-red-900'}`}>\n            🤖 AI Anomaly Detection\n          </h4>\n          <div className=\"space-y-2\">\n            {anomalies.slice(0, 5).map((anomaly, idx) => (\n              <div key={idx} className={`text-sm ${darkMode ? 'text-red-200' : 'text-red-800'}`}>\n                <div className=\"font-medium\">\n                  {anomaly.anomaly_type === 'spike' ? '📈' : '📉'} {anomaly.description}\n                </div>\n                <div className={`text-xs mt-1 ${darkMode ? 'text-red-300/70' : 'text-red-700/70'}`}>\n                  Severity: {anomaly.severity?.toFixed(1)}%\n                </div>\n              </div>\n            ))}\n            {anomalies.length > 5 && (\n              <div className={`text-xs italic ${darkMode ? 'text-red-300/50' : 'text-red-700/50'}`}>\n                +{anomalies.length - 5} more anomalies detected\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default AnomalyMarker;\n","path":null,"size_bytes":1585,"size_tokens":null},"AISalesForecasterzip/AISalesForecaster/backend/app/services/forecaster.py":{"content":"import pandas as pd\nimport numpy as np\nfrom typing import Dict, List, Tuple, Optional, Any\nfrom datetime import datetime, timedelta\nimport logging\nimport warnings\n\nfrom prophet import Prophet\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.metrics import mean_absolute_error, mean_squared_error\n\n# Lazy import of lightgbm to avoid loading system libraries at module level\nlgb = None\n\nfrom ..models.schemas import (\n    ModelType, AggregationType, ForecastMetrics, \n    ForecastPoint, DecompositionData, FeatureImportance\n)\nfrom .bias_detector import BiasDetector\n\nwarnings.filterwarnings('ignore')\nlogger = logging.getLogger(__name__)\n\n\nclass Forecaster:\n    def __init__(self, df: pd.DataFrame, target_column: str = 'revenue'):\n        self.df = df.copy()\n        self.target_column = target_column\n        self.model = None\n        self.model_type = None\n        self.metrics = None\n        self.feature_importance = None\n    \n    def _calculate_metrics(self, y_true: np.ndarray, y_pred: np.ndarray, dates: list = None) -> ForecastMetrics:\n        mae = mean_absolute_error(y_true, y_pred)\n        rmse = np.sqrt(mean_squared_error(y_true, y_pred))\n        \n        with np.errstate(divide='ignore', invalid='ignore'):\n            mape = np.mean(np.abs((y_true - y_pred) / np.where(y_true == 0, 1, y_true))) * 100\n            mape = min(mape, 100.0)\n        \n        # Calculate bias metrics\n        bias_metrics = BiasDetector.calculate_bias_metrics(y_true, y_pred, dates)\n        \n        return ForecastMetrics(\n            mae=round(mae, 2),\n            rmse=round(rmse, 2),\n            mape=round(mape, 2),\n            train_size=len(y_true),\n            test_size=len(y_pred),\n            confidence_score=bias_metrics.get('confidence_score'),\n            risk_level=bias_metrics.get('risk_level'),\n            overprediction_bias=bias_metrics.get('overprediction_bias'),\n            underprediction_bias=bias_metrics.get('underprediction_bias')\n        )\n    \n    def _get_forecast_periods(self, horizon: int, aggregation: AggregationType, \n                               last_date: datetime) -> pd.DatetimeIndex:\n        if aggregation == AggregationType.DAILY:\n            periods = horizon * 30\n            freq = 'D'\n        elif aggregation == AggregationType.WEEKLY:\n            periods = horizon * 4\n            freq = 'W'\n        else:\n            periods = horizon\n            freq = 'M'\n        \n        future_dates = pd.date_range(\n            start=last_date + timedelta(days=1),\n            periods=periods,\n            freq=freq\n        )\n        return future_dates\n    \n    def train_prophet(self, horizon: int = 6, \n                      aggregation: AggregationType = AggregationType.MONTHLY) -> Dict[str, Any]:\n        self.model_type = ModelType.PROPHET\n        \n        prophet_df = self.df[['date', self.target_column]].copy()\n        prophet_df.columns = ['ds', 'y']\n        prophet_df = prophet_df.dropna()\n        \n        train_size = int(len(prophet_df) * 0.8)\n        train_df = prophet_df.iloc[:train_size]\n        test_df = prophet_df.iloc[train_size:]\n        \n        self.model = Prophet(\n            yearly_seasonality=True,\n            weekly_seasonality=aggregation == AggregationType.DAILY,\n            daily_seasonality=False,\n            changepoint_prior_scale=0.05,\n            seasonality_prior_scale=10,\n            interval_width=0.95\n        )\n        \n        if 'promotion_flag' in self.df.columns:\n            self.model.add_regressor('promotion_flag')\n            train_df = train_df.merge(\n                self.df[['date', 'promotion_flag']].rename(columns={'date': 'ds'}),\n                on='ds', how='left'\n            ).fillna(0)\n        \n        with warnings.catch_warnings():\n            warnings.simplefilter(\"ignore\")\n            self.model.fit(train_df)\n        \n        test_forecast = self.model.predict(test_df[['ds']])\n        self.metrics = self._calculate_metrics(\n            test_df['y'].values, \n            test_forecast['yhat'].values\n        )\n        \n        future_dates = self._get_forecast_periods(horizon, aggregation, prophet_df['ds'].max())\n        future_df = pd.DataFrame({'ds': future_dates})\n        \n        if 'promotion_flag' in self.df.columns:\n            future_df['promotion_flag'] = 0\n        \n        forecast = self.model.predict(future_df)\n        \n        forecast_points = []\n        for _, row in forecast.iterrows():\n            forecast_points.append(ForecastPoint(\n                date=row['ds'].strftime('%Y-%m-%d'),\n                predicted=max(0, round(row['yhat'], 2)),\n                lower_bound=max(0, round(row['yhat_lower'], 2)),\n                upper_bound=round(row['yhat_upper'], 2)\n            ))\n        \n        historical_points = []\n        historical_forecast = self.model.predict(prophet_df[['ds']])\n        for (_, row), (_, hist_row) in zip(prophet_df.iterrows(), historical_forecast.iterrows()):\n            historical_points.append(ForecastPoint(\n                date=row['ds'].strftime('%Y-%m-%d'),\n                actual=round(row['y'], 2),\n                predicted=max(0, round(hist_row['yhat'], 2)),\n                lower_bound=max(0, round(hist_row['yhat_lower'], 2)),\n                upper_bound=round(hist_row['yhat_upper'], 2)\n            ))\n        \n        decomposition = self._extract_prophet_decomposition(prophet_df)\n        \n        return {\n            'forecast': forecast_points,\n            'historical': historical_points,\n            'metrics': self.metrics,\n            'decomposition': decomposition,\n            'feature_importance': None\n        }\n    \n    def _extract_prophet_decomposition(self, df: pd.DataFrame) -> DecompositionData:\n        forecast = self.model.predict(df[['ds']])\n        \n        trend_data = []\n        seasonal_data = []\n        residual_data = []\n        \n        for idx, row in forecast.iterrows():\n            date_str = row['ds'].strftime('%Y-%m-%d')\n            actual = df.iloc[idx]['y'] if idx < len(df) else None\n            \n            trend_data.append({\n                'date': date_str,\n                'value': round(row['trend'], 2)\n            })\n            \n            yearly_seasonal = row.get('yearly', 0)\n            weekly_seasonal = row.get('weekly', 0) if 'weekly' in row else 0\n            total_seasonal = yearly_seasonal + weekly_seasonal\n            \n            seasonal_data.append({\n                'date': date_str,\n                'value': round(total_seasonal, 2)\n            })\n            \n            if actual is not None:\n                residual = actual - row['yhat']\n                residual_data.append({\n                    'date': date_str,\n                    'value': round(residual, 2)\n                })\n        \n        return DecompositionData(\n            trend=trend_data,\n            seasonal=seasonal_data,\n            residual=residual_data\n        )\n    \n    def _clean_nan_inf(self, value: float) -> float:\n        \"\"\"Clean NaN and infinity values for JSON serialization\"\"\"\n        if value is None:\n            return 0.0\n        if np.isnan(value) or np.isinf(value):\n            return 0.0\n        return float(value)\n\n    def train_lightgbm(self, horizon: int = 6,\n                       aggregation: AggregationType = AggregationType.MONTHLY) -> Dict[str, Any]:\n        self.model_type = ModelType.LIGHTGBM\n        \n        df = self.df.copy()\n        df = df.sort_values('date')\n        \n        exclude_cols = ['date', self.target_column, 'holiday_name']\n        if 'product_id' in df.columns:\n            exclude_cols.append('product_id')\n        if 'product_name' in df.columns:\n            exclude_cols.append('product_name')\n        if 'region' in df.columns:\n            exclude_cols.append('region')\n        \n        feature_cols = [col for col in df.columns \n                       if col not in exclude_cols \n                       and df[col].dtype in ['int64', 'float64', 'int32', 'float32']]\n        \n        X = df[feature_cols].fillna(0)\n        y = df[self.target_column].fillna(0)\n        \n        train_size = int(len(df) * 0.8)\n        X_train, X_test = X.iloc[:train_size], X.iloc[train_size:]\n        y_train, y_test = y.iloc[:train_size], y.iloc[train_size:]\n        \n        params = {\n            'objective': 'regression',\n            'metric': 'rmse',\n            'boosting_type': 'gbdt',\n            'num_leaves': 31,\n            'learning_rate': 0.05,\n            'feature_fraction': 0.8,\n            'bagging_fraction': 0.8,\n            'bagging_freq': 5,\n            'verbose': -1,\n            'n_estimators': 100\n        }\n        \n        self.model = lgb.LGBMRegressor(**params)\n        self.model.fit(X_train, y_train, eval_set=[(X_test, y_test)])\n        \n        y_pred = self.model.predict(X_test)\n        y_pred = np.array([self._clean_nan_inf(v) for v in y_pred])\n        self.metrics = self._calculate_metrics(y_test.values, y_pred)\n        \n        importances = self.model.feature_importances_\n        importance_sum = float(np.sum(importances)) if np.sum(importances) > 0 else 1.0\n        self.feature_importance = [\n            FeatureImportance(\n                feature=feat, \n                importance=round(self._clean_nan_inf(imp) / importance_sum * 100, 2)\n            )\n            for feat, imp in sorted(zip(feature_cols, importances), \n                                   key=lambda x: x[1], reverse=True)[:10]\n        ]\n        \n        last_date = df['date'].max()\n        future_dates = self._get_forecast_periods(horizon, aggregation, last_date)\n        \n        last_row = df.iloc[-1].copy()\n        forecast_points = []\n        \n        for future_date in future_dates:\n            future_features = self._create_future_features(last_row, future_date, feature_cols)\n            prediction = max(0, self.model.predict([future_features])[0])\n            prediction = self._clean_nan_inf(prediction)\n            \n            std_dev = self._clean_nan_inf(np.std(y) * 0.1)\n            forecast_points.append(ForecastPoint(\n                date=future_date.strftime('%Y-%m-%d'),\n                predicted=round(prediction, 2),\n                lower_bound=max(0, round(prediction - 1.96 * std_dev, 2)),\n                upper_bound=round(prediction + 1.96 * std_dev, 2)\n            ))\n            \n            last_row[self.target_column] = prediction\n        \n        historical_points = []\n        y_hist_pred = self.model.predict(X)\n        y_hist_pred = np.array([self._clean_nan_inf(v) for v in y_hist_pred])\n        \n        for idx, (_, row) in enumerate(df.iterrows()):\n            std_dev = self._clean_nan_inf(np.std(y) * 0.1)\n            historical_points.append(ForecastPoint(\n                date=row['date'].strftime('%Y-%m-%d'),\n                actual=round(row[self.target_column], 2),\n                predicted=max(0, round(y_hist_pred[idx], 2)),\n                lower_bound=max(0, round(y_hist_pred[idx] - 1.96 * std_dev, 2)),\n                upper_bound=round(y_hist_pred[idx] + 1.96 * std_dev, 2)\n            ))\n        \n        return {\n            'forecast': forecast_points,\n            'historical': historical_points,\n            'metrics': self.metrics,\n            'decomposition': None,\n            'feature_importance': self.feature_importance\n        }\n    \n    def _create_future_features(self, last_row: pd.Series, \n                                future_date: pd.Timestamp,\n                                feature_cols: List[str]) -> List[float]:\n        features = []\n        \n        for col in feature_cols:\n            if col == 'year':\n                features.append(future_date.year)\n            elif col == 'month':\n                features.append(future_date.month)\n            elif col == 'day':\n                features.append(future_date.day)\n            elif col == 'day_of_week':\n                features.append(future_date.dayofweek)\n            elif col == 'week_of_year':\n                features.append(future_date.isocalendar()[1])\n            elif col == 'quarter':\n                features.append((future_date.month - 1) // 3 + 1)\n            elif col == 'is_weekend':\n                features.append(1 if future_date.dayofweek >= 5 else 0)\n            elif col == 'is_month_start':\n                features.append(1 if future_date.day == 1 else 0)\n            elif col == 'is_month_end':\n                features.append(1 if future_date.day == future_date.days_in_month else 0)\n            elif col in last_row:\n                features.append(float(last_row[col]) if pd.notna(last_row[col]) else 0)\n            else:\n                features.append(0)\n        \n        return features\n    \n    def forecast(self, model_type: ModelType, horizon: int = 6,\n                 aggregation: AggregationType = AggregationType.MONTHLY) -> Dict[str, Any]:\n        if model_type == ModelType.PROPHET:\n            return self.train_prophet(horizon, aggregation)\n        else:\n            return self.train_lightgbm(horizon, aggregation)\n","path":null,"size_bytes":13005,"size_tokens":null}},"version":2}